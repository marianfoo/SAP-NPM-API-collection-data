[{"name":"README.md","content":"@sap/asp-middleware\r\n==============\r\n\r\n<!-- toc -->\r\n\r\n- [@sap/asp-middleware](#sapasp-middleware)\r\n\t- [Overview](#overview)\r\n\t- [Usage](#usage)\r\n\t\t- [Approuter Middleware](#approuter-middleware)\r\n\t\t- [ABAP Solution Runtime Client](#abap-solution-runtime-client)\r\n\t\t\t- [Get Tenant](#get-tenant)\r\n\t\t- [Configuration](#configuration)\r\n\t\t\t- [Custom User Onboarding Path](#custom-user-onboarding-path)\r\n\t- [Supported Approuter versions](#supported-approuter-versions)\r\n\t- [Getting Support](#getting-support)\r\n\r\n<!-- tocstop -->\r\n\r\n## Overview\r\nThe `asp-middleware` is an extension for the [@sap/approuter](https://www.npmjs.com/package/@sap/approuter) that enables usage of the *ABAP Solution* Service offered for the *SAP Cloud Platform, ABAP Environment*.\r\n\r\n**It takes care of the following:**\r\n- User onboarding for the initial administrator of a new tenant\r\n- Routing to the right tenant url once a user onboarding is completed successfully\r\n\r\n## Usage\r\n\r\n### Approuter Middleware\r\n\r\nThis module must be loaded as an extension into the [@sap/approuter](https://www.npmjs.com/package/@sap/approuter).\r\n\r\n\r\nThe simplest way to achieve this is:\r\n```javascript\r\nconst approuter = require('@sap/approuter');\r\nconst ar = approuter();\r\n\r\nar.start({\r\n  extensions: [ require('@sap/asp-middleware') ]\r\n});\r\n```\r\n\r\n### ABAP Solution Runtime Client\r\n\r\nThe AspRuntimeClient allows you to communicate with the ABAP Solution Service to get information about your tenants.\r\n\r\n```javascript\r\nconst AspRuntimeClient = require('@sap/asp-middleware/asp-runtime-client');\r\n\r\nconst client = AspRuntimeClient.getInstance();\r\nconst tenant = client.getTenant({\r\n  consumerZoneId: '<consumer-zone-id>'\r\n})\r\n```\r\n\r\n#### Get Tenant\r\n\r\nThe parameter *consumerZoneId* is passed to you during the getDependency call (as *tenantId* URL parameter) and the onSubscription call (as *subscribedTenantId* in the body), that is by default handled by the approuter component, but can also be implemented manually.\r\n\r\nThe getTenant call results in a Promise of a Tenant object, which has the following fields:\r\n\r\n| Name | Description |\r\n|---|---|\r\n| tenantHost | The host of the ABAP tenant corresponding to this consumer |\r\n| consumerZoneId | The zone ID of the consumer (as passed into the getTenant call) |\r\n| abapServiceInstanceId | The service instance ID of the ABAP service instance the tenant is located on | \r\n| abapTenantId | The id of the ABAP tenant itself |\r\n\r\n### Configuration\r\n\r\nA service instance of service `abap-solution` in plan `standard` must be bound to the approuter application.\r\n\r\nAs a last step the `xs-app.json` must be configured to route to the `abap-solution` service. As a minimum this results in the following `xs-app.json` file:\r\n```json\r\n{\r\n\t\"authenticationMethod\": \"route\",\r\n\t\"welcomeFile\": \"/ui\",\r\n\t\"logout\": {\r\n\t\t\"logoutEndpoint\": \"/public/logout\",\r\n\t\t\"logoutPage\": \"/ui\"\r\n\t},\r\n\t\"routes\": [\r\n\t\t{\r\n\t\t\t\"source\": \"^/sap/(.*)$\",\r\n\t\t\t\"target\": \"/sap/$1\",\r\n\t\t\t\"authenticationType\": \"xsuaa\",\r\n\t\t\t\"service\": \"com.sap.cloud.abap.solution\",\r\n\t\t\t\"csrfProtection\": false\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"source\": \"^/ui(.*)$\",\r\n\t\t\t\"target\": \"/ui$1\",\r\n\t\t\t\"authenticationType\": \"xsuaa\",\r\n\t\t\t\"service\": \"com.sap.cloud.abap.solution\",\r\n\t\t\t\"csrfProtection\": false\r\n\t\t}\r\n\t]\r\n}\r\n```\r\n\r\n#### Custom User Onboarding Path\r\n\r\nBy configuring an environment variable called ASP_USER_ONBOARDING_PATHS, the application can decide, which paths should be intercepted for the onboarding of the initial user in the ABAP tenant. By default this is only /ui as this is the path to the ABAP Fiori Launchpad.\r\n\r\nThe variable should be configured as a JSON array. E.g. \r\n\r\n```json\r\n[\"/path/to/entry_point_1\",\"/path/to/entry_point_2\"]\r\n```\r\n\r\n## Supported Approuter versions\r\n\r\nSupported [@sap/approuter](https://www.npmjs.com/package/@sap/approuter) versions are (meaning every minor version of version 8): `^8.0.0`\r\n\r\nIt can be installed using: `npm i @sap/approuter@^8`\r\n\r\n## Getting Support\r\nCreate a BCP Ticket on `BC-CP-ABA-INT`\r\n"}]