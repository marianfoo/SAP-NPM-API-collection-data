[{"name":"CHANGELOG.md","content":"# Changelog\r\n\r\nAll notable changes to this project will be documented in this file.\r\n\r\nThis project adheres to [Semantic Versioning](http://semver.org/).\r\n\r\nThe format is based on [Keep a Changelog](http://keepachangelog.com/).\r\n\r\n## Version 3.3.0 - tbd\r\n\r\n### Added\r\n\r\n- Support for logical events in `composite-messaging`\r\n- Initial support for generating OData V2 queries\r\n- Support of lambda expressions via navigation like `GET /Books?$filter=author/books/all(d:d/stock gt 10)` on SAP HANA when using beta URL to CQN parser (`cds.env.features.odata_new_parser`)\r\n- Preserve `DraftAdministrativeData_DraftUUID` if OData v2 client (indicated by `@sap/cds-odata-v2-adapter-proxy`)\r\n\r\n### Changed\r\n\r\n- Incoming messages now contain a privileged user\r\n- Computed values are preserved during draft activate\r\n- `SELECT.where(...)` generates CQN with list of values for `in` operator\r\n- Always use flag `u` during input validation via `@assert.format`\r\n- Intermediate cqn format for lambda expressions with preceeding navigation path when using beta URL to CQN parser (`cds.env.features.odata_new_parser`)\r\n\r\n### Fixed\r\n\r\n- Deploy endpoint for messaging artifacts includes the needed roles\r\n- Detection of mocked services and forced resolving of views\r\n- `POST/PATCH/PUT` requests on `Composition of many` with association as key and custom `on` conditions\r\n- `$expand` on entities with `.` in name\r\n- Filter on external service when using `ne null` \r\n- Primitive property access of Singletons defined without keys via URL like `/Singleton/name`\r\n- Expand of draft with composition of aspects\r\n- `@Core.ContentDisposition.Filename` instead of `@Core.ContentDisposition`\r\n\r\n### Removed\r\n\r\n## Version 3.2.2 - 2021-06-17\r\n\r\n### Fixed\r\n\r\n- Binary keys handling in $filter\r\n- `odata.metadata` accept header fragment ignored during deserializer lookup in odata-server\r\n- Don't overwrite manual error code in case of data-server error\r\n- MTX enabled check\r\n- Invoke custom error handler (`srv.on('error')`) for each error and preserve modifications in case of changesets\r\n- Evaluation of restrictions for custom requests to the same `ApplicationService`\r\n- Misinterpreted SQL keyword as argument in QL's fluid usage\r\n\r\n## Version 3.2.1 - 2021-06-04\r\n\r\n### Added\r\n\r\n- Support for AMQP options in AQMP-based message brokers\r\n\r\n### Fixed\r\n\r\n- Requests using lambda operators in `$filter` in combination with instance based authorization\r\n\r\n## Version 3.2.0 - 2021-05-31\r\n\r\n### Added\r\n\r\n- Automatic topic manipulation for non-declared events\r\n- Support for events which are declared outside of service\r\n- Prefer headers `return=minimal` and `return=representation`\r\n  + Default value is configurable at `cds.env.odata.prefer.return`\r\n  + If not configured, the default is `representation`\r\n- Support for annotation `@Core.ContentDisposition`\r\n- Include `x-correlation-id` in headers of outbound message\r\n- Service consumption supports `search` property  and arbitrary functions in CQN\r\n- Support for temporal requests with different data types\r\n- Support for reading single draft-enabled entities via service API (`srv.read(<entity>, { ..., IsActiveEntity: true/false })`)\r\n- Support for feature toggles via `@cds/mtx`'s `ModelProviderService` based on DwC's product configuration header (alpha)\r\n  + Activate via `cds.env.features.alpha_toggles`\r\n- Support for structured keys used in composition of aspects (beta)\r\n\r\n### Changed\r\n\r\n- Emit logs promoted to `info`\r\n- Simpler topic names for `local`, `file-based-messaging` and `message-queuing`\r\n- `messaging.emit(...)` also uses outbox\r\n- Messaging will start listening to events once the `listening` event was fired on the `cds` object\r\n- Cascade delete order reversed from leaves to root\r\n- Intermediate cqn format for lambda expressions in odata\r\n- OData function names and structure are kept unchanged after parsing a URL to CQN in the adapter layer, corresponding \"CQN-to-SQL\" logic is moved to the DB layer. The changes affect the following functions: `contains`, `startswith`, `endswith`, `toupper`, `tolower`, `indexof`, `day`, `date` and `time`.\r\n- Template cache at prototype of `RootTransaction`\r\n- Both strings and numbers are accepted as decimals\r\n  + Strict numbers handling can be reenabled via `cds.env.features.strict_numbers`\r\n\r\n### Fixed\r\n\r\n- Star columns can be written as `'*'` or `{ref: ['*']}`\r\n- Arrayed and structured elements in draft mode\r\n- Cascade delete where child entity has more than one parent\r\n- Ignore `@restrict` conditions when reading `DraftAdministrativeData` of drafts\r\n- Navigation to one composition via association in `containment` mode (`cds.odata.containment = true`)\r\n- Create, update and delete requests to entity projections annotated with the annotation `@cds.persistence.table` are not resolved correctly\r\n- Using inline `$filter` query option in deeply nested expands on SAP HANA\r\n- Runtime exception when PATCH or PUT request methods are used for non-existing IDs. For example, â†’ `PUT /api/v1/CustomerOrder('non-existing Id')/items(id='')/product`\r\n- Drafts: read active children of active or draft entities using deeply nested navigation or `$expand` query option\r\n- Select media type and content disposition information from base entity\r\n- Attempt to calculate time delta with unresolved target crashes server\r\n- OData string functions `contains`, `startswith` and `endswith` find records with `null` attributes when used with `not` operator\r\n- Deep deletion of sensitive data (annotated with `@PersonalData.IsPotentiallyPersonal` or `@PersonalData.IsPotentiallySensitive`) during update is properly considered in audit logging\r\n- Pseudo-variables as default value in draft-enabled entities\r\n- Escape CDL keywords when used in URL path\r\n\r\n## Version 3.1.2 - 2021-05-28\r\n\r\n### Fixed\r\n\r\n- Downport of \"Escape CDL keywords when used in URL path\"\r\n\r\n## Version 3.1.1 - 2021-05-20\r\n\r\n### Added\r\n\r\n- Downport of \"Support for reading single draft-enabled entities via service API (`srv.read(<entity>, { ..., IsActiveEntity: true/false })`)\"\r\n- Computed values are preserved during draft activate with `cds.env.features.preserve_computed = true`\r\n  + Preserving computed values will be the default behavior in ^3.3\r\n\r\n### Fixed\r\n\r\n- Downport of \"Attempt to calculate time delta with unresolved target crashes server\"\r\n\r\n## Version 3.1.0 - 2021-05-05\r\n\r\n### Added\r\n\r\n- Support for declared events with annotations `@topic`, `@source` and `@type`\r\n- Support for declared events in composite messaging\r\n- Extended managed data (`@cds.on.insert`, `@cds.on.update`):\r\n  + Pseudo variable `$uuid`\r\n  + Pseudo variable `$user.<attr>`\r\n  + Static values, for example `@cds.on.insert: 'foo'`\r\n- READ support for associations with custom on condition with form `<association>.<backlink> = $self and <association>.<property> = '<value>'`\r\n- Support for default values in views with more than one parameter\r\n- Support of input validation for arrayed elements\r\n- QL fluent API `orderBy()` convenience options `orderBy('<column> <order?>')`, `orderBy('...', ...)`, `orderBy('..., ...')`, and `orderBy([...])`\r\n- Use new, beta URL to CQN parser during read requests when serving to OData via `cds.env.features.odata_new_parser`\r\n- Beta version of new CQN to URL parser\r\n  + Use during service consumption via `cds.env.features.remote_new_parser`\r\n- Draft-specific columns are considered in `$select` if OData validation is skipped\r\n- Support for `cardinality` in `ref`\r\n- Support for nested expressions in where conditions\r\n- Invoke custom error handler (beta) in OData and REST adapters if necessary\r\n\r\n### Changed\r\n\r\n- Model-based processing instruction cache attached to service for SaaS extensibility\r\n- Removed compatibility feature flag `cds.env.features.skip_expand_assoc`\r\n- Input-related details of assertion error added to error message, for example `Value 4 is not in specified range [1,3]`\r\n- `$search` query option is parsed into `.search` instead of like expressions in `.where`\r\n- Integrity checks are skipped if `@sap/cds-compiler`'s foreign key generation (beta!) is active\r\n- Private `<entity>._dependents` made non-enumerable to avoid circular references\r\n- `null` values for virtual properties added during post processing (previously done during serialization in odata-server)\r\n\r\n### Fixed\r\n\r\n- Ambiguous columns in having clause\r\n- The generic read handler for drafts now correctly returns an object if the key of the entity is provided, before it was an array\r\n- Improved handling of unique constraint violation error during create and update\r\n- Better error logs for integrity checks\r\n- Leading and trailing whitespaces are allowed in OData expressions\r\n- Release database client if begin fails\r\n- `auto-expand` of generated foreign keys in OData x4 flavor (`cds.env.odata.flavor = x4`) when actions return entities\r\n- Consider `not null` annotations on inline structured types in OData x4 flavor (`cds.env.odata.flavor = x4`)\r\n- Temporal data in OData batch requests\r\n- Deep update/delete with static on conditions by composition to many\r\n- Draft: Alias of entity projection is incorrectly considered as key.\r\n- Support of arbitrary requests in service consumption if no external service model is provided\r\n- Use unfolded model if transaction was initiated in messaging\r\n- Infinite loop in restriction processing when user attribute is `null`\r\n\r\n## Version 3.0.9 - 2021-04-29\r\n\r\n### Changed\r\n\r\n- Downport of \"Private `<entity>._dependents` made non-enumerable to avoid circular references\"\r\n\r\n### Fixed\r\n\r\n- Downport of \"Use unfolded model if transaction was initiated in messaging\"\r\n\r\n## Version 3.0.8 - 2021-04-20\r\n\r\n### Fixed\r\n\r\n- Timeout issues in `enterprise-messaging-shared` in reconnect\r\n- Queries with a simultaneous use of `$expand` and `$orderby`, when the latter is using functions\r\n- Preserve non-error messages to client during failing draft activation\r\n\r\n## Version 3.0.7 - 2021-04-15\r\n\r\n### Added\r\n\r\n- CSRF-token handling in service consumption via `@sap-cloud-sdk/core` with `cds.env.features.fetch_csrf = true`\r\n\r\n### Fixed\r\n\r\n- Timeout issues in `enterprise-messaging-shared`\r\n\r\n## Version 3.0.6 - 2021-04-14\r\n\r\n### Fixed\r\n\r\n- Allow to return primitive properties instead of entities in REST adapter\r\n- Normalize time data on SQLite to support data type `TIMESTAMP_TEXT`\r\n\r\n## Version 3.0.5 - 2021-04-07\r\n\r\n### Fixed\r\n\r\n- Side effects on `@sap/hana-client`'s streaming extension\r\n\r\n## Version 3.0.4 - 2021-04-07\r\n\r\n### Fixed\r\n\r\n- Empty inserts for nested composition of one\r\n- Preserve children if multiple compositions to same target\r\n\r\n## Version 3.0.3 - 2021-04-01\r\n\r\n### Added\r\n\r\n- Support for `application/*+json` when parsing events through webhooks\r\n\r\n### Fixed\r\n\r\n- Navigation properties in `$select` inside of `$expand` query option\r\n\r\n## Version 3.0.2 - 2021-03-30\r\n\r\n### Added\r\n\r\n- Support for `{xpr:...}` as argument of a function in SQL Builder\r\n- Aliased parameters of a function call using an OData inline parameter syntax are provided as a request payload in `req.data`\r\n- Skip conversion to UTC on SAP HANA during insert via `.rows()`, `.values()`, or `.as()` with `cds.env.features.preserve_timestamps = true`\r\n- Beta version of new URL to CQN parser\r\n  + Use during read requests when serving to REST via `cds.env.features.rest_new_parser`\r\n  + Known limitations:\r\n    + Falsy key path segments in navigations, for example, `GET /Books/0/author`\r\n    + `ne` operator in `$filter` does not match `NULL`\r\n    + Nested functions, for example, `contains(toupper(...))`\r\n    + `$select` not filtered for duplicates, for example, `$select=ID,*` -> `columns: ['ID', 'ID', ...]`\r\n  + Not supported when serving to REST:\r\n    + Deep navigations, for example, `GET /Books/1/author/books`\r\n    + `/$count`\r\n    + `$apply`\r\n\r\n### Changed\r\n\r\n- Minimum required Node.js version is now 12. Support for Node.js v10 is dropped.\r\n- Draft handlers registered via `cds.ApplicationService.registerFioriHandlers()` which gets called in `cds.ApplicationService.init()`\r\n- OData validation is skipped by default. It can be explicitly turned on by setting `cds.odata.skipValidation` config to `false`.\r\n\r\n### Fixed\r\n\r\n- Accept header matching during media stream\r\n- Time delta for Date type in temporals\r\n- Function calls using an OData inline parameter syntax with aliased parameters of primitive types\r\n- Path navigation in `$orderby` expressions when using SAP HANA functions\r\n\r\n### Removed\r\n\r\n- Blind path-level logs by odata-server\r\n\r\n## Version 3.0.1 - 2021-03-25\r\n\r\n### Added\r\n\r\n- `PUT` primitive properties via OData\r\n- Optimistic concurrency control for primitive properties\r\n- Data for virtual properties filtered out on write to draft tables\r\n- Annotation `@odata.draft.enclosed`\r\n\r\n### Changed\r\n\r\n- Grants of `@restrict` in draft are derived from the CRUD vocabulary\r\n- Unnecessary `@restrict` checks for actions on drafts are skipped (\"in process by user\" check remains)\r\n- Drafts are deleted after the active version was created/ updated\r\n- Skip \"with parameters\" clause if no order by clause or all columns in the order by clause are not strings\r\n  + Deactivate during two-month grace period via compatible feature flag `cds.env.features.skip_with_parameters = false`\r\n\r\n### Fixed\r\n\r\n- Reading `SiblingEntity` via navigation of a draft enabled entity\r\n- Inline defined return types of custom actions/functions in REST\r\n- Multiple integrity errors in one changeset\r\n- `@Capabilities.NavigationRestrictions` considers \"deep\" navigation paths\r\n- Add ETags to result based on `@odata.etag` in CSN alone\r\n- Reading media stream with accept header\r\n\r\n### Removed\r\n\r\n## Version 3.0.0 - 2021-03-19\r\n\r\n### Added\r\n\r\n- SAP Event Mesh: Webhook support\r\n- SAP Event Mesh: Webhook support in multitenancy\r\n- Messaging: Remove obsolete topics on queue creation\r\n- Additional convenience look-ups of `messages.properties` files next to models\r\n- Support for the `@cds.search` annotation to allow a different set of searchable elements in the `$search` OData query option and to extend the search to associated entities (currently not supported)\r\n- Additional credentials look-up with label `service-manager` in SAP HANA pool\r\n- Support for new \"Locked by Another User\" request of draft choreography\r\n\r\n### Changed\r\n\r\n- By default, only elements typed as `string` are searchable via the `$search` OData query option to improve performance\r\n- Deprecate `@Search.defaultSearchElement` annotation in favor of the `@cds.search` annotation\r\n- Ignore `not null` annotation on nested structured types in OData x4 flavor (`cds.env.odata.flavor = x4`) if its parent structure is optional\r\n- Smart quoting based on database-specific keywords exported by `@sap/cds-compiler`\r\n  + Deactivate during two-month grace period via compatible feature flag `cds.env.features.compiler_keywords = false`\r\n\r\n### Fixed\r\n\r\n- Using path navigations in `$filter` for SAP HANA-based services configured with `cds.odata.flavor = x4`\r\n- Only `messaging` will deal with domain-level events\r\n- Read access using nondraft enabled projections on draft children\r\n- Debug message when metadata size exceeds cache limit\r\n- Order by using functions in combination with group by\r\n- Streaming by navigation\r\n- Alignment of temporal data with compiler v2 format\r\n- Calculate `DraftIsCreatedByMe` and `DraftIsProcessedByMe` properties of `DraftAdministrativeData` by reading drafts\r\n\r\n### Removed\r\n\r\n- Support for version 2 of the `@sap/xssec` package, as it is deprecated. Now, only version 3 of the package is supported.\r\n\r\n## Version 2.9.11 - 2021-04-09\r\n\r\n### Fixed\r\n\r\n- Double quoted SQL keywords\r\n\r\n## Version 2.9.10 - 2021-04-07\r\n\r\n### Fixed\r\n\r\n- Downport of fix \"Side effects on `@sap/hana-client`'s streaming extension\"\r\n\r\n## Version 2.9.9 - 2021-04-01\r\n\r\n### Fixed\r\n\r\n- Managed properties of non-leaf nodes without additional delta shall not be updated during draft activation\r\n\r\n## Version 2.9.8 - 2021-03-30\r\n\r\n### Added\r\n\r\n- Database pool teardown in case of failed db connection attempt\r\n\r\n## Version 2.9.7 - 2021-03-18\r\n\r\n### Fixed\r\n\r\n- Reserved keywords for smart quoting\r\n- Datetime conversion for SAP HANA in case of `INSERT...as(SELECT...)`\r\n\r\n## Version 2.9.6 - 2021-03-12\r\n\r\n### Added\r\n\r\n- Pass `tcpKeepAliveIdle` to `hdb` (available with `hdb^18`) via environment variable `HDB_TCP_KEEP_ALIVE_IDLE`\r\n- Database pool teardown in case of credentials become invalid scenario extended by unreachable database\r\n\r\n## Version 2.9.5 - 2021-03-08\r\n\r\n### Fixed\r\n\r\n- Relative error target on draft activation for Fiori Elements with OData v2\r\n\r\n## Version 2.9.4 - 2021-03-08\r\n\r\n### Fixed\r\n\r\n- Determine bound action parameter name in case of changesets\r\n\r\n## Version 2.9.3 - 2021-03-04\r\n\r\n### Fixed\r\n\r\n- Check whether current request is a bound action\r\n\r\n## Version 2.9.2 - 2021-03-02\r\n\r\n### Fixed\r\n\r\n- Result payload by expand of grandchild entity, when the child data that is null\r\n- Delete composition of one via navigation\r\n- Use extended model in structured processing\r\n\r\n## Version 2.9.1 - 2021-02-26\r\n\r\n### Fixed\r\n\r\n- Namespace lookup in EDM for OData configuration\r\n- Find previous entity for inherited authorization restrictions\r\n- Use extended model in generic CRUD post-processing\r\n- Clone headers before sanitizing for logs\r\n\r\n## Version 2.9.0 - 2021-02-24\r\n\r\n### Added\r\n\r\n- Support for `cds.LargeString` in queries for remote services\r\n- Support for tenant-aware emit in AMQP messaging\r\n- Metadata (for example, `__count` or `@odata.count` for OData V2 and OData V4, correspondingly) of an external service result are uniformly normalized (for example, to `$count`) and propagated with the result by the rest-client\r\n- Improved support for managed composition of one\r\n- Support for cascade DELETE for composition of one\r\n- Smart quoting in SQL statements\r\n- Improved memory consumption of integrity checks\r\n- Result payload includes ETag values of composition targets\r\n- Custom metadata in OData result (alpha)\r\n- Support for canonical URL to `$metadata` in `@odata.context` of a response: use `cds.env.odata.contextAbsoluteUrl = true` to get a service URL (default) or `cds.env.odata.contextAbsoluteUrl = 'http://example.com/yourService/'` to set your own URL\r\n\r\n### Changed\r\n\r\n- The default implementation of enterprise messaging (`enterprise-messaging`) is now multitenant aware.\r\n  Currently only emit is implemented. The old, shared variant is available through `enterprise-messaging-shared`.\r\n- Skip localization on pure count queries\r\n- Managed properties of base entity are updated if any composition target is updated\r\n  - Deactivate during two-month grace period via compatible feature flag `cds.env.features.update_header_item = false`\r\n- Default text templates for element assertions don't contain an element name as a parameter anymore\r\n- Custom authorization header can now be set in service consumption\r\n- Managed associations-to-one aren't expanded in the result of a POST request in case of `cds.odata.flavor = v4`\r\n  - Deactivate during two-month grace period via compatible feature flag `cds.env.features.skip_expand_assoc = false`\r\n- Implicit auto exposed entities inherit authorization restrictions from parent\r\n- Modifying an entity without authorization results in HTTP code `403` instead of `404`\r\n- Instance-based `@restrict.where` clauses are ignored during `CREATE` (instead of rejecting the request)\r\n  - Deactivate during two-month grace period via compatible feature flag `cds.env.features.skip_restrict_where = false`\r\n\r\n### Fixed\r\n\r\n- `req.diff` for deep hierarchies\r\n- DateTime conversion for `INSERT` statements using `.columns` and `.values/.rows` on SAP HANA\r\n- OData V4 error response target for bound actions\r\n- Requests using `$search` query option on draft enabled active entities\r\n- Path navigations in `$filter` aren't considered as aggregated away when used in combination with `$apply`\r\n- Draft: Entities with expired draft can now be deleted\r\n- `Edm.Time`, `Edm.DateTime` and `Edm.DateTimeOffset` serialization issues when using external OData V2 service\r\n- Primitive property access of Singletons via URL like `/Singleton/name`\r\n- Path navigation in `$orderby` expressions for draft-enabled services on SAP HANA\r\n\r\n### Removed\r\n\r\n- Redundant key generation\r\n\r\n## Version 2.8.7 - 2021-04-07\r\n\r\n### Fixed\r\n\r\n- Downport of fix \"Side effects on `@sap/hana-client`'s streaming extension\"\r\n\r\n## Version 2.8.6 - 2021-02-17\r\n\r\n### Fixed\r\n\r\n- Handling of OData query option `$skiptoken` when URL encoded (that is, `%24skiptoken`)\r\n\r\n## Version 2.8.5 - 2021-02-16\r\n\r\n### Fixed\r\n\r\n- Handling of OData query option `$skiptoken`\r\n\r\n## Version 2.8.4 - 2021-02-15\r\n\r\n### Added\r\n\r\n- Database pool teardown in case credentials become invalid\r\n- Idle timeout added to default database pool configuration\r\n\r\n### Fixed\r\n\r\n- Crash on bad remote service credentials\r\n- Wrong case order during query generation in service consumption\r\n\r\n## Version 2.8.3 - 2021-02-05\r\n\r\n### Fixed\r\n\r\n- No pagination while reading single entity\r\n- `SELECT.limit.offset.val` should be a number\r\n\r\n## Version 2.8.2 - 2021-02-03\r\n\r\n### Fixed\r\n\r\n- `@mandatory` annotation of typed parameters of actions/functions\r\n\r\n## Version 2.8.1 - 2021-02-02\r\n\r\n### Fixed\r\n\r\n- Skip input validation for arrayed types as parameter of actions/functions\r\n- Log error stack when serving to REST\r\n- `@assert.range` doesn't imply `@mandatory`\r\n\r\n### Removed\r\n\r\n- Reconnect for `hdb`\r\n\r\n## Version 2.8.0 - 2021-02-01\r\n\r\n### Added\r\n\r\n- Support for OData proxies (beta)\r\n- Support for OData cross-service references (beta)\r\n- Support upsert for to-one containment with foreign key in parent\r\n- Support for case-insensitive `bearer` prefix when forwarding token in service consumption\r\n- Support for filter on `null` values in service consumption\r\n- Server-side pagination for REST services\r\n- Input validation for typed parameters of actions/functions\r\n- Format assertion exception for UUIDs in MTX's `ProvisioningService.tenant` (old SAP Cloud Platform subaccount IDs aren't UUIDs)\r\n- Draft scenario all active is extended\r\n- Skip integrity checks via:\r\n  - `@assert.integrity: false` on entity and service level (was only on association level)\r\n  - `cds.env.features.assert_integrity = false` as global config (private `cds.runtime.skipIntegrity` will be removed)\r\n- Skip SAP HANA's localization feature (`WITH PARAMETERS ('LOCALE' = '<locale>')`) via `cds.env.features.with_parameters = false`\r\n- Deprecation warning for `req.run`\r\n\r\n### Changed\r\n\r\n- ETag added for expanded entities\r\n- Use `cds.log()` throughout (incl. odata-server)\r\n- Replace text keys with default text (i.e., w/o locale) before logging error\r\n- Read after write on draft activate doesn't read deep\r\n- On HTTP error (status >= 400) during remote service consumption: log details and throw gateway error\r\n- `accept=application/json,text/plain` is used as default `accept` header for remote service calls\r\n- Improved custom error message in case acquiring a client from the pool timed out\r\n- Metadata endpoints are protected by default if the respective service is protected. Deactivate metadata endpoint protection via `cds.env.odata.protectMetadata = false`.\r\n- Streamlined module names used in logging\r\n\r\n### Fixed\r\n\r\n- Aggregated-away properties in `$select`, `$expand`, and `$filter` now behave correctly\r\n- Exception when accessing texts for a renamed localized draft entity\r\n- Deep Update wrongly tried to create entries if there are nested `to-one` compositions\r\n- Navigation on singleton\r\n- Localized error messages if no authentication used\r\n- Fix draft with expand when ordering by draft-specific columns\r\n- Incorrect content type in batch response if no `Accept` header is provided\r\n- Input validation for enums using `falsy` values\r\n- Insert via navigation throws an error if the root of navigation doesn't exist\r\n- Filter virtual fields from columns and expand by READ\r\n- `auto-expand` of generated foreign keys when functions/actions return entities\r\n- Custom headers are normalized to lower case\r\n- Post-processing of arrayed elements in Database Service\r\n- Duplicated key condition in DELETE CQN\r\n- To be checked data for DELETE integrity checks in actions was wrong\r\n- Fixed missing `!=` comparator for query generation of remote services\r\n- CSN modification during resolve view\r\n- Clash of language-code-like namespaces (for example, `de.` or `fr.`) with localized entities\r\n- `hdb`'s error event invalidates client\r\n\r\n### Removed\r\n\r\n- Usage of deprecated `req.run`\r\n- Support for deprecated config `cds.auth.passport`. Use `cds.requires.auth` instead.\r\n- Default `$format` query option in case of `GET` requests to remote OData services\r\n\r\n## Version 2.7.10 - 2021-01-20\r\n\r\n### Fixed\r\n\r\n- Downport of fix \"CSN modification during resolve view\"\r\n\r\n## Version 2.7.9 - 2021-01-19\r\n\r\n### Fixed\r\n\r\n- Don't crash if release called without client\r\n\r\n## Version 2.7.8 - 2020-12-10\r\n\r\n### Fixed\r\n\r\n- Null pointer exception when using `$expand`, `$filter`, and `contains` in the same HTTP request\r\n\r\n## Version 2.7.7 - 2020-12-08\r\n\r\n### Fixed\r\n\r\n- In `hdb` driver, stored procedures without OUT parameters can now return values\r\n- Service consumption when using `.get('/')`\r\n\r\n## Version 2.7.6 - 2020-12-07\r\n\r\n### Fixed\r\n\r\n- Validate pool clients before use\r\n- Improved default pool configuration\r\n- Remove `req.run` deprecation warning\r\n\r\n## Version 2.7.5 - 2020-12-04\r\n\r\n### Fixed\r\n\r\n- Messaging incompatibility in combination with `@sap/cds@4.4.3`\r\n\r\n## Version 2.7.4 - 2020-12-02\r\n\r\n### Fixed\r\n\r\n- `filter-node-package` has to be a dev dependency\r\n\r\n## Version 2.7.3 - 2020-12-01\r\n\r\n### Added\r\n\r\n- Deprecation warning for private function `req.run`, which will be removed\r\n- Custom aggregates in `$apply` (beta)\r\n- Support for string keys with dots in value (e. g. `a.b.c`) when using keys as segments\r\n- `$filter`, `$groupby`, and `$orderby` works with path navigation to key for managed association to-one on SQLite\r\n\r\n### Changed\r\n\r\n- Logging is now done using `cds.log`\r\n- CREATE and UPDATE requests that aren't allowed due to `@restrict.where` are rejected with `403` instead of `404`\r\n- No usage of private `req._model` in generic handlers\r\n- Service consumption: Print Cloud SDK logs only in debug mode\r\n- Generated API for actions and functions on `ApplicationService` as now done on `Service`\r\n\r\n### Fixed\r\n\r\n- No integrity check for events\r\n- Race condition in data listener of messaging\r\n- External entities are now always automatically resolved\r\n- Skip integrity checks for virtual entities\r\n- Auto-expand of to-one association of `CREATE` or `UPDATE` requests\r\n- `tx.model` in REST requests\r\n- Expand to association with projection `as select from where`\r\n\r\n### Removed\r\n\r\n- `req.statements` isn't available anymore\r\n\r\n## Version 2.7.2 - 2020-11-20\r\n\r\n### Added\r\n\r\n- Support for tracing database statements with Dynatrace when using `@sap/hana-client` driver\r\n\r\n### Fixed\r\n\r\n- Problem with navigations that have `null` as value in payload\r\n\r\n## Version 2.7.1 - 2020-11-18\r\n\r\n### Changed\r\n\r\n- Transaction state handling moved to core\r\n\r\n### Fixed\r\n\r\n- Response in case of failed changesets in `$batch` requests\r\n- UPDATE/INSERT via navigation with foreign key in child\r\n\r\n### Removed\r\n\r\n- Private function `_ensureOpen` of `cds.DatabaseService`\r\n\r\n## Version 2.7.0 - 2020-11-18\r\n\r\n### Added\r\n\r\n- `@assert.range enum { ... }` for decimals\r\n- Draft: Lock active entity on edit action to prevent duplicate drafts\r\n- Set batch response header Content-Transfer-Encoding\r\n\r\n### Changed\r\n\r\n- Correlation ID at `req.headers['x-correlation-id']` in subrequests\r\n\r\n### Fixed\r\n\r\n- Resolving custom DELETE CQNs\r\n- Non-nullable values can't be set to `null` in UPDATE requests\r\n- Delete active entity with DELETE restriction\r\n- Calculation of HasDraftEntity doesn't involve secure annotations\r\n- POST/PATCH on composition of aspect didn't insert keys correctly\r\n- Check for different navigation properties with `$expand`\r\n- Streaming from nondraft entity in draft context\r\n- REST Adapter: `PUT` requests on collections are forbidden\r\n- affected rows in CREATE caused error with hdb\r\n- Navigating to composition of aspect with association as key caused error\r\n- Wrongly returned value for key calculation in expand caused for loop to break\r\n- TypeError by not connected database\r\n- Multiple messages in batch changeset\r\n\r\n### Removed\r\n\r\n- Support for `defaultLocale` on service level\r\n\r\n## Version 2.6.11 - 2021-01-20\r\n\r\n### Fixed\r\n\r\n- Downport of fix \"CSN modification during resolve view\"\r\n\r\n## Version 2.6.9 - 2020-11-26\r\n\r\n### Added\r\n\r\n- Internal (for mtx) parameter `poolOnly` to `HanaDatabase.disconnect()` for clearing generic pool entry in case of credentials update\r\n\r\n## Version 2.6.8 - 2020-11-16\r\n\r\n### Added\r\n\r\n- Support for tracing database statements with Dynatrace when using `hdb` driver\r\n\r\n### Changed\r\n\r\n- No separate logging of error message and stack in OData server\r\n- Not extended tenants reuse default OData service instance\r\n\r\n### Fixed\r\n\r\n- Fix for metadata document exceeding cache limit\r\n\r\n## Version 2.6.7 - 2020-11-11\r\n\r\n### Fixed\r\n\r\n- Previous fix broke service consumption of other systems\r\n\r\n## Version 2.6.6 - 2020-11-10\r\n\r\n### Fixed\r\n\r\n- Check `req.path` during DoS prevention\r\n- Headers handling in service consumption for SAP S/4HANA On-Premise systems\r\n\r\n## Version 2.6.5 - 2020-11-09\r\n\r\n### Fixed\r\n\r\n- Default sorting in combination with `$apply`\r\n\r\n## Version 2.6.4 - 2020-11-06\r\n\r\n### Fixed\r\n\r\n- i18n tests executed in cds-test\r\n\r\n## Version 2.6.3 - 2020-11-05\r\n\r\n### Fixed\r\n\r\n- Url and headers handling in service consumption\r\n\r\n## Version 2.6.2 - 2020-11-04\r\n\r\n### Fixed\r\n\r\n- Augment read after write data with returned values of virtual properties on draft activate\r\n\r\n## Version 2.6.1 - 2020-11-04\r\n\r\n### Fixed\r\n\r\n- Skip forbidden view check if association to view with foreign key in target\r\n\r\n## Version 2.6.0 - 2020-11-03\r\n\r\n### Added\r\n\r\n- Support for `$expand` on managed Composition and Association to-one in structured types\r\n- Support for CQN partials in `SELECT.orderBy()`\r\n- `messages_<locale>.properties` files looked for in all i18n folders (not just the first)\r\n- Structured types as key\r\n- Support for localization in custom handlers\r\n- `InsertResult` (beta):\r\n  - iterator that returns the keys of the created entries, for example:\r\n    - Example: `[...result]` -> `[{ ID: 1 }, { ID: 2 }, ...]`\r\n    - in case of `INSERT...as(SELECT...)`, the iterator returns `{}` for each row\r\n  - `affectedRows`: the number inserted (root) entries or the number of affectedRows in case of INSERT into SELECT\r\n  - `valueOf()`: returns `affectedRows` such that comparisons like `result > 0` can be used\r\n    - Note: `===` can't be used as it also compares the type\r\n- Authentication strategy `xsuaa` (only with `@sap/xssec^3`) that additionally provides access to saml attributes via `req.user.attr` (for example, `req.user.attr.familyName`)\r\n\r\n### Changed\r\n\r\n- SQL queries don't use placeholders for rows of LIMIT clause\r\n- Replaced `@sap/odata-server` dependency by own copy\r\n- On `PATCH` and `PUT`, an `UPDATE` event is followed by a `CREATE` event if there was no matching entity\r\n- On `PUT`, not provided properties are defaulted/ nulled\r\n- On HTTP requests, `req.data` is a copy to preserve the original payload\r\n- Additional properties in payload are preserved for entities with `@cds.persistence.skip` when served to `rest`\r\n- RemoteService: Ignore where clause of view definition during INSERT|UPDATE|DELETE instead of throwing error\r\n- Don't use SQL placeholders for numbers\r\n- Service-level `@requires` are checked in protocol adapter instead of ApplicationService (excluding metadata requests)\r\n- Additional translatable messages\r\n\r\n### Fixed\r\n\r\n- Streamlined debugging output for SQL statements\r\n- Integrity check for Associations in structured types\r\n- DateTime conversion for SAP HANA\r\n- Ensure `req.method` and `req.headers`\r\n- DatabaseService: Ignore where clause of view definition during INSERT|UPDATE|DELETE\r\n- Activate draft with UPDATE restriction\r\n- Add the correct backlink to composition tree in case of additional association from child to parent\r\n- `falsy` default values weren't inserted into the database\r\n- Always prepare for temporal data\r\n- Internal server error on views with parameters and join\r\n- Secure annotation in draft union scenario\r\n- Augment read after write data with returned values of virtual properties\r\n- `@restrict` with association paths and `$user.<attr>` in where\r\n- Result of deep insert\r\n- `UPDATE` statements in custom handlers on Application Service setting only falsy values or using only expressions like `{stock: {'-=': 1}}`\r\n\r\n## Version 2.5.6 - 2020-10-22\r\n\r\n### Fixed\r\n\r\n- Messaging: add data listener only once queue was put\r\n\r\n## Version 2.5.5 - 2020-10-19\r\n\r\n### Fixed\r\n\r\n- `$user.id` in `restrict.where` always treated as string\r\n\r\n## Version 2.5.4 - 2020-10-19\r\n\r\n### Fixed\r\n\r\n- Certificate issue when consuming remote services\r\n\r\n## Version 2.5.3 - 2020-10-16\r\n\r\n### Fixed\r\n\r\n- Don't fail in `cds deploy --to sqlite` if `sqlite3` isn't installed\r\n\r\n## Version 2.5.2 - 2020-10-09\r\n\r\n### Fixed\r\n\r\n- Don't fail in `cds deploy --dry` if `sqlite3` isn't installed\r\n\r\n## Version 2.5.1 - 2020-10-07\r\n\r\n### Fixed\r\n\r\n- Set temporal session contexts on SAP HANA\r\n- Multiple invocations of `req.on('failed', () => { ... })`\r\n\r\n## Version 2.5.0 - 2020-10-02\r\n\r\n### Added\r\n\r\n- Messaging: Transaction-coupled events will only be sent for successful requests\r\n  (can be disabled by setting outbox=false)\r\n- Support for @assert.notNull: false\r\n- Messaging: Support for non-normalized input in handler registration\r\n- Messaging: automatically generate headers.id\r\n- Support for navigating to association to-one in structured\r\n- Initial support for `cds.odata.flavors = { v2, v4, w4, x4 }`\r\n- Support custom timezone offset\r\n- Support for assertions in structured data\r\n- Support for annotation `@Capabilities.Readable`\r\n- Input validation for actions and functions\r\n- Support language-dependent sorting order for SAP HANA\r\n\r\n### Changed\r\n\r\n- Input processing: Performance improvements through templating mechanism used in single handler per layer\r\n- Input processing: Key propagation only on DB layer\r\n- Format of file-based messaging\r\n\r\n### Fixed\r\n\r\n- Outbound REST/OData errors in CQN translation\r\n- View resolution for views with static values\r\n- Skip transition by view annotated with @cds.persistence.table:true\r\n- Reading structured types via navigation\r\n- Filter on elements having the same name as in DraftAdministrativeData\r\n- Draft union scenario with filter on elements from DraftAdministrativeData\r\n- Resolving views for deep deletes\r\n- Key generation in some UPDATE queries\r\n- SAP HANA: cds.DateTime convert to UTC in draft case\r\n- Combining `$filter` query option and `$apply` using only filter transformation\r\n- Join with draft tables\r\n- Determine name of primary key of draft enabled entity in subselect\r\n- Improved error message for direct use of auto exposed entity\r\n- Empty structured types are now null\r\n- Structured properties with the same name as CQN properties failed to execute\r\n- Association as key caused wrongly generated SQL statement\r\n- Deep update with structured type caused wrongly generated SQL statement\r\n\r\n## Version 2.4.0 - 2020-09-11\r\n\r\n### Added\r\n\r\n- Structured types in `$orderby`, `$filter`, `$select`\r\n- Limited support for Association to-one in structured types\r\n\r\n### Changed\r\n\r\n- Messaging: The `queue` and `queueConfig` options are now a single object: `{ name, ...queueConfig }`\r\n- Messaging: The `file` option is now moved to top level\r\n- Messaging: The `prefix` option is removed\r\n\r\n### Fixed\r\n\r\n- Diff calculates the difference on database level\r\n- `sap-messages` header now uses unicode characters for special characters\r\n- `req.target` for bound operations\r\n- `INSERT.into(...).as(SELECT.from(...)` inside custom handlers\r\n- Integrity check for DELETE requests\r\n- `Serialization Error` for entities with composition of aspects in `containment` mode\r\n- Expand on entity with a backlink as a key\r\n\r\n## Version 2.3.1 - 2020-09-17\r\n\r\n### Fixed\r\n\r\n- Expand on entity with a backlink as a key\r\n\r\n## Version 2.3.0 - 2020-08-31\r\n\r\n### Added\r\n\r\n- Support for Continuation Local Storage (CLS)\r\n- Support for access of structured property values in Odata\r\n- Support for expand for external OData service in REST\r\n\r\n### Fixed\r\n\r\n- HTTP Status Code for `GET` requests on `navigation-to-many` in combination with `$filter`\r\n\r\n## Version 2.2.0 - 2020-08-26\r\n\r\n### Added\r\n\r\n- Path navigations with keys for managed to-one association in `orderby` work on SQLite e.g. `$orderby=author/id`\r\n- Support for `cds.PrivilegedUser`\r\n- Implicit sorting for OData singletons\r\n\r\n### Fixed\r\n\r\n- Deep update could potentially insert wrong data\r\n- Deep insert was also done on empty composition-to-many\r\n- POST via multiple navigations with OData containment activated\r\n- localized view with parameters\r\n- implicit sorting order\r\n- Custom SELECT CQN with join/union in draft enabled service failed for nondraft entities\r\n- `req.user.attr` access during @restrict processing with @sap/xssec^3\r\n\r\n## Version 2.1.9 - 2020-08-26\r\n\r\n### Fixed\r\n\r\n- hdb reconnect on idle timeout\r\n\r\n## Version 2.1.7 - 2020-08-17\r\n\r\n### Added\r\n\r\n- Composite-Messaging\r\n- Support for Message Queuing\r\n- Support for `@sap/xssec^3`\r\n- `@Common.numericSeverity` in error response\r\n- Support expand with `*` in QL API\r\n- Headers can be set with tx.emit on remote HTTP services\r\n- Propagate @cds.localized:false during deep reads\r\n- SAP HANA: support for service manager credentials\r\n\r\n### Changed\r\n\r\n- Messaging: The configuration is moved to top level (before it was in credentials)\r\n- Messaging: The payload type is now 'application/json'\r\n\r\n### Fixed\r\n\r\n- Messaging: Messages are only acknowledged if successful\r\n- Race conditions with messaging management\r\n- `orderBy` as an empty array\r\n- Join transaction during local API call\r\n- Support duplicate names of bound and unbound actions and functions in local API\r\n- Test read for UPSERT wasn't tenant aware\r\n- Prefer `cds.env.requires.uaa.credentials`\r\n- Error while activate with missing mandatory fields\r\n- Restore `req._.req.authInfo` for compatibility\r\n- OData V4 single property access in combination with mode `odata=structured`\r\n- empty string in functions like `tolower`, `toupper`\r\n\r\n## Version 2.1.6 - 2020-08-06\r\n\r\n### Fixed\r\n\r\n- Removal of key properties of contained entity\r\n- Flattening of to-one association if key is also a to-one association\r\n- No localization with `SELECT.forUpdate()`\r\n- Multilevel expand with composition backlink as key\r\n- Ignore association keys in select for deletion integrity check\r\n- POST via multiple navigations\r\n- `req.user.id = <clientId>` with JWT strategy and `client_credentials` flow\r\n- Transaction handling with integrity check and changesets in JSON batch\r\n\r\n## Version 2.1.5 - 2020-08-03\r\n\r\n### Added\r\n\r\n- Support for `@Capabilities.NavigationRestrictions`\r\n- Support queries to a model with nested projections to an external service\r\n\r\n### Fixed\r\n\r\n- `req._.req` in `SAVE` handler\r\n- Insert duplicate data during deep update\r\n- SAP HANA: prefer `this.options.credentials`\r\n- `$orderBy` in case of `DRAFT` with `Union`\r\n\r\n## Version 2.1.4 - 2020-07-31\r\n\r\n### Added\r\n\r\n- Support for structured OData\r\n- Support for arrayed elements\r\n\r\n### Fixed\r\n\r\n- Large numbers of expands (>26)\r\n- Reference integrity check for `DELETE`\r\n- Localized in combination with draft\r\n- Propagate @cds.localized:false during deep reads (currently limited to one expand)\r\n- Fetch specific credentials from multiple xsuaa bindings via `requires.uaa.vcap`\r\n- Static values in custom backlinks of compositions\r\n\r\n## Version 2.1.3 - 2020-07-28\r\n\r\n### Added\r\n\r\n- Synchronous API for streaming\r\n- Support calling SAP HANA stored procedures\r\n\r\n### Fixed\r\n\r\n- Streaming of null values and not found entities\r\n- Temporal session contexts on SAP HANA\r\n\r\n## Version 2.1.2 - 2020-07-24\r\n\r\n### Fixed\r\n\r\n- SAP HANA credentials handling\r\n\r\n## Version 2.1.1 - 2020-07-24\r\n\r\n### Fixed\r\n\r\n- SAP HANA pooling with instance manager\r\n\r\n### Removed\r\n\r\n- `req.isDraftChange`, `req.draft`, and `req.draftMetadata` in draft-related handlers\r\n\r\n## Version 2.1.0 - 2020-07-22\r\n\r\n### Added\r\n\r\n- `req.warn(code, msg, target, args)`\r\n- `req.data` returns an array in case of bulk operations\r\n- All services as subclasses of new `cds.Service`\r\n- Differentiation between \"Application Service\" (e.g., providing OData) and \"Persistence Service\" (e.g., database, remote)\r\n\r\n### Fixed\r\n\r\n- Retrieve performance information via `sap-statistics` header in case of batch requests\r\n- Direct user authentication challenges in case of `/$batch`\r\n- HTTP error codes from custom handlers aren't filtered anymore if in 300...500 range\r\n- following projection with undefined name in target entity\r\n- Lists and null values in `where` with fluent expressions\r\n\r\n### Changed\r\n\r\n- Streamlined `req.reject/error/info(code, msg, target, args)`: takes four individual params (number, string, string, array) or one object\r\n- Changed behavior by handler registration:\r\n  -- Handlers registered with entity = `*` aren't called by unbound events anymore.\r\n  -- Handlers registered without entity aren't called by bound events anymore.\r\n  -- Special case: Handlers registered in form .before/on/after(\\'\\*\\', handler) are called by bound and unbound events.\r\n- Expanding association from draft-enabled entity to draft enabled entities always provides active version of the expanded entity.\r\n- If you export a function in an `init.js` file, it will be called with the primary database, and its result is awaited.\r\n- REST: Since the service is now based on the `cds.Service` base class, all convenience functions (`create`, `post`, etc.) are streamlined.\r\n- Messaging: Only one queue per app is created, as opposed to one queue per app and external service.\r\n- Messaging: You can now directly connect to the (technical) messaging service through `await cds.connect.to('messaging')`, no topic names are generated here.\r\n- Messaging: If you want to link your own or external services to messaging, you need to model your events in CDS.\r\n- Messaging: If you want to provide custom topics for modeled events, you need to add the `@topic` annotation to the event.\r\n- Messaging: The `prefix` option in the service's credentials is prepended to events with a `@topic` annotation.\r\n- Messaging: The syntax to emit events with headers changed:\r\n  ```js\r\n  srv.emit({ event: 'yourEvent', data: { some: 'data' }, headers: { some: 'headers' } })\r\n  ```\r\n- Messaging: The default file for `file-based-messaging` is `~/.cds-msg-box`.\r\n- Streamlined handler registration: `srv.before/on/after(<event>, <entity>?, <handler>)`\r\n  - Event and handler are mandatory; entity must be omitted if unbound action/function (CREATE, READ, UPDATE, DELETE are considered to be bound)\r\n  - Event and entity may be arrayed\r\n  - `srv.before/on/after(*, <handler>)` matches all as shorthand\r\n- `INSERT` statements return an object or array of objects (in case of bulk) with the number of affected rows as result of `valueOf()`, as well as the keys of the inserted entities:\r\n  ```js\r\n  const res = await srv.run(\r\n    INSERT.into('Books').entries([\r\n      { ID: 1, title: 'one' },\r\n      { ID: 2, title: 'two' }\r\n    ])\r\n  )\r\n  res > 1 // > true\r\n  res.keys // > [{ ID: 1 }, { ID: 2 }]\r\n  ```\r\n\r\n### Removed\r\n\r\n- Support for run block (`tx.run(() => {})`)\r\n\r\n## Version 2.0.3 - 2020-06-19\r\n\r\n### Added\r\n\r\n- Custom translatable error messages\r\n- Support for containment in CRUD\r\n- Support for static values in custom on conditions for associations\r\n\r\n### Changed\r\n\r\n- on() function for joins doesn't support the simple conditions like on(x, =, y) anymore. Only fluent expressions and object predicates are supported.\r\n\r\n### Fixed\r\n\r\n- Enterprise Messaging: Received messages are correctly decoded\r\n- Reading single properties of draft enabled entities via navigations e. g. `/E0(ID=<uuid>,IsActiveEntity=false)/e1(ID=<uuid>,IsActiveEntity=false)/property`\r\n- Not supported transformation in `groupby` throws cryptic error\r\n- etag check only if OData request\r\n- Statements if path expression contains keys of type `cds.Timestamp`, `cds.DateTime` or `cds.Time`\r\n- `$filter` lambda `any` operator if no argument is provided\r\n- User attributes in `req.user.attr` merge `info.userInfo` and `info.userAttributes` (authentication strategy `JWT`)\r\n- User authentication challenges\r\n\r\n### Removed\r\n\r\n- Support for nested user attributes in `@restrict.where`, e.g., `$user.name.familyName`\r\n\r\n## Version 2.0.2 - 2020-06-10\r\n\r\n### Added\r\n\r\n- Support for XSUAA's user attribute value `$UNRESTRICTED`\r\n- Default to combination `[...];IEEE754Compatible=true;ExponentialDecimals=true` if IEEE754Compatible or ExponentialDecimals is omitted\r\n- Use custom authenticate middleware via `cds.env.requires.auth.impl`\r\n- Authentication strategy `dummy` (`cds.env.requires.auth.strategy = 'dummy'`) that creates super users (i.e., pass all authorization checks)\r\n- Support relative destination path in rest-client\r\n\r\n### Changed\r\n\r\n- CQN returned for `req.query` changed â€” for requests with path expressions, the returned CQN of `req.query` is changed to a simplified format. For `GET /Authors(150)/books` the CQN contains the path in `.from` instead of an `exists` clause in `.where`.\r\n\r\n```\r\n{ SELECT:  {  from: { \"ref\": [\r\n        {\r\n          \"id\": \"AdminService.Authors\",\r\n          \"where\": [ { \"val\": 150 } ]\r\n        },\r\n      \"books\"\r\n      ] } } }\r\n```\r\n\r\n- Authorizations as whitelist: if any restrictions exist for the target, all not explicitly allowed operations are forbidden (e.g., `@restrict: [{ grant: 'READ', ... }]` -> everything but `READ` is forbidden for all, including bound actions and functions)\r\n- Applicable `@requires` and `@restrict` definitions concatenated by AND\r\n- Reference to undefined XSUAA user attribute in `@restrict.where` results in forbidden\r\n- `req.event` for unbound actions and functions is provided without service prefix\r\n- Increased logging in production (temporarily until revised logging concept is implemented)\r\n- `cds.serve(..., { passport: [...] }` -> `cds.serve(..., { auth: [...] }`\r\n\r\n### Fixed\r\n\r\n- `INSERT.into.as(SELECT.from...)` with `SELECT` containing placeholders\r\n- Requests on a navigation to many with key provided returns 404 if the resource doesn't exist\r\n- POST/PATCH requests on `Composition of many` with backlink association as key\r\n- Path expressions on SAP HANA are now flat and not structured anymore\r\n- `$expand` on `Composition of many` with backlink association as key\r\n- Roles from scopes including \".\"\r\n- Ignore unknown arrayed column during input validation\r\n- Too early client release\r\n- Pool configurations with default values can be set to `0`\r\n\r\n### Removed\r\n\r\n- Support for annotation `@cds.persistence.name`\r\n- Deprecated SQL dialect `hdbcds`\r\n\r\n## Version 2.0.1 - 2020-05-20\r\n\r\n### Changed\r\n\r\n- Passport strategies whitelist: `mock` and `JWT`\r\n- Authentication not needed for calls to a service's root or metadata endpoints\r\n- Support for \"public\" entities and actions (i.e., no restrictions) in services without `@requires` but other entities and/or actions with `@restrict`\r\n\r\n### Fixed\r\n\r\n- `target` added to assert errors\r\n\r\n## Version 2.0.0 - 2020-05-20\r\n\r\n### Changed\r\n\r\n- Update major version number\r\n\r\n## Version 1.2.0 - 2020-05-19\r\n\r\n### Added\r\n\r\n- The timeout of the exclusive lock of drafts can now be configured using `cds.drafts.cancellationTimeout`\r\n- `req.params`: iterable with key-value pairs for the key predicates of the addressed resource\r\n\r\n### Changed\r\n\r\n- Slightly improved performance for `$expand`\r\n- Return key values (single key only) of created entries instead of number of affected rows\r\n- Annotations `@cds.onInsert` and `@cds.onUpdate` ignore values from the request\r\n- Processing of read-only values moved to initial before handler\r\n- Aligned handling of virtual, computed, read-only, immutable with java runtime\r\n- Allow deep insert on to one association with nonkey property, the nonkey property is silently ignored\r\n\r\n### Fixed\r\n\r\n- Resolved some performance issues with `@sap/hana-client`\r\n- `$filter=false or ...` is now possible\r\n- Custom handler registration in multi-tenant scenario\r\n- Alias in associations wasn't processed correctly in post-processing\r\n- `$search` is now applied on the query result of `$apply` as specified in OData V4 spec\r\n- `evictionRunIntervalMillisForPools` is now treated properly\r\n- Searching for `_` or `%` in `$filter` queries with `contains`/`startswith`/`endswith`\r\n- Insert of to-one associations with structured elements\r\n\r\n## Version 1.1.1 - 2020-04-28\r\n\r\n### Added\r\n\r\n- Support for `orderBy` in rest-client\r\n\r\n### Changed\r\n\r\n- `limit` in CQN is translated to placeholders in SQL\r\n- QL API: .where() is changed:\r\n  -- Where with two parameters like .where('x', 1) isn't allowed and should be replaced with .where('x', '=', 1).\r\n  -- Combinations with partial CQNs like .where({ref: ['x']}, '=', 1) aren't allowed. Use arrays of partial CQNs like .where([ {ref: ['x']}, '=', {val: 1} ]) instead.\r\n  -- Fluent expressions work as strictly alternating string/value lists (as documented). Partial CQN can be used here as value.\r\n- Per default, results are now ordered by keys of the entity\r\n\r\n### Fixed\r\n\r\n- `$filter=false or ...` is now possible\r\n- CREATE now returns `context.data` if not all non-UUID keys are provided\r\n  and no error is thrown in the database client\r\n- CANCEL and PATCH drafts now support multiple fields in where clauses\r\n- Handler registration for draft events in multitenancy scenario\r\n- Localize expanded entities\r\n- Composition and Association to one with expand in draft case\r\n- Disable local default pagination via `@cds.query.limit.default: 0`\r\n- Brackets in object predicates in where\r\n\r\n## Version 1.1.0 - 2020-04-23\r\n\r\n### Added\r\n\r\n- Support for CREATE operations with delegated key generation\r\n- `@cds.persistence.skip` annotated entities return HTTP code 501 in generic handlers\r\n- Introduced `@cds.localized:false` on entity-level for switching off automatic redirection to localized views\r\n- Server-side pagination on global, service, and entity-level via `@cds.query.limit`\r\n- Omitted key predicates of nested composition items are augmented, if possible\r\n- The exclusive lock of a draft automatically times out after 15 minutes\r\n- Static where annotations for RUD\r\n- Associations to one annotated with `@assert.integrity: false` are ignored on integrity checks\r\n- Support input validation annotations in ODATA\r\n\r\n### Changed\r\n\r\n- Object notation in `.where` of statements doesn't allow functions anymore\r\n- `context.diff()` ignores `@cds.persistence.skip` annotated entities\r\n- Always try to read from localized views (also by draft enabled entities)\r\n- In multitenant scenario, the CSN model is now always loaded from `@sap/cds-mtx`. Previously, it was only loaded if it was extended.\r\n- Use open source version of `@sap-cloud-sdk/core`\r\n- If a column or column alias is used multiple times in a SELECT query, the query is from now on rejected. Example: `SELECT.from(Foo).columns(['c1', 'c1'])`\r\n\r\n### Fixed\r\n\r\n- Reference integrity checks for foreign entities without stored keys\r\n- Calculation of `HasActiveEntity`\r\n- Update and Delete with where annotations\r\n- Aliases by navigation with complex where annotation\r\n- `req._.res` is express' ServerResponse\r\n- SQL Error in case of `$filter` using `ne` operator in combination with `$search`\r\n- Deep update with immutable fields in child entities\r\n- Draft union scenario in case of DraftAdministrativeData navigation\r\n- Transaction handling inside `$batch` requests\r\n- Multiple aliases in `SELECT.columns`\r\n- Use `hdb` if in direct dependencies of app (and `@sap/hana-client` isn't)\r\n- Mapping over a result propagates `$count`\r\n- Don't ignore rows with `null` column values in negated `$search` queries\r\n\r\n# Changelog History\r\n\r\nThe CDS Runtime module is the successor of `@sap/cds-services`, `@sap/cds-messaging`, `@sap/cds-rest`, `@sap/cds-hana`, `@sap/cds-sqlite`, and `@sap/cds-sql`. The changelogs of these components can be found contained within each corresponding npm package:\r\n\r\n- [cds-services](https://www.npmjs.com/package/@sap/cds-services)\r\n- [cds-messaging](https://www.npmjs.com/package/@sap/cds-messaging)\r\n- [cds-rest](https://www.npmjs.com/package/@sap/cds-rest)\r\n- [cds-hana](https://www.npmjs.com/package/@sap/cds-hana)\r\n- [cds-sqlite](https://www.npmjs.com/package/@sap/cds-sqlite)\r\n- [cds-sql](https://www.npmjs.com/package/@sap/cds-sql)\r\n"},{"name":"changelogs","nodes":[{"name":"CHANGELOG_cds-hana.md","content":"# Changelog\r\n\r\nAll notable changes to this project will be documented in this file.\r\n\r\nThis project adheres to [Semantic Versioning](http://semver.org/).\r\n\r\nThe format is based on [Keep a Changelog](http://keepachangelog.com/).\r\n\r\n## Version 1.26.0 - 2020-04-23 (part of cds-runtime 1.1.0)\r\n\r\n### Fixed\r\n\r\n- Use `hdb` if in direct dependencies of app (and `@sap/hana-client` is not)\r\n\r\n## Version 1.25.1 - 2020-03-20\r\n\r\n### Removed\r\n\r\n- Timeout for update and delete statements (if needed: increase libuv's threadpool size via environment variable `UV_THREADPOOL_SIZE`)\r\n\r\n## Version 1.25.0 - 2020-03-19\r\n\r\n### Added\r\n\r\n - Single timestamp per transaction\r\n - default timeout 20s for acquiring client from pool\r\n\r\n## Version 1.24.0 - 2020-02-26\r\n\r\n### Added\r\n\r\n- Streaming from draft\r\n- Timeout for update and delete statements to handle locked records (@sap/hana-client only, default: 1s)\r\n\r\n## Version 1.23.0 - 2020-02-19\r\n\r\n### Changed\r\n\r\n- Use `like` instead of `contains` fuzzy search for `$search` queries\r\n\r\n## Version 1.22.0 - 2020-02-05\r\n\r\n### Added\r\n\r\n- Implement statement drop\r\n\r\n### Changed\r\n\r\n- SESSION_CONTEXT('APPLICATIONUSER') instead of SESSION_CONTEXT('XS_APPLICATIONUSER')\r\n- @sap/hana-client is preferred over hdb\r\n\r\n## Version 1.21.0 - 2019-12-10\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.21.0\r\n\r\n## Version 1.20.1 - 2019-11-29\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.20.1\r\n\r\n## Version 1.20.0 - 2019-11-19\r\n\r\n### Added\r\n\r\n- Method to set session context\r\n\r\n## Version 1.19.1 - 2019-10-30\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.19.1\r\n\r\n## Version 1.19.0 - 2019-10-29\r\n\r\n### Removed\r\n\r\n- `npm-shrinkwrap.json`\r\n\r\n## Version 1.18.1 - 2019-10-16\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.18.1\r\n \r\n## Version 1.18.0 - 2019-10-02\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.18.0\r\n\r\n## Version 1.17.1 - 2019-09-18\r\n\r\n### Fixed\r\n\r\n- Issue in streaming while using hana-client\r\n\r\n## Version 1.17.0 - 2019-09-09\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.17.0\r\n\r\n## Version 1.16.0 - 2019-08-21\r\n\r\n### Changed\r\n\r\n- Signature of the Client's constructor\r\n\r\n## Version 1.15.0 - 2019-07-23\r\n\r\n### Fixed\r\n\r\n- `@sap/hana-client` streaming extension is used only if necessary\r\n- Streaming supports `null` values\r\n\r\n## Version 1.14.0 - 2019-07-09\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.13.0\r\n\r\n## Version 1.13.0 - 2019-06-24\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.13.0\r\n\r\n## Version 1.12.0 - 2019-05-24\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.12.0\r\n\r\n## Version 1.11.1 - 2019-05-16\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.11.1\r\n\r\n## Version 1.11.0 - 2019-05-15\r\n\r\n### Changed\r\n\r\n- Improved performance by reducing calls to process.nextTick()\r\n\r\n## Version 1.10.0 - 2019-05-03\r\n\r\n### Added\r\n\r\n- Service related functions\r\n\r\n## Version 1.9.0 - 2019-04-16\r\n\r\n### Added\r\n\r\n- `client.stream()` for streaming large binaries\r\n\r\n### Changed\r\n\r\n- Make hdb default driver\r\n\r\n## Version 1.8.0 - 2019-03-29\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.8.0\r\n\r\n## Version 1.7.1 - 2019-03-19\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.7.0\r\n\r\n## Version 1.7.0 - 2019-03-19\r\n\r\n### Removed\r\n\r\n- Hana specific SQL generation for SELECT statements in case of 'contains'\r\n\r\n## Version 1.6.0 - 2019-02-25\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.6.0\r\n\r\n## Version 1.5.1 - 2019-02-12\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.5.1\r\n\r\n## Version 1.5.0 - 2019-02-06\r\n\r\n### Changed\r\n\r\n- Minimum node version 8.9.0\r\n- Improve expand performance\r\n\r\n## Version 1.4.0 - 2019-01-22\r\n\r\n### Added\r\n\r\n- `validate_certificate` and `hostname_in_certificate` to override certificate validation in local development mode\r\n- `.execute` supports placeholders in CQN\r\n\r\n## Version 1.3.0 - 2019-01-11\r\n\r\n### Changed\r\n\r\n- Use latest version of @sap/cds-sql\r\n\r\n## Version 1.2.0 - 2018-12-21\r\n\r\n### Added\r\n\r\n- Set default values in case of CREATE, UPSERT and adding a child in deep documents\r\n\r\n## Version 1.1.0 - 2018-12-12\r\n\r\n### Added\r\n\r\n- Support Deep Document CQNs\r\n\r\n## Version 1.0.3 - 2018-11-27\r\n\r\n### Changed\r\n\r\n- Throw db error instead of wrapping it in Sql Error\r\n- Use options.credentials instead of options directly\r\n\r\n### Fixed\r\n\r\n- Post processing of Binary, Boolean and Integer64\r\n\r\n## Version 0.10.0 - 2018-10-17\r\n\r\n- Refactoring and changes due to updated dependencies \r\n\r\n## Version 0.9.0 - 2018-10-04\r\n\r\n### Fixed\r\n\r\n - limit and order when expanding a to many association\r\n\r\n## Version 0.8.0 - 2018-09-17\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 0.10.0\r\n\r\n## Version 0.7.1 - 2018-09-05\r\n   \r\n### Changed\r\n\r\n- Improved npm-shrinkwrap\r\n\r\n## Version 0.7.0 - 2018-08-28\r\n\r\n### Added\r\n\r\n- Fallback in case certificate is used instead of ca at connect options\r\n\r\n### Changed\r\n\r\n- API documentation updated\r\n\r\n## Version 0.6.1 - 2018-08-09\r\n\r\n### Changed\r\n\r\n- Require submodules on demand\r\n\r\n## Version 0.6.0 - 2018-08-07\r\n\r\n### Added\r\n\r\n- Full SQL including eventual parameters to stack trace error message\r\n- Support for abstract placeholders #now and #user\r\n- Support for unary and binary expressions in contains\r\n\r\n### Changed\r\n\r\n- Increased default option of max. db connection clients to 100\r\n\r\n### Fixed\r\n\r\n- SQL error hides internal error messages and provides details in log\r\n\r\n## Version 0.5.1 - 2018-07-02\r\n\r\n### Fixed\r\n\r\n - Escaping of special characters in case of 'contains'\r\n\r\n## Version 0.5.0 - 2018-06-25\r\n\r\n### Added\r\n\r\n - Hana specific SQL generation for DROP statements\r\n - Hana specific SQL generation for SELECT statements in case of 'contains'\r\n - Added SQL Error to hide the internal information from other errors\r\n - support execution of blocks of statements\r\n - support plain mode of SQL name mapping\r\n\r\n### Fixed\r\n\r\n - CDS injection\r\n\r\n## Version 0.4.0 - 2018-05-02\r\n\r\n### Changed\r\n\r\n- connect options aligned to spec\r\n- support for latest CQN spec changes\r\n\r\n## Version 0.3.0 - 2018-04-16\r\n\r\n### Added\r\n\r\n- support CREATE statements\r\n\r\n## Version 0.2.0 - 2018-03-16 \r\n### Added\r\n\r\n- usage of npm-shrinkwrap\r\n\r\n### Changed\r\n\r\n- improved performance for expand in case of one-to-many relations\r\n"},{"name":"CHANGELOG_cds-messaging.md","content":"# Changelog\r\n\r\nAll notable changes to this project will be documented in this file.\r\n\r\nThis project adheres to [Semantic Versioning](http://semver.org/).\r\n\r\nThe format is based on [Keep a Changelog](http://keepachangelog.com/).\r\n\r\n## Version 1.8.2 - 2020-03-19\r\n\r\n### Added\r\n\r\n- It is now possible to set the queue configuration with the `queueConfig` property in the credentials section\r\n  https://help.sap.com/doc/75c9efd00fc14183abc4c613490c53f4/Cloud/en-US/rest-management-messaging.html#_queuep\r\n\r\n### Removed\r\n\r\n- Bound events are not supported anymore\r\n\r\n## Version 1.7.0 - 2020-02-19\r\n\r\n### Changed\r\n\r\n- Updated version number for public release\r\n\r\n## Version 1.6.0 - 2020-02-05\r\n\r\n### Added\r\n\r\n- Support for `prefix` credentials options to prefix topics\r\n\r\n### Changed\r\n\r\n- You can no longer set the namespace outside of the `credentials` block\r\n\r\n### Fixed\r\n\r\n- Fixed bug where non-trimmed data causes problems in file-based messaging\r\n\r\n## Version 1.5.0 - 2019-12-10\r\n\r\n### Fixed\r\n\r\n- Receiving chunks can be an array with more than one item\r\n\r\n## Version 1.4.0 - 2019-11-19\r\n\r\n### Removed\r\n\r\n- The `namespace` property of a services does not need to be set anymore\r\n\r\n## Version 1.3.0 - 2019-10-29\r\n\r\n### Removed\r\n\r\n- `npm-shrinkwrap.json`\r\n\r\n## Version 1.2.1 - 2019-10-16\r\n\r\n### Added\r\n\r\n- `headers` parameter for `.emit`\r\n \r\n## Version 1.2.0 - 2019-10-02\r\n\r\n### Changed\r\n\r\n- Minor improvements\r\n\r\n## Version 1.1.1 - 2019-09-18\r\n\r\n### Added\r\n\r\n- File-based-messaging: If you set the file to true or \"default\", the default file name is chosen\r\n\r\n### Changed\r\n\r\n- File-based-messaging: Default file location ist set to <tmp_dir>/cds-message-box\r\n- File-based-messaging: File configuration is moved to credentials block\r\n- For external (cloud-event-based) services, the data property is now in message.data (before it was message.data.data)\r\n\r\n## Version 1.1.0 - 2019-09-09\r\n\r\n### Added\r\n\r\n- Queue name can be specified by setting the `queue` property\r\n- You can now use `srv.on('my/custom/topic', ()={...})` to register on topics\r\n  and `srv.emit('my/custom/topic, {...})` to emit messages with topics (If your\r\n  topic contains only one segment, you must write `topic:myCustomTopic`)\r\n\r\n### Changed\r\n\r\n- The hashes in generated topic or queue names now only consist of 4 characters\r\n- Default file name of 'file-based-messaging' is <temporary_directory>/message_box\r\n\r\n### Fixed\r\n\r\n- Special characters in topic and queue names are now omitted\r\n- Non-JSON payloads are now ignored\r\n- OAuthToken request occacionally fails\r\n\r\n### Removed\r\n\r\n- `srv.on.topic` and `srv.emit.to.topic`\r\n\r\n## Version 1.0.1 - 2019-08-26\r\n\r\n### Changed\r\n\r\n- Package '@sap/xb-msg-amqp-v100' is only dev dependency\r\n\r\n## Version 1.0.0 - 2019-08-21\r\n\r\n### Added\r\n\r\n- Initial implementation\r\n"},{"name":"CHANGELOG_cds-rest.md","content":"# Changelog\r\n\r\nAll notable changes to this project will be documented in this file.\r\n\r\nThis project adheres to [Semantic Versioning](http://semver.org/).\r\n\r\nThe format is based on [Keep a Changelog](http://keepachangelog.com/).\r\n\r\n## Version 1.7.0 - 2020-04-23 (part of cds-runtime 1.1.0)\r\n\r\n### Changed\r\n\r\n- Use open source version of `@sap-cloud-sdk/core`\r\n\r\n## Version 1.6.2 - 2020-03-19\r\n\r\n### Changed\r\n\r\n- In case there is no credentials.destination provided the `destinations` environment variable is not created anymore.\r\n  The connection to the remote service is handled internally.\r\n\r\n### Removed\r\n\r\n- `npm-shrinkwrap.json`\r\n\r\n## Version 1.5.0 - 2020-02-19\r\n\r\n### Changed\r\n\r\n- Updated version number for public release\r\n\r\n## Version 1.4.0 - 2020-02-05\r\n\r\n### Added\r\n\r\n- Where x in (a,b,...) predicates are translated to series of (x eq a) or (x eq b) in OData `$filter` options\r\n\r\n### Changed\r\n\r\n- Version of `@sap/cloud-sdk-core` pinned to `1.15.1`\r\n- Version of `@sap/cloud-sdk-util` pinned to `1.15.1`\r\n\r\n## Version 1.3.0 - 2019-10-29\r\n\r\n### Removed\r\n\r\n- `npm-shrinkwrap.json`\r\n\r\n## Version 1.2.0 - 2019-10-02\r\n\r\n### Added\r\n\r\n- If JWT token provided in context, it is forwarded to Cloud SDK\r\n\r\n### Changed\r\n\r\n- Version of `@sap/cloud-sdk-core` to `1.10.0`\r\n- Version of `@sap/cloud-sdk-util` to `1.10.0`\r\n\r\n## Version 1.1.3 - 2019-09-21\r\n\r\n### Added\r\n\r\n- Dependency to `@sap/cloud-sdk-util`\r\n\r\n## Version 1.1.2 - 2019-09-19\r\n\r\n### Fixed\r\n\r\n- `npm-shrinkwrap.json` containing wrong versions\r\n\r\n## Version 1.1.1 - 2019-09-18\r\n\r\n### Added\r\n\r\n- Support `where`, `columns` and `one` properties in SELECT\r\n\r\n### Changed\r\n\r\n- Enforce JSON format in OData\r\n- Clean up OData V2 responses\r\n\r\n## Version 1.1.0 - 2019-09-09\r\n\r\n### Added\r\n\r\n- Auto-generate `destinations` env variable if `NODE_ENV !== 'production`'\r\n\r\n## Version 1.0.2 - 2019-08-27\r\n\r\n### Fixed\r\n\r\n- `npm-shrinkwrap.json` containing wrong versions\r\n\r\n## Version 1.0.1 - 2019-08-26\r\n\r\n ### Changed\r\n\r\n- Version of `@sap/cloud-sdk-core` pinned to `1.8.0`\r\n\r\n## Version 1.0.0 - 2019-08-21\r\n\r\n### Added\r\n\r\n- Initial implementation"},{"name":"CHANGELOG_cds-services.md","content":"# Changelog\r\n\r\nAll notable changes to this project will be documented in this file.\r\n\r\nThis project adheres to [Semantic Versioning](http://semver.org/).\r\n\r\nThe format is based on [Keep a Changelog](http://keepachangelog.com/).\r\n\r\n## Version 1.28.0 - 2020-04-23 (part of cds-runtime 1.1.0)\r\n\r\n### Added\r\n\r\n- Support for CREATE operations with delegated key generation\r\n- `@cds.persistence.skip` annotated entities return HTTP code 501 in generic handlers\r\n- introduced @cds.localized:false on entity level for switching off automatic redirection to localized views\r\n- Server-side pagination on global, service, and entity level via `@cds.query.limit`\r\n- Omitted key predicates of nested composition items are augmented, if possible\r\n- The exclusive lock of a draft automatically times out after 15 minutes\r\n- Static where annotations for RUD\r\n- Associations to one annotated with `@assert.integrity: false` are ignored on integrity checks\r\n- Support input validation annotations in ODATA\r\n\r\n### Changed\r\n\r\n- Per default, results are now ordered by keys\r\n- object notation in .where of statements does not allow functions anymore\r\n- context.diff() ignores `@cds.persistence.skip` annotated entities\r\n- always try to read from localized view (also by draft enabled entities)\r\n- In multitenant scenario, the CSN model is now always loaded from `@sap/cds-mtx`. Previously, it was only loaded if it was extended.\r\n\r\n### Fixed\r\n\r\n- Reference integrity checks for foreign entities without stored keys\r\n- Calculation of HasActiveEntity\r\n- Update and Delete with where annotations\r\n- Aliases by navigation with complex where annotation\r\n- `req._.res` is express' ServerResponse\r\n- SQL Error in case of `$filter` using `ne` operator in combination with `$search`\r\n- Deep update with immutable fields in child entities\r\n- Draft union scenario in case of DraftAdministrativeData navigation\r\n- Transaction handling inside $batch requests\r\n- Multiple aliases in SELECT.columns\r\n- `$filter` with `not` operator\r\n\r\n## Version 1.27.1 - 2020-03-23\r\n\r\n### Fixed\r\n\r\n- Alias was added twice to CQN in case of a request including navigations on a draft enabled entity\r\n- Duplicate entries in result in case of `expand-to-many`\r\n- Deep Insert with backlinks as keys\r\n\r\n## Version 1.27.0 - 2020-03-19\r\n\r\n### Added\r\n\r\n- Transaction uses one timestamp for all queries\r\n- Pool acquire timeout is set by default and can be configured in pool options\r\n- Ordered OData singletons (`... as select from <entity> order by <property>`)\r\n\r\n\r\n### Changed\r\n\r\n- $count=true triggers handlers only once now\r\n- `draftPrepare` action can be called on the entity set of child nodes of the draft enabled entity\r\n- Normalize user.id if an email address\r\n- Allow functions and properties as 2nd param in contains, startswith, endswith\r\n\r\n### Fixed\r\n\r\n- Entity is now correctly resolved if there are conflicting names\r\n- Where conditions from security annotations were appended twice when using $count=true\r\n- `req._.req` always contains the incoming request - also in `$batch` requests\r\n- Error in delete when fields are renamed in views\r\n- Using view by draft & localized\r\n- context.diff() returns changes also for `PATCH` of drafts\r\n- OData requests using `/$count` on navigation-to-many\r\n- Authentication-requirement detected if in multi tenant mode (i.e., `multiTenant: true`)\r\n- Integrity check of atomicity group\r\n- Where annotation in case of draft and navigations\r\n- `/$count` on parameterized views\r\n- Streaming from draft in case localized and where annotations\r\n- @mandatory: empty strings (whitespaces only = empty) are not allowed\r\n\r\n## Version 1.25.1 - 2020-02-26\r\n\r\n### Fixed\r\n\r\n- update of localized text entries replies with 403 if no changes are detected\r\n\r\n### Removed\r\n\r\n- `npm-shrinkwrap.json`\r\n\r\n## Version 1.25.0 - 2020-02-25\r\n\r\n### Added\r\n\r\n- Support for OData singletons\r\n- Streaming from draft\r\n- Navigations in aggregate expressions\r\n\r\n### Changed\r\n\r\n- use odata-server 1.5.2\r\n\r\n### Fixed\r\n\r\n- handling of virtual field in column generation\r\n- callstack exceeded in SELECT\r\n\r\n## Version 1.24.1 - 2020-02-21\r\n\r\n### Added\r\n\r\n- Support draft for localized texts (to be enabled by @sap/cds and @sap/cds-compiler)\r\n\r\n## Version 1.24.0 - 2020-02-20\r\n\r\n### Added\r\n\r\n- Support for OData `$apply` with `count distinct`\r\n\r\n### Changed\r\n\r\n- use odata-server 1.5.1\r\n\r\n### Fixed\r\n\r\n- Column generation for `SELECT.from()` queries without specifying `.columns()`\r\n  - `HasDraftEntity` was not properly calculated\r\n  - Virtual properties were not excluded\r\n- Where secure annotations with localized entities\r\n- Handling of `@cds.on.insert/update` annotated properties of draft-enabled entities\r\n- Keys in root element were not correctly calculated for deep operations\r\n- `@Core.MediaType` could not be used in entity annotated with `@cds.persistence.skip` \r\n\r\n### Removed\r\n\r\n- Annotation `@Search.fuzzinessThreshold`\r\n\r\n## Version 1.23.0 - 2020-02-05\r\n\r\n### Added\r\n\r\n- Support non-UUID field as ETags\r\n- Support draft and ETags\r\n- Support for complex where in annotations\r\n- Additional argument `target` for `req.info`\r\n\r\n### Changed\r\n\r\n- Direct access to auto-exposed entities in draft case\r\n- Errors normalized based on OData v4 standard\r\n- Messages (i.e., header `sap-messages`) normalized based on Fiori standard\r\n- Referential integrity checks are now executed before the commit\r\n- Result of create and update queries is read from the data source to include computed values (update: root only, i.e., w/o compositons, etc.)\r\n\r\n### Fixed\r\n\r\n- Race condition when there are erros when saving draft\r\n- Handling of where from @restrict annotation of draft enabled entity\r\n- Saving a draft will not ignore readonly fields anymore\r\n- Not having a connection for unauthorized users will not crash the server anymore\r\n- In mocked authorization, users don't need the `ID` property\r\n- Filtering using the `NE` operator handles null values properly\r\n- For insertable-only entities default values are correctly handled now\r\n- Immutable values are now ignored during PATCH or UPDATE requests\r\n- Batch input via REST\r\n- SELECT * by customer handlers will work also on Hana in case the columns are lowercase\r\n- Support \"userAttributes\" by Mocked Authentication, \"xs.user.attributes\" is deprecated and will\r\nbe removed in the next releases\r\n- Arbitrary users are allowed if fake user '*'= true exist by Mocked Authentication\r\n\r\n## Version 1.22.0 - 2019-12-11\r\n\r\n### Added\r\n\r\n- @sap/cds-ql merged into @sap/cds-services\r\n- Support for subselects and aliasing for remote service definitions\r\n- Support for `@cds.persistence.table`.\r\n- Actions/functions support $select and $expand query params in odata\r\n- Support cds annotation on insert and update with # (e.g @cds.on.update: #user)\r\n\r\n### Changed\r\n\r\n- Improve error messages for return type validation of custom operations\r\n- Draft removal is handled in `onDraftActivateEvent` instead of `onDraftActivate`\r\n\r\n### Fixed\r\n\r\n- Check whether service requires authentication\r\n- Independent passport configs per service\r\n\r\n## Version 1.21.2 - 2019-12-03\r\n\r\n### Fixed\r\n\r\n- Default values for patch\r\n\r\n## Version 1.21.1 - 2019-11-29\r\n\r\n### Added\r\n\r\n- Authentication strategy debug messages and error messages for erroneous authentication configurations\r\n\r\n### Fixed\r\n\r\n- Transform redirect properties in post processing\r\n\r\n## Version 1.21.0 - 2019-11-19\r\n\r\n### Added\r\n\r\n- Support for reading temporal data on HANA\r\n- Support ETag at odata-v4\r\n\r\n### Fixed\r\n\r\n- Key generation in deep update\r\n- Reading `DraftAdministrativeData` of an active entry without existing draft\r\n\r\n## Version 1.20.1 - 2019-10-30\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-ql to 1.20.1\r\n\r\n## Version 1.20.0 - 2019-10-29\r\n\r\n### Added\r\n\r\n- `req.method` property which contains the HTTP method\r\n- Return type validation for custom operations in rest\r\n- Support for redirected media properties using `@Core.IsURL`\r\n\r\n### Fixed\r\n\r\n- Requests to `$metadata`\r\n\r\n### Removed\r\n\r\n- `npm-shrinkwrap.json`\r\n- `req._.isPatch`\r\n\r\n## Version 1.19.1 - 2019-10-16\r\n\r\n### Changed\r\n\r\n- Improved error messages\r\n\r\n### Fixed\r\n\r\n- Empty user attributes in where conditions\r\n- Queries in custom handler executed twice\r\n\r\n## Version 1.19.0 - 2019-10-02\r\n\r\n### Added\r\n\r\n- Check of source for navigation-to-one in not Draft case\r\n- log function in default logger\r\n\r\n### Changed\r\n\r\n- Improved error messages\r\n- Use `@sap/odata-server@1.3.8`\r\n\r\n### Fixed\r\n\r\n- Draft service having column names from draft admin table\r\n- POST and PUT on views with renaming and excluding\r\n- Draft with custom `oncond` in backlink\r\n- Batch with multitenancy\r\n\r\n## Version 1.18.2 - 2019-09-19\r\n\r\n### Changed\r\n\r\n- Use `@sap/odata-server@1.3.7`\r\n\r\n## Version 1.18.1 - 2019-09-18\r\n\r\n### Added\r\n\r\n- Support of authorization restrictions with simple static where clauses (e.g. `$user.level = 3`) for actions/functions\r\n\r\n### Fixed\r\n\r\n- Draft activation by multiple views\r\n- Binary processing in rest adapter\r\n\r\n## Version 1.18.0 - 2019-09-09\r\n\r\n### Added\r\n\r\n- Support for `@assert.enum` annotation\r\n- Support for media content-type provided as property\r\n- Support for binary encoding in rest\r\n\r\n### Changed\r\n\r\n- Use `@sap/odata-server@1.3.5`\r\n\r\n### Fixed\r\n\r\n- READ with `@cds.api.ignore` annotation\r\n- Navigation on Entities with multiple keys did not work correctly\r\n- UPDATE and UPSERT requests with `@cds.on.update` and `@cds.on.insert` annotations\r\n- Logging of missing permissions if no authentication strategy is detected\r\n\r\n## Version 1.17.0 - 2019-08-21\r\n\r\n### Added\r\n\r\n- Error handling for streaming\r\n- Limited support for CREATE requests via navigations\r\n- Method `.transaction` to local client\r\n\r\n### Changed\r\n\r\n- CREATE with WHERE restriction is supported only with static checks, otherwise rejected\r\n- Extended error logs from custom handlers\r\n- `next()` returns the result of the subsequent handler\r\n- Use `@sap/cds-messaging` for sending/receiving events between services\r\n\r\n### Fixed\r\n\r\n- Expand entity with where restriction when clause references a user attribute with multiple values\r\n- Navigations in `get` requests using `cds.String` as key type\r\n- Deletion of active entries during draft activation\r\n- Checking security annotations in service and in entities\r\n- UUID generation for deep inserts/updates\r\n- Combination of `localized data` and `$count=true` in OData requests\r\n- `req.query` in case of bound actions and reached via navigation\r\n\r\n## Version 1.16.0 - 2019-07-23\r\n\r\n### Added\r\n\r\n- Batch Update in REST Adapter using an Array as request body\r\n- Content-Type for streaming using annotation\r\n- `DELETE` requests on an entity property sets the property to `null`\r\n- Integrity check for `DELETE` requests\r\n\r\n### Changed\r\n\r\n- Behaviour of mock authentication according to documentation\r\n- `cds.env` is used by authentication if passport not provided in options\r\n\r\n### Fixed\r\n\r\n- Draft actions for localized entities\r\n- Write localized data via deep update/insert\r\n\r\n## Version 1.15.0 - 2019-07-09\r\n\r\n### Added\r\n\r\n- Support for views with parameters\r\n- Support for `filter` transformation in `$apply`\r\n- Support for `/$value` on primitive properties\r\n\r\n### Changed\r\n\r\n- Rest adapter accepts non-modelled data fields in the request payload and exposes them in `req.data`; the fields are\r\n ignored in the generic handlers\r\n- Replaced `@sap/cds-ql` dependency with `uuid`\r\n\r\n### Fixed\r\n\r\n- Custom handlers by extended tenants\r\n- Generic handler lookup if multiple services in one `.cds` file\r\n- `$expand` with instance-based authorization\r\n- `result` parameter in AfterHandler has correct format (not always an array)\r\n  - `CREATE`: the created entity\r\n  - `UPDATE`: the updated entity\r\n  - `DELETE`: undefined\r\n  - for `actions` and `functions` it is the defined return type\r\n- `@cds.on.insert` and `@cds.on.update` could not be used at the same time\r\n- `@cds.on.insert` and `@cds.on.update` in deep insert / update\r\n\r\n## Version 1.14.0 - 2019-06-24\r\n\r\n### Added\r\n\r\n- Alternative mock strategy config\r\n- Support for value ranges annotations for REST adapter\r\n- Multiple authentication strategies\r\n\r\n### Changed\r\n\r\n- Handling of deep insert / update for associations\r\n- Use `@sap/odata-server@1.3.4`\r\n\r\n### Fixed\r\n\r\n- Bound actions for draft-enabled entities\r\n- Combination of `$apply` with other query parameters\r\n\r\n### Removed\r\n\r\n- Caching of metadata as odata already does it\r\n\r\n## Version 1.13.0 - 2019-06-07\r\n\r\n### Added\r\n\r\n- Method `diff` to calculate the actual changes in a `CUD`request or while saving a draft\r\n- Support authorization annotations for actions and functions\r\n- Support for default sort order using `@cds.default.order` or `@odata.default.order`\r\n- Support for writing binary stream through odata\r\n\r\n## Version 1.12.0 - 2019-05-24\r\n\r\n### Added\r\n\r\n- Support for localized in generic handlers (no compositions / associations)\r\n- Handler registration by path for autoexposed and redirected entities\r\n- Support for Rest parametric functions and actions\r\n\r\n### Changed\r\n\r\n- Renamed `Service.with` to `Service.impl`\r\n\r\n### Fixed\r\n\r\n- `falsy` values as default value\r\n- `req.info` in case of draft actions\r\n- Scopes are checked before custom before handlers\r\n\r\n## Version 1.11.1 - 2019-05-16\r\n\r\n### Changed\r\n\r\n- `service.options` is now a public property (previously private as `service._options`)\r\n\r\n## Version 1.11.0 - 2019-05-15\r\n\r\n### Added\r\n\r\n- read-only field annotations validation\r\n- Deactivate ResourceJsonSerializer in production\r\n- Validation for content type in rest adapter\r\n- Support for OData request path expressions Ã  la `Authors/1`\r\n\r\n### Changed\r\n\r\n- Use `@sap/odata-server@1.3.3`\r\n\r\n## Version 1.10.2 - 2019-05-08\r\n\r\n### Added\r\n\r\n- Support for @Capabilities annotations\r\n\r\n### Changed\r\n\r\n- Improved performance by reducing calls to process.nextTick()\r\n\r\n### Fixed\r\n\r\n- Unbound actions and functions in REST\r\n\r\n## Version 1.10.1 - 2019-05-07\r\n\r\n### Added\r\n\r\n- error handling in case mtx errors\r\n\r\n### Changed\r\n\r\n- Handler registration using `.with` (as done in reuse scenarios)\r\n\r\n### Fixed\r\n\r\n- Using `$select=association` in odata-v4 adapter\r\n\r\n## Version 1.10.0 - 2019-05-03\r\n\r\n### Added\r\n\r\n- Support for reading streams in `odata v4`\r\n- Support for batch create in REST adapter\r\n- Support for combination of scopes and instance based authorization checks\r\n- Fiori Draft event `SAVE` as alias for `CREATE` and `UPDATE`\r\n\r\n### Changed\r\n\r\n- Improved performance\r\n\r\n## Version 1.9.0 - 2019-04-16\r\n\r\n### Added\r\n\r\n- 'mock' strategy accepts any user credentials if none configured\r\n- Support for pseudo role 'system-user'\r\n- Additional cases at security annotations\r\n- `sap-statistics=true` as query or header parameter will yield performance statistics\r\n- $top and $skip at rest adapter\r\n\r\n### Changed\r\n\r\n- Handlers for `failed` events must only have the error object as an argument\r\n- Handlers for `succeeded` and `done` events must have no argument at all\r\n- used new function notation in generated CQN\r\n- Reduction of round trips to data source by not using transactional blocks at reading requests\r\n\r\n### Fixed\r\n\r\n- Deep operations in REST adapter\r\n- Draft edit in case one composition has no entries\r\n\r\n## Version 1.8.1 - 2019-04-03\r\n\r\n### Fixed\r\n\r\n- Events are populated through `req.event`\r\n\r\n## Version 1.8.0 - 2019-03-29\r\n\r\n### Added\r\n\r\n- after handlers using `each` or `row` also work with keyword `async`\r\n\r\n### Changed\r\n\r\n- Generic `onCommit` or `onRollback` handlers end the transaction of potentially multiple db sessions in the request\r\ncontext\r\n- Merged client adapter into service\r\n\r\n### Fixed\r\n\r\n- Errors not of type Error are not recognized\r\n- `req.target` in case of a `READ` request of the `DraftAministrativeData` entity\r\n\r\n## Version 1.7.2 - 2019-03-25\r\n\r\n### Added\r\n\r\n- Element/Field annotated with `@mandatory` or `@FieldControl.Mandatory` is treated as not null\r\n- Added 'mock' strategy for passport\r\n- Complex cases at security annotations\r\n- When registering custom handlers for transactional draft events the target property of the `req` parameter now points to the draft\r\n\r\n## Version 1.7.1 - 2019-03-20\r\n\r\n### Fixed\r\n\r\n- Passport is registered correctly in case of `cds.serve('all')`\r\n- User is now set before it is needed\r\n\r\n## Version 1.7.0 - 2019-03-19\r\n\r\n### Added\r\n\r\n- `req.event` contains the type or name of the incoming request\r\n- Support for specifying a `target` in `req.error` and  `req.reject`\r\n- `req.info` to collect info messages in odata-v4. Eventually, they result in the `sap-messages` header.\r\n- Annotation `@Search.fuzzinessThreshold` to configure Fuzzy Search\r\n- Support for Extensibility\r\n- Event handlers for events `succeeded`, `failed` and `done` can be registered at the service event context\r\n- Support for OData `Arithmetic Functions`, `Date and Time Functions`, `String Functions`\r\n\r\n### Changed\r\n\r\n- before handlers are executed in parallel\r\n- `req.error` returns a generic error with all collected errors in `.details`\r\n- passport method is extracted to the package interface\r\n\r\n### Fixed\r\n\r\n- No SQL error in case key is generated by DB like done with sequences\r\n\r\n## Version 1.6.0 - 2019-02-25\r\n\r\n### Added\r\n\r\n- Support for `Lambda operators`\r\n\r\n### Fixed\r\n\r\n- CUD operation with association as key of entity\r\n\r\n## Version 1.5.2 - 2019-02-13\r\n\r\n### Added\r\n\r\n - Support for sql functions lower, upper, trim, length in $filter and $orderby\r\n\r\n### Changed\r\n\r\n- Sync functions at before and after handler are not wrapped in promise anymore\r\n- req.reject does not throw anymore\r\n- @sap/audit-logging only used in case the service is provided via VCAP_SERVICES\r\n- Unknown query parameters are not longer rejected at REST adapter\r\n\r\n### Fixed\r\n\r\n- OData version for $metadata\r\n- Multiple atomicity groups should not share same transaction block\r\n- Brackets in $filter now work correctly\r\n\r\n## Version 1.5.1 - 2019-02-12\r\n\r\n### Changed\r\n\r\n- @sap/audit-logging only used in case the service is provided via VCAP_SERVICES\r\n\r\n### Fixed\r\n\r\n- No integrity checks when running without db connection\r\n\r\n\r\n## Version 1.5.0 - 2019-02-07\r\n\r\n### Added\r\n\r\n- Set foreign keys for POST via `navigation-to-many` and modeled with `$self`\r\n- Support `content id` placeholders in odata v4 batch requests\r\n- Support complex cases at security annotations\r\n\r\n### Changed\r\n\r\n- Referential integrity checks do not run for associations with specified on conditions\r\n- Rest adapter now ignores query parameters\r\n- Minimum node version 8.9.0\r\n- `.data` and `.query` can be overwritten\r\n\r\n### Fixed\r\n\r\n- Insert with excluded properties having default values\r\n- Delete active documents in a draft-enabled service without a draft\r\n- Path segment `/$count` respects `$filter`\r\n\r\n## Version 1.4.0 - 2019-01-22\r\n\r\n### Added\r\n\r\n- When registering service handlers, entities can be given as a list\r\n- Support requests to /SiblingEntity in draft\r\n- Annotation `@cds.integrity.skip` to disable reference integrity checks (experimental!)\r\n\r\n### Changed\r\n\r\n- Replaced @sap/odata-v4 by @sap/odata-server\r\n\r\n## Version 1.3.0 - 2019-01-11\r\n\r\n### Added\r\n\r\n- Authorization filtering and user attributes as lists\r\n- Referential integrity checks\r\n\r\n### Fixed\r\n\r\n- No fallback for user identifier in case the user object is empty\r\n- Reading draft administrative data\r\n\r\n## Version 1.2.0 - 2018-12-21\r\n\r\n### Added\r\n\r\n- Set default values in case of CREATE, UPSERT and adding a child in deep documents\r\n\r\n### Changed\r\n\r\n- `context.draftMetadata` contains draft metadata\r\n- `context.isDraftChange` indicates only changes in drafts\r\n- Error messages to be more consistent\r\n\r\n### Fixed\r\n\r\n- On handler registration for custom handlers in draft\r\n- Draft children can be deleted without navigations\r\n- Reading all draft-enabled documents takes into account only own drafts\r\n\r\n### Removed\r\n\r\n## Version 1.1.0 - 2018-12-12\r\n\r\n### Added\r\n\r\n- Deep Document Calls (deep insert, deep update and cascade delete)\r\n- `context.draft` contains draftUUID in case of Create, Update or Delete\r\n- filter and orderby with navigation\r\n\r\n### Changed\r\n\r\n- improved error messages\r\n\r\n- Activating a draft now triggers the 'UPDATE' or 'CREATE' event\r\n\r\n### Fixed\r\n\r\n- Create Draft uses default values\r\n- draftActivate uses correct keys for update\r\n- $count in draft context now calculates correct result\r\n- db view with select\r\n- Support for navigation over draft with count\r\n- .code property of Errors in Custom handlers will not be overwritten\r\n\r\n## Version 1.0.0 - 2018-11-27\r\n\r\n### Added\r\n\r\n- Support for now function in $filter\r\n- Support for authorization annotations CREATE, UPDATE, DELETE\r\n- Conversion of cds.DateTime/Timestamp using UTC\r\n- Entity definition at service as select view\r\n\r\n### Changed\r\n\r\n- Update entry makes insert if the entry doesn't exist\r\n- Log messages are used directly instead of being wrapped\r\n- Bound functions now have a query value\r\n- Function next is implicitly executed in synchronous on-handlers\r\n- Improved error handling\r\n- Handler registration allows following variations:\r\n    - Array of events: e.g. ['READ', 'UPDATE']\r\n    - '*' wildcard for any entity event\r\n- next() throws error if called twice in same handler\r\n- Custom implementation must be provided via .with\r\n- Renamed service.definition to service.model\r\n- Renamed service.service to service.name\r\n- updated odata-v4 version to 1.8.0\r\n- Location header for draft actions is now relative\r\n\r\n### Fixed\r\n\r\n- POST on existing entity throws 'Bad Request'\r\n- $search and $filter in combination with some read draft cases\r\n- POST with navigation does not create a new key\r\n- Access restriction on service level\r\n- UPDATE sql statement generated wrong for entity with multiple keys\r\n- Access to user's locale\r\n- draftEdit action on entities without children\r\n- CREATE with not nullable elements\r\n\r\n## Version 0.12.0 - 2018-10-17\r\n\r\n### Added\r\n\r\n- Custom handlers can be registered and executed for bound functions and function imports\r\n- Added BeforeCreate and BeforeCreateDraft handlers to generate needed UUIDs\r\n\r\n### Changed\r\n\r\n- Removed translator in the insert based on where by instanced based authorization\r\n- Removed internal event rejections\r\n- Not found error message generalized for reading through navigation\r\n- Refactoring and changes due to updated dependencies\r\n\r\n## Version 0.11.0 - 2018-10-04\r\n\r\n### Added\r\n\r\n- Generic support for Create, Update, Delete on draft-enabled entities\r\n- Generic support for draftEdit, draftPrepare, draftActivate actions\r\n- Logger is available in handlers via context.log\r\n\r\n### Changed\r\n\r\n- Log warning if database connection is missing\r\n\r\n### Fixed\r\n\r\n- Service requests now return promises instead of thenables\r\n\r\n## Version 0.10.1 - 2018-09-18\r\n\r\n### Added\r\n\r\n- Generic support for Read on draft-enabled entities\r\n\r\n### Fixed\r\n\r\n- $user annotation works without authorization\r\n\r\n## Version 0.10.0 - 2018-09-17\r\n\r\n### Added\r\n\r\n- Delete Draft\r\n- Audit Logging of GDPR related events\r\n- Auto lookup of to be used CF/XSA services from environmental VCAP_SERVICES\r\n- OData to context.query for nested $filter, $orderby, $op and $skip at $expand\r\n- Custom types on top of associations\r\n\r\n### Changed\r\n\r\n- Default for maxPageSize increased to 1000 from 100\r\n\r\n### Fixed\r\n\r\n- Values for annotated columns (user/now) are included in the response\r\n\r\n## Version 0.9.2 - 2018-09-05\r\n\r\n### Changed\r\n\r\n- Improved npm-shrinkwrap\r\n\r\n## Version 0.9.1 - 2018-09-03\r\n\r\n### Added\r\n\r\n- Create draft\r\n\r\n### Removed\r\n\r\n- implicit dependency to @sap/cds-sql\r\n\r\n## Version 0.9.0 - 2018-08-28\r\n\r\n### Added\r\n\r\n- API to support the implementation of authorization restrictions\r\n- Local service client\r\n- Support for to-one-navigation in $filter\r\n- Support for annotation `@Search.defaultSearchElement` to restrict searchable columns in `$search`\r\n- Support for sap-language query parameter\r\n- Support authorization annotations\r\n- Hooks to add custom logic before and after rollback event\r\n- Audit Logging of security events\r\n\r\n### Fixed\r\n\r\n- Pagination in case of $expand\r\n- $select with managed associations as key\r\n\r\n## Version 0.8.1 - 2018-08-09\r\n\r\n### Added\r\n\r\n- Authentication using passport (including user/attr proxy)\r\n\r\n### Changed\r\n\r\n- Require submodules on demand\r\n\r\n## Version 0.8.0 - 2018-08-07\r\n\r\n### Added\r\n\r\n- OData Service: $search supports Unary and Binary Expressions without brackets\r\n- Registration of global handler using star symbol like \"this.on('*', () => {})\"\r\n- Registration of express middleware using this.use()\r\n- Improved FeautureNotSupported error message\r\n- context.reject supported for before, on and after handlers\r\n<!-- Was never documented publicly: - Support of context.run().then.run() shortcut -->\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/odata-v4 to ^1.6.0\r\n\r\n### Fixed\r\n\r\n- Localization in case language is changed\r\n- Issue with not working $count when filtering active in custom hook\r\n\r\n## Version 0.7.0 - 2018-07-11\r\n\r\n### Added\r\n\r\n- Localization support for $metadata\r\n- Support for Compositions\r\n\r\n### Fixed\r\n\r\n- $search also considers foreign keys of managed associations, structured elements and complex types\r\n\r\n## Version 0.6.0 - 2018-07-02\r\n\r\n### Added\r\n\r\n- Multi tenancy support\r\n\r\n### Fixed\r\n\r\n- Columns are only added once to CQN in case of $expand in combination with $select\r\n\r\n## Version 0.5.0 - 2018-06-25\r\n\r\n### Added\r\n\r\n- Hooks\r\n  - An any handler can be registered and will be executed for any but COMMIT events\r\n  - Custom handlers can be registered for before COMMIT and after COMMIT events\r\n  - \"_\" property added to cds handler argument, which can contain adapter specific data like a request object\r\n\r\n- OData Service\r\n  - $filter supports (not) contains, startsWith, endsWith\r\n  - $filter supports combinations with and/or\r\n  - $select within $expand\r\n  - $apply supported with limited scope\r\n  - $search supported with limited scope\r\n\r\n### Changed\r\n\r\n- Hooks\r\n  - Undocumented OData specific properties removed from \"cds\" handler argument\r\n  - cds.target contains the unreflected entity instead of the reflected entity\r\n  - cds.error will collect errors and throw at the end of each block of .before, .on or .after handlers\r\n  - Second call to next() at a on handler will be ignored and not break the sequence\r\n\r\n### Fixed\r\n\r\n- Support navigation over entities with multiple keys\r\n\r\n### Removed\r\n\r\n- In case of a SerializationError the details are only logged and not provided in the response anymore\r\n\r\n## Version 0.4.1 - 2018-05-03\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-ql to 0.4.1\r\n\r\n## Version 0.4.0 - 2018-05-02\r\n\r\n### Added\r\n\r\n- service factory\r\n- cds used via injection\r\n\r\n- Hooks\r\n  - Support annotations @insertonly and @readonly\r\n  - Support reject registration for CSN entities\r\n  - Support reject registration with multiple entity parameters\r\n\r\n### Changed\r\n\r\n- default logger uses matching methods from console object instead of console.log\r\n- packages are loaded on demand at Services.js and OData.js instead of required in any case\r\n- adapted error message in case of 501\r\n\r\n## Version 0.3.0 - 2018-04-16\r\n### Added\r\n\r\n- service factory\r\n  - service.entities is set\r\n\r\n- OData Service\r\n  - Support for $expand=*\r\n  - Support for $select=*\r\n\r\n- Hooks\r\n  - CSN entities can be used instead of strings to register a handler\r\n  - .on can be registered with CQN instead of function as handler\r\n  - .on supports registering N handlers\r\n  - .on handlers can use a second argument next()\r\n  - .on can be finished by returning a value\r\n  - .after with convenience wrappers for each|row argument\r\n  - .after can now work asynchronously\r\n\r\n\r\n### Changed\r\n\r\n- server side paging is enabled by default and set to 100, to disable it set maxPageSize to false.\r\n\r\n- refactored service factory\r\n  - removed option to compile CSN on the fly, only CSN accepted as input format\r\n  - option to set the URL path is removed\r\n  - Multi service CSN can be used\r\n\r\n- refactored Service class\r\n  - OData service instantiation is now split in constructor, createODataService and getMiddleWare\r\n\r\n- OData Service\r\n  - Renamed parameters in handler context object (target replaces entity and getEntity)\r\n  - More expressive error messages\r\n  - Crash Node.js instance on unhandled error\r\n\r\n### Fixed\r\n\r\n- limit property is only added to CQN if necessary\r\n- .reply() is able to handle null values\r\n\r\n## Version 0.2.0 - 2018-03-16\r\n### Added\r\n\r\n- option to enable debug mode for odata-v4\r\n- default logger with option to register custom logger\r\n- support for server side paging\r\n- support for cds.serve, which is a Fluent API-style method to read service definitions from the given model(s) and construct services\r\n- usage of npm-shrinkwrap\r\n\r\n### Fixed\r\n\r\n- $filter in combination with to many association\r\n"},{"name":"CHANGELOG_cds-sql.md","content":"# Changelog\r\n\r\nAll notable changes to this project will be documented in this file.\r\n\r\nThis project adheres to [Semantic Versioning](http://semver.org/).\r\n\r\nThe format is based on [Keep a Changelog](http://keepachangelog.com/).\r\n\r\n## Version 1.25.0 - 2020-04-23 (part of cds-runtime 1.1.0)\r\n\r\n### Changed\r\n\r\n- If a column or column alias is used multiple times in a SELECT query, the query is from now on rejected.\r\nExample: SELECT.from(Foo).columns(['c1', 'c1'])\r\n\r\n### Fixed\r\n\r\n- Mapping over a result will propagate $count\r\n- Don't ignore rows with `null` column values in negated `$search` queries\r\n\r\n## Version 1.24.0 - 2020-03-19\r\n\r\n### Added\r\n\r\n- Support for different columns combinations in INSERT.entries\r\n- Support for $count in SELECT CQN\r\n- Support String objects in the annotation expressions\r\n- .setTransactionTimestamp in BaseClient\r\n- check for @cds.persistence.skip for deep operations\r\n\r\n### Changed\r\n\r\n- Use || for concat (works for HANA and sqlite)\r\n\r\n### Fixed\r\n\r\n- Using view by draft & localized \r\n- Quote alias in orderBy to work on HANA\r\n- Expand from not draft enabled entity to draft enabled entity\r\n- `where` and `orderBy`clauses containing navigations in combination with expand are correctly translated to SQL\r\n\r\n## Version 1.23.2 - 2020-02-25\r\n\r\n### Fixed\r\n\r\n- Missing alias for orderBy caused column ambiguously defined error\r\n\r\n## Version 1.23.1 - 2020-02-21\r\n\r\n### Added\r\n\r\n- Support for set and data in UPDATE CQN\r\n- Support draft for localized texts \r\n- Support for with and data in UPDATE CQN\r\n\r\n## Version 1.23.0 - 2020-02-19\r\n\r\n### Changed\r\n\r\n- Convert all search queries using `contains` to `like`\r\n\r\n### Fixed\r\n\r\n- Searching for `_` or `%` in `$search`\r\n\r\n## Version 1.22.0 - 2020-02-05\r\n\r\n### Changed\r\n\r\n- Managed fields are not removed anymore if they dont belong to operation (e.g. modifiedAt in INSERT, createdAt in UPDATE)\r\n- `null` is a valid value for a managed field (e. g. if `null` is provided for `@cds.on.insert`, `null` will be inserted to DB)\r\n\r\n### Fixed\r\n\r\n- Expand with composition to one for draft enabled entity\r\n\r\n## Version 1.21.0 - 2019-12-10\r\n\r\n### Fixed\r\n\r\n- post-processing for columns with function calls\r\n\r\n## Version 1.20.1 - 2019-11-29\r\n\r\n- Error message when ambiguous naming of alias and entity property occurs in SELECT query\r\n\r\n### Changed\r\n\r\n- Minor improvements\r\n\r\n## Version 1.20.0 - 2019-11-19\r\n\r\n### Fixed\r\n\r\n- Managed fields were not generated when values are null\r\n- Read of active entity with navigation and orderBy with draft specific column (e.g `HasActiveEntity`)\r\n\r\n## Version 1.19.1 - 2019-10-30\r\n\r\n### Fixed\r\n\r\n- Expand adding foreign keys twice\r\n\r\n## Version 1.19.0 - 2019-10-29\r\n\r\n### Changed\r\n\r\n- Improved deep update\r\n\r\n### Removed\r\n\r\n- `npm-shrinkwrap.json`\r\n\r\n## Version 1.18.1 - 2019-10-16\r\n\r\n### Fixed\r\n\r\n- Problems with deep update of a composition of one\r\n- Unhandled promise rejections by expand\r\n\r\n## Version 1.18.0 - 2019-10-02\r\n\r\n### Fixed\r\n\r\n- Problems with backlinks with custom on condition\r\n\r\n## Version 1.17.1 - 2019-09-18\r\n\r\n### Changed\r\n\r\n- Improved error messages\r\n- Improves SQL Builder for `.where` clauses\r\n\r\n## Version 1.17.0 - 2019-09-09\r\n\r\n### Fixed\r\n\r\n- Expand-to-one in draft context\r\n- Expand with multiple orderby elements using window function\r\n- `UUID` generation for `INSERT` statements\r\n\r\n## Version 1.16.0 - 2019-08-21\r\n\r\n### Fixed\r\n\r\n- Missing sub-select columns in case of UNIONs (e.g. when expanding on the DraftAdminTable)\r\n- UUID generation in custom built deep inserts/updates\r\n\r\n## Version 1.15.0 - 2019-07-23\r\n\r\n### Added\r\n\r\n- `getDraftCompositionTree` to get draft specific composition tree\r\n\r\n### Fixed\r\n\r\n- Deep Operations with custom on-Condition without backlink\r\n\r\n## Version 1.14.0 - 2019-07-09\r\n\r\n### Fixed\r\n\r\n- Combination of `expand` with instance-based authorization\r\n\r\n## Version 1.13.0 - 2019-06-24\r\n\r\n### Added\r\n\r\n- Struct Mapper checks subselect for matching columns\r\n\r\n## Version 1.12.0 - 2019-05-24\r\n\r\n### Changed\r\n\r\n- Deep insert/update for to-many associations is not allowed\r\n\r\n### Fixed\r\n\r\n- Property mapper now works for fully-specified columns in SELECT statements\r\n\r\n## Version 1.11.1 - 2019-05-16\r\n\r\n### Fixed\r\n\r\n- Cases with multiple brackets during `onCond` generation\r\n\r\n## Version 1.11.0 - 2019-05-15\r\n\r\n### Fixed\r\n\r\n- Annotate elements with both `@cds.on.insert` and `@cds.on.update`\r\n\r\n## Version 1.10.0 - 2019-05-03\r\n\r\n### Added\r\n\r\n- Support for composition to-one using `$self`\r\n- Service functions `update`, `read`, `insert`, `delete` and `create`\r\n\r\n### Fixed\r\n\r\n- Expand with compound keys and orderby where order column is not requested\r\n- Deeply nested expands\r\n\r\n## Version 1.9.0 - 2019-04-16\r\n\r\n### Fixed\r\n\r\n- Cascading `Delete CQN` generation in case of transitive model\r\n\r\n## Version 1.8.0 - 2019-03-29\r\n\r\n### Changed\r\n\r\n- Minor improvements\r\n- alphabetical aliases instead of md5 in case of expand\r\n\r\n## Version 1.7.0 - 2019-03-19\r\n\r\n### Added\r\n\r\n- Support for 'list' in function arguments\r\n- Support for ```from: { ref: [] }``` in DeleteBuilder\r\n- Support for Compositions with custom on condition (no and/or)\r\n\r\n### Fixed\r\n\r\n- Expanding of on active draft documents lists without $filter\r\n- Expand of entities with compound key might return duplicate results\r\n\r\n## Version 1.6.0 - 2019-02-25\r\n\r\n### Added\r\n\r\n- Support for 'func' as defined in cqn spec\r\n- Support for 'list' in expressions\r\n- Support for deep insert with recursive entities\r\n\r\n### Changed\r\n\r\n### Fixed\r\n\r\n- Recursion in composition tree\r\n- Added brackets in oncond\r\n- Fixed is null / is not null in oncond\r\n- Falsy values at expanded elements\r\n- Fixed expand with selected column 'IsActiveEntity'\r\n\r\n## Version 1.5.1 - 2019-02-12\r\n\r\n### Added\r\n\r\n- Support for sql functions lower, upper, trim, length in $filter and $orderby\r\n\r\n## Version 1.5.0 - 2019-02-06\r\n\r\n### Added\r\n\r\n- Support for ```INSERT into ... SELECT ...```\r\n\r\n### Changed\r\n\r\n- Minimum node version 8.9.0\r\n- Improve expand performance\r\n\r\n## Version 1.4.0 - 2019-01-22\r\n\r\n### Added\r\n\r\n- Construct SQLs from CQN which includes placeholder\r\n- Support draft scenario 'Locked by another user'\r\n\r\n## Version 1.3.0 - 2019-01-11\r\n\r\n### Added\r\n\r\n- Support for compound keys\r\n\r\n### Changed\r\n\r\n- Improve inline detection\r\n\r\n## Version 1.2.0 - 2018-12-21\r\n\r\n### Added\r\n\r\n- Set default values in case of CREATE, UPSERT and adding a child in deep documents\r\n- Reversed cascade delete\r\n\r\n## Version 1.1.0 - 2018-12-12\r\n\r\n### Added\r\n\r\n- Support Deep Document CQNs\r\n- Support for inline\r\n- Post processing with CQN that uses select *\r\n\r\n### Fixed\r\n\r\n- Expand in combination with left outer joins\r\n\r\n## Version 1.0.3 - 2018-11-27\r\n\r\n### Changed\r\n\r\n- Throw root cause instead of CqnParseError\r\n- Throw root cause instead of SqlError\r\n\r\n### Fixed\r\n\r\n- Binary generated wrong SQL\r\n- Complex CQN with draft and expand for Hana\r\n- Expand modifies copy instead of original CQN\r\n- Expand with missing columns\r\n- Expand in combination with limit\r\n- Post processing of DateTime and Boolean\r\n\r\n## Version 0.12.0 - 2018-10-17\r\n\r\n- Refactoring and changes due to updated dependencies\r\n\r\n## Version 0.11.0 - 2018-10-04\r\n\r\n### Added\r\n\r\n- Expanding of drafts entries at list pages\r\n- Expanding of drafts entries at object pages\r\n\r\n## Version 0.10.0 - 2018-09-17\r\n\r\n### Added\r\n\r\n- Support of now/user annotations in structured type\r\n- Support of expand in combination with contains at where\r\n- Support of LIMIT/OFFSET, ORDER BY and WHERE at expanded items\r\n- Custom types on top of associations\r\n- Support columns: ['*'] at CQN\r\n\r\n## Version 0.9.2 - 2018-09-05\r\n\r\n### Added\r\n\r\n- SQL generation for SELECT statements that include UNION\r\n\r\n### Changed\r\n\r\n- Improved npm-shrinkwrap\r\n\r\n### Fixed\r\n\r\n- Postprocessing breaks without CSN\r\n\r\n## Version 0.9.1 - 2018-08-28\r\n\r\n(Preparation for Release)\r\n\r\n## Version 0.9.0 - 2018-08-28\r\n\r\n### Changed\r\n\r\n- .getColumns includes annotations\r\n- .deploy of BaseClient uses CDS-Compiler to do database setup\r\n\r\n### Fixed\r\n\r\n- SQL generation in case of CREATE statements using structured elements containing managed associations\r\n- Postprocessing of expand to many in plain mode\r\n\r\n## Version 0.8.1 - 2018-08-09\r\n\r\n### Changed\r\n\r\n- Require submodules on demand\r\n\r\n## Version 0.8.0 - 2018-08-07\r\n\r\n### Added\r\n\r\n- Support for exists in combination with expand\r\n- Support column annotations '@cds.on.insert', '@cds.on.update', '@odata.on.insert' and '@odata.on.update'\r\n- Post processing of complex and structured types\r\n- Support for unary and binary expressions in contains\r\n- Support for CQN partials at .where\r\n\r\n### Changed\r\n\r\n- Renamed SELECT.elements to SELECT.columns\r\n- SQL Error provides info about the executed query and values in logs\r\n\r\n### Fixed\r\n\r\n- Deep expands with more than 10 levels\r\n- Expand to composition and further to one association\r\n- Structured types at expand could lead to ambiguity\r\n\r\n## Version 0.7.0 - 2018-07-11\r\n\r\n### Added\r\n\r\n- CREATE supports type cds.Composition\r\n- Expand supports type cds.Composition\r\n- Support for structured elements\r\n\r\n## Version 0.6.0 - 2018-07-02\r\n\r\n### Added\r\n\r\n<!-- Was never documented publicly: - Shortcut for running queries with run().then.run() -->\r\n\r\n### Fixed\r\n\r\n- SQL generation in case of combination of navigation and expand in SELECT statements\r\n\r\n## Version 0.5.0 - 2018-06-25\r\n\r\n### Added\r\n\r\n- custom builders can now be provided via options in SQL Builder\r\n- support create with views\r\n- added SQL Error to hide the internal information from other errors\r\n- support structured elements\r\n- support for complex types in Create Builder\r\n- BaseClient has method .deploy to easily create database artifacts from csn model\r\n- support for SQL function contains by converting it using like\r\n- support execution of blocks of statements\r\n\r\n### Changed\r\n\r\n- quotation in SQL generation is now configurable (default is plain)\r\n- support for latest CQN spec changes\r\n\r\n### Fixed\r\n\r\n- column generation for managed associations\r\n- CREATE statement with managed association as key\r\n- resolve $self for expand\r\n- 1:1 associations can be null\r\n\r\n## Version 0.4.0 - 2018-05-02\r\n\r\n### Added\r\n\r\n- BaseClient has methods .run & .foreach & .isValid\r\n\r\n### Changed\r\n\r\n- support for latest CQN spec changes\r\n\r\n## Version 0.3.0 - 2018-04-16\r\n\r\n### Added\r\n\r\n- support CREATE statements\r\n\r\n### Fixed\r\n\r\n- auto-generated columns in expand=* requests\r\n\r\n## Version 0.2.0 - 2018-03-16\r\n### Added\r\n\r\n- usage of npm-shrinkwrap\r\n\r\n### Changed\r\n\r\n- improved performance for expand in case of one-to-many relations\r\n\r\n### Fixed\r\n\r\n- ambiguous column name when having multiple expands on same entity\r\n"},{"name":"CHANGELOG_cds-sqlite.md","content":"# Changelog\r\n\r\nAll notable changes to this project will be documented in this file.\r\n\r\nThis project adheres to [Semantic Versioning](http://semver.org/).\r\n\r\nThe format is based on [Keep a Changelog](http://keepachangelog.com/).\r\n\r\n## Version 1.24.0 - 2020-03-19\r\n\r\n### Added\r\n\r\n- Single timestamp per transaction\r\n- default timeout 5s for acquiring client from pool\r\n\r\n### Changed\r\n- deleted concat handling (done in cds-sql)\r\n\r\n## Version 1.23.1 - 2020-02-26\r\n\r\n### Removed\r\n\r\n- `npm-shrinkwrap.json`\r\n\r\n## Version 1.23.0 - 2020-02-19\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.23.0\r\n\r\n## Version 1.22.0 - 2020-02-05\r\n\r\n### Added\r\n\r\n- Allow setting the [journal mode](https://www.sqlite.org/draft/pragma.html#pragma_journal_mode) via credentials.journalMode\r\n\r\n### Changed\r\n\r\n- Pool options can once again be overwritten\r\n\r\n## Version 1.21.0 - 2019-12-10\r\n\r\n### Changed\r\n\r\n- Pool options always set to default\r\n\r\n## Version 1.20.1 - 2019-11-29\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.20.1\r\n\r\n## Version 1.20.0 - 2019-11-19\r\n\r\n### Added\r\n\r\n- Conversion of hana's `seconds_between` function to `strftime` for sqlite\r\n\r\n## Version 1.19.1 - 2019-10-30\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.19.1\r\n\r\n## Version 1.19.0 - 2019-10-29\r\n\r\n### Removed\r\n\r\n- `npm-shrinkwrap.json`\r\n\r\n## Version 1.18.1 - 2019-10-16\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.18.1\r\n\r\n## Version 1.18.0 - 2019-10-02\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.18.0\r\n\r\n## Version 1.17.1 - 2019-09-18\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.17.1\r\n\r\n## Version 1.17.0 - 2019-09-09\r\n\r\n### Added\r\n\r\n- Streaming into sqlite\r\n\r\n## Version 1.16.0 - 2019-08-21\r\n\r\n### Changed\r\n\r\n- Signature of the Client's constructor\r\n\r\n## Version 1.15.0 - 2019-07-23\r\n\r\n### Added\r\n\r\n- Support multi tenancy for file based database\r\n\r\n### Fixed\r\n\r\n- Streaming supports `null` values\r\n\r\n## Version 1.14.0 - 2019-07-09\r\n\r\n### Added\r\n\r\n- Named binding parameters\r\n- Support files as db in tenant manager\r\n\r\n## Version 1.13.0 - 2019-06-24\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.13.0\r\n\r\n## Version 1.12.0 - 2019-05-24\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.12.0\r\n\r\n## Version 1.11.1 - 2019-05-16\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.11.1\r\n\r\n## Version 1.11.0 - 2019-05-15\r\n\r\n### Changed\r\n\r\n- Bulk inserts are now traced\r\n\r\n## Version 1.10.0 - 2019-05-03\r\n\r\n### Added\r\n\r\n- Mitigation for loosely typed columns and imported data\r\n- service related functions\r\n- Streaming support via `client.stream()`\r\n\r\n## Version 1.9.0 - 2019-04-16\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.9.0\r\n\r\n## Version 1.8.0 - 2019-03-29\r\n\r\n### Added\r\n\r\n- Support for odata method functions\r\n\r\n## Version 1.7.0 - 2019-03-19\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.7.0\r\n\r\n## Version 1.6.0 - 2019-02-25\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.6.0\r\n\r\n## Version 1.5.1 - 2019-02-12\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 1.5.1\r\n\r\n## Version 1.5.0 - 2019-02-06\r\n\r\n### Changed\r\n\r\n- Minimum node version 8.9.0\r\n- Improve expand performance\r\n\r\n## Version 1.4.0 - 2019-01-22\r\n\r\n### Added\r\n\r\n- `.execute` supports placeholders in CQN\r\n\r\n## Version 1.3.0 - 2019-01-11\r\n\r\n### Changed\r\n\r\n- Use latest version of @sap/cds-sql\r\n\r\n## Version 1.2.0 - 2018-12-21\r\n\r\n### Added\r\n\r\n- Set default values in case of CREATE, UPSERT and adding a child in deep documents\r\n\r\n## Version 1.1.0 - 2018-12-12\r\n\r\n### Added\r\n\r\n- Support Deep Document CQNs\r\n\r\n## Version 1.0.3 - 2018-11-27\r\n\r\n### Added\r\n\r\n- credentials.database can be used instead of parameters host and url\r\n\r\n### Changed\r\n\r\n- Throw db error instead of wrapping it in Sql Error\r\n- Throw an error if database is not defined instead of fallback to memory\r\n\r\n### Fixed\r\n\r\n- Bulk Insert with $user / $now\r\n- Post processing of Binary, Boolean, DateTime and Integer64\r\n\r\n## Version 0.10.0 - 2018-10-17\r\n\r\n- Refactoring and changes due to updated dependencies \r\n\r\n## Version 0.9.0 - 2018-10-04\r\n\r\n### Changed\r\n\r\n- Updated version of @sap/cds-sql to 0.11.0\r\n\r\n## Version 0.8.0 - 2018-09-17\r\n\r\n### Fixed\r\n\r\n- CQN queries with contains and expand (limitation: expanded columns cannot be part of contains)\r\n\r\n## Version 0.7.1 - 2018-09-05\r\n   \r\n### Changed\r\n\r\n- Improved npm-shrinkwrap\r\n\r\n## Version 0.7.0 - 2018-08-28\r\n\r\n### Changed\r\n\r\n- API documentation updated\r\n\r\n## Version 0.6.1 - 2018-08-09\r\n\r\n### Changed\r\n\r\n- Require submodules on demand\r\n\r\n## Version 0.6.0 - 2018-08-07\r\n\r\n### Added\r\n\r\n- cds.Timestamp and cds.DateTime converted into ISO time format when reading\r\n- Support for abstract placeholders #now and #user\r\n\r\n### Fixed\r\n\r\n- SQL error hides internal error messages and provides details in log\r\n\r\n## Version 0.5.0 - 2018-06-25\r\n\r\n### Added\r\n\r\n- support execution of blocks of statements\r\n- support plain mode of SQL name mapping\r\n \r\n### Changed\r\n\r\n - Added SQL Error to hide the internal information from other errors\r\n\r\n### Fixed\r\n\r\n- CDS injection\r\n\r\n## Version 0.4.0 - 2018-05-02\r\n\r\n### Changed\r\n\r\n- connect options aligned to spec\r\n- support for latest CQN spec changes\r\n\r\n## Version 0.3.0 - 2018-04-16\r\n\r\n### Added\r\n\r\n- support CREATE statements\r\n\r\n## Version 0.2.0 - 2018-03-16\r\n\r\n### Added\r\n\r\n- usage of npm-shrinkwrap\r\n\r\n### Changed\r\n\r\n- improved performance"}]},{"name":"lib","nodes":[{"name":"cds-services","nodes":[{"name":"adapter","nodes":[{"name":"odata-v4","nodes":[{"name":"okra","nodes":[{"name":"odata-commons","nodes":[{"name":"uri","nodes":[{"name":"info.md","content":"# Components\r\n\r\n## How to use the UriParser\r\n\r\nThe UriParser takes the EDM provider instance and returns an UriInfo object\r\non calling the `.parse(uri)` method. Each original URI path segment has a\r\ncorresponding UriResource path segment after parsing the URI.\r\n\r\n```js\r\nconst UriParser = require('./lib/uri/UriParser');\r\nconst edm = getEdmProviderInstanceSomehow();\r\nconst uriParser = new UriParser(edm);\r\n\r\nconst uriInfo = uriParser.parseRelativeUri(\r\n    \"/YourEntitySetName(KeyName=1,Key2Name='2')/YourNavigationProperty/AnyProperty\",\r\n    queryOptions);  // only used for aliases\r\n\r\nuriInfo.getPathSegments() // --> [UriResource, UriResource, UriResource]\r\n\r\n// First path segment\r\nconst first = uriInfo.getPathSegments()[0]; // Returns UriResource\r\nfirst.getKind() // --> UriResource.ResourceKind.ENTITY\r\nfirst.getEntitySet() // --> EdmEntitySet\r\nfirst.getKeyPredicates() // --> [UriParameter, UriParameter]\r\nfirst.getKeyPredicates()[1].getValue() // --> '2'\r\nfirst.getKeyPredicates()[1].getEdmRef() // --> Returns the corresponding edm reference object\r\n\r\n// Second path segment\r\nconst second = uriInfo.getPathSegments()[1]; // Returns UriResource\r\nsecond.getKind() // --> UriResource.ResourceKind.NAVIGATION_TO_[ONE|MANY]\r\nsecond.getNavigationProperty() // --> EdmNavigationProperty\r\nsecond.getTarget() // --> The target of the navigation\r\n\r\n// Third path segment\r\nconst third = uriInfo.getPathSegments()[2]; // Returns UriResource\r\nthird.getKind() // --> UriResource.ResourceKind.[PRIMITIVE|COMPLEX|COMPLEX_COLLECTION|...]_PROPERTY\r\nthird.getProperty() // --> EdmProperty\r\n```\r\n\r\n## Filter Query Option\r\n\r\nAccessing the filter query option gets the root node of the filter\r\nexpression tree.\r\n\r\n## Orderby Query Option\r\n\r\nAccessing the orderby query option gets an array of orderby-item objects.\r\nEach of these objects can be queried for the root of its expression tree and\r\nfor the sorting direction.\r\n\r\n## Expand Query Option\r\n\r\nAccessing the expand query option gets an array of expand-item objects.\r\nEach of these objects can be queried for its path segments, whether all\r\nnavigation properties have to be expanded, and for options.\r\n\r\n## Select Query Option\r\n\r\nAccessing the select query option gets an array of select-item objects.\r\nEach of these objects can be queried for its path segments, whether all\r\nproperties have been selected, and whether all operations in a schema\r\nnamespace have been selected (in this case the namespace also can be\r\nretrieved).\r\n\r\n## Search Query Option\r\n\r\nAccessing the search query option gets the root node of the search expression\r\ntree. Three different kinds of nodes are possible: binary-expression nodes\r\n(where only AND and OR operators can occur), unary-expression nodes (where\r\nonly NOT is possible as operator) and literal nodes.\r\n\r\n## Expressions\r\n\r\n### Expression Kinds\r\n\r\nThere are different kinds of expressions. Each kind of expression is\r\nimplemented in a separate class with specialized access methods. But all have\r\na method to get their EDM type.\r\n\r\n### Literal Expression\r\n\r\nA literal expression represents a literal directly written in the expression.\r\n\r\n### Alias Expression\r\n\r\nAn alias expression represents a parameter alias. Written as an at-sign\r\nfollowed by an identifier, it represents a reference to an expression given\r\nas separate query option in the URI. The alias expression has a method to\r\naccess this referenced expression.\r\n\r\n### Unary Expression\r\n\r\nA unary expression represents an OData built-in unary operator.\r\nIts operand (an expression) can be accessed as well.\r\n\r\n### Binary Expression\r\n\r\nA binary expression represents an OData built-in binary operator.\r\nIts left and right operands (also expressions) can be accessed as well.\r\n\r\n### Method Expression\r\n\r\nA method expression represents an OData built-in method. Its parameters\r\n(which can in turn be expressions) can be accessed as well.\r\n\r\n### Member Expression\r\n\r\nA member expression represents a path expression to access, in the easiest\r\ncase, a member property of the entity the expression refers to. It has a\r\nmethod to access the URI resource elements the path consists of.\r\n\r\n### Type Literal Expression\r\n\r\nA type-literal expression represents a type name written literally in the\r\nexpression, used in the built-in type-related methods. A type cast used in\r\na path (member expression) does not result in a type-literal expression.\r\n"}]}]}]}]}]}]}]},{"name":"README.md","content":"# @sap/cds-runtime\r\nThis package is no longer maintained. Use the [@sap/cds](https://www.npmjs.com/package/@sap/cds) instead.\r\n\r\nThe `@sap/cds-runtime` module was the successor of `@sap/cds-services`, `@sap/cds-ql`, `@sap/cds-messaging`, `@sap/cds-rest`, `@sap/cds-hana`, `@sap/cds-sqlite`, and `@sap/cds-sql`. Please note that future development and bug fixes will be provided in the `@sap/cds` module only.\r\n\r\n## License\r\nThis package is provided under the terms of the [SAP Developer License Agreement](https://tools.hana.ondemand.com/developer-license-3.1.txt).\r\n\r\n## Stakeholder Tests\r\n\r\n### MTX\r\n\r\n![](https://travis-ci.cloud.sap.corp/cdx/cds-stakeholder-tests.svg?token=FS8mMMvcpEdBWNZAxHuF&branch=mtx)\r\n"}]