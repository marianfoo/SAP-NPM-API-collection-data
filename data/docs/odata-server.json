[{"name":"CHANGELOG.md","content":"# Change Log\r\n\r\nAll notable changes to this project will be documented in this file.\r\n\r\nThis project adheres to [Semantic Versioning](https://semver.org/).\r\n\r\nThe format is based on [Keep a Changelog](https://keepachangelog.com/).\r\n\r\n## [1.8.3] - 2020-09-23\r\n\r\n## [1.8.2] - 2020-06-17\r\n\r\n### Fixed\r\n- added license file to \"files\" in package.json\r\n\r\n## [1.8.1] - 2020-06-17\r\n\r\n### Added\r\n- license file: developer-license-3.1.txt\r\n\r\n## [1.8.0] - 2020-05-29\r\n\r\n### Added\r\n- support for server-driven paging and next links in expanded navigation properties\r\n- support for $count option in $expand\r\n- allow doublequotes around * in If-Match and If-None-Match headers\r\n\r\n### Changed\r\n- log stacktrace for server errors with level error (#107)\r\n\r\n### Fixed\r\n- status code 200 OK instead of 304 Not Modified for GET requests without If-None-Match header (#106)\r\n- $expand with complex-property path\r\n\r\n## [1.7.1] - 2020-04-21\r\n\r\n### Fixed\r\n- ETags are never required for transient entities from $apply queries\r\n\r\n## [1.7.0] - 2020-04-16\r\n\r\n### Added\r\n- support for navigation properties in complex properties\r\n\r\n### Fixed\r\n- context URL in some edge cases with keys\r\n\r\n## [1.6.1] - 2020-03-31\r\n\r\n### Fixed\r\n- support for JSON content in type-definition properties with underlying type Edm.Stream (#97)\r\n\r\n## [1.6.0] - 2020-03-25\r\n\r\n### Added\r\n- limited support for JSON content in stream properties as described in OASIS issue 1177\r\n\r\n## [1.5.5] - 2020-03-11\r\n\r\n### Added\r\n- If-Match and If-None-Match headers are allowed with value * on POST requests (#86)\r\n\r\n## [1.5.4] - 2020-03-06\r\n\r\n### Fixed\r\n- stricter determination of related entity set\r\n\r\n## [1.5.3] - 2020-03-04\r\n\r\n### Added\r\n- If-Match and If-None-Match headers are allowed with value * on non-conditional DELETE requests (#86)\r\n\r\n## [1.5.2] - 2020-02-21\r\n\r\n### Fixed\r\n- handling of Path for navigation-property binding and EntitySetPath for bound actions and functions (#84)\r\n\r\n## [1.5.1] - 2020-02-12\r\n\r\n### Fixed\r\n- ensure fixed version numbers of dependencies (#79)\r\n\r\n## [1.5.0] - 2020-02-11\r\n\r\n### Added\r\n- support for node.js version 12\r\n- complete support of specified Unicode range in URI parsing of identifiers\r\n- URI parsing of search words according to OData 4.01 CS02\r\n\r\n### Fixed\r\n- ensure non-null field `code` in error responses\r\n\r\n### Removed\r\n- support for node.js version 8 due to its end of life\r\n\r\n## [1.4.1] - 2020-01-31\r\n\r\n### Fixed\r\n- If-Match and If-None-Match headers are allowed with value * on non-conditional PUT/PATCH requests (for upsert) (#50)\r\n- If-Match header with value * is allowed for all GET requests\r\n- allow annotations `@odata.type` in requests if they match the types specified in the metadata\r\n\r\n## [1.4.0] - 2020-01-14\r\n\r\n### Added\r\n- support for EDM singletons\r\n\r\n### Fixed\r\n- documentation: actions and functions are supported (#68)\r\n\r\n## [1.3.9] - 2019-10-28\r\n\r\n### Fixed\r\n- removed @odata.metadataEtag annotation in JSON responses (with exception of the service-document)\r\n- additional notice regarding IEEE754Compatible content-type parameter in error messages if necessary\r\n\r\n## [1.3.8] - 2019-10-01\r\n\r\n### Added\r\n- support for annotations `@odata.mediaEditLink` and `@odata.mediaReadLink` in entity serialization\r\n\r\n## [1.3.7] - 2019-09-19\r\n\r\n### Fixed\r\n- npm-shrinkwrap.json remains unchanged during xmake build\r\n\r\n## [1.3.6] - 2019-09-18\r\n\r\n### Fixed\r\n- result type of $apply with aliases for custom aggregates (#49)\r\n\r\n## [1.3.5] - 2019-09-02\r\n\r\n### Fixed\r\n- serialization of navigation properties for concat transformations in $apply\r\n- HEAD requests with valid if-none-match header on the ServiceDocument return 304 Not Modified\r\n\r\n## [1.3.4] - 2019-06-18\r\n\r\n## [1.3.3] - 2019-05-08\r\n\r\n### Added\r\n- support in URI resource-path parsing for key-as-segment convention\r\n\r\n## [1.3.2] - 2019-04-26\r\n\r\n## [1.3.1] - 2019-04-23\r\n\r\n## [1.3.0] - 2019-04-23\r\n\r\n### Added\r\n- preliminary optional switch to use non-validating serializer (not yet stable API)\r\n\r\n### Fixed\r\n- context URL for $select with same property more than once\r\n\r\n## [1.2.1] - 2019-04-12\r\n\r\n### Added\r\n- support for batch requests and responses in JSON format as defined in OData version 4.01\r\n- parallel processing of batch requests\r\n- encoder for primitive values used in serializing made a component that can be overridden\r\n\r\n### Fixed\r\n- improved serializing performance\r\n\r\n## [1.2.0] - 2019-03-29\r\n\r\n### Added\r\n- advertisement for operations\r\n\r\n## [1.1.0] - 2019-03-15\r\n\r\n### Added\r\n- Deserialization of delta payloads and deep updates\r\n- Adaption of Oasis Issue 1221: If Oasis CSDL JSON Specification version 4.01-CS02 is found,\r\n  all annotations expressions based on string values will lead to an error\r\n\r\n## [1.0.1] - 2019-01-21\r\n\r\n## [1.0.0] - 2019-01-15\r\n\r\n- first release version of the new odata-server module\r\n- CSDL provider to provide your OData EDM model via the JSON format\r\n- annotations in metadata\r\n- basic cross service referencing\r\n- content negotiation\r\n- support for request Prefer header and response Preference-Applied header\r\n- support for request Accept-Charset header\r\n- URI resource-path parser\r\n- parsers for the system query options $filter, $orderby,\r\n  $expand (also in combination with query options for expanded entities), $select,\r\n  $search, $format, and $apply\r\n- dispatching of requests to handler methods\r\n- support for metadata requests with automatic metadata ETag and the possibility to\r\n  use a custom metadata handler for locale-specific metadata\r\n- read scenarios like read EntityCollection, read Entity, read navigation between entities\r\n  (including containment navigation), read EntitySet(Key)/property\r\n  (primitive property, complex property, and their collections), read function imports,\r\n  and read bound functions\r\n- CRUD entity and property requests (primitive, complex, and collection properties),\r\n  including linking with existing entities via bind operations and deep inserts\r\n- upsert requests (PUT/PATCH on entity set with key and navigation to many with key)\r\n- server-driven paging\r\n- CRUD operations for references (also for references reached via navigation)\r\n- ActionImports and bound actions\r\n- $batch requests (including retrying requests for ChangeSets)\r\n- HEAD requests on the service document\r\n- conditional request handling with ETags\r\n- $apply support for simple aggregate, groupby, filter, compute, identity,\r\n  concat, bottomcount, topcount, orderby, skip, and top transformations\r\n- JSON serialization and deserialization of entities, entity collections, and properties,\r\n  including support for JSON format parameters IEEE754Compatible and ExponentialDecimals,\r\n  built-in Context URI Builder, and automatic odata.metadataEtag annotation\r\n- metadata/annotations in data structure\r\n- instance annotations in JSON serializer\r\n- serialization of primitive-property raw values\r\n- node.js 8.x and 10.x support\r\n- debug view in JSON and HTML formats\r\n- logging/tracing facade\r\n"},{"name":"README.md","content":"OData V4.0 Server Library\r\n=========================\r\n\r\n**Library is deprecated and will not be further developed and maintained.\r\nWe recommend to use the [SAP Cloud application programming model](https://cap.cloud.sap/docs/) to build OData Services instead of the library.**\r\n\r\n## Table of Contents\r\n\r\n- [Overview](#overview)\r\n- [Installation](#installation)\r\n- [Usage](#usage)\r\n- [Supported Requests](#supported-requests)\r\n- [Releases and Milestones](#releases-and-milestones)\r\n\r\n## Overview\r\n\r\nWith the OData server library OData V4.0 services can be implemented based on the\r\n[OASIS OData standard](https://www.oasis-open.org/committees/tc_home.php?wg_abbrev=odata).\r\nThe library can be directly used to build OData services and is also part of\r\nthe SAP Fiori programming model as well the SAP Cloud Platform programming\r\nmodel, where the data model can be defined in CDS (Core data services) and\r\nthe OData service be generated out of the model.\r\n\r\nThe library leaves the freedom to build OData services with any database or\r\npersistence layer. It is also possible to create services that are calling\r\nexternal REST/OData services and mix up the data with your application data.\r\n\r\nThe library is modular and consists of the following main components:\r\n\r\n* EntityDataModel - Define your EDM in JSON format. Our provider creates the\r\n  EDM out of your model and caches EDM model elements\r\n* Handler Dispatcher - Maps requests to handler functions for CRUD operations\r\n* URI parsers - Parse the request URI including the OData system query options\r\n  (like $format, $select, $expand, ...) and validates each URI segment against\r\n  the EDM model and the OData ABNF\r\n* Serializers and Deserializers for the request and response payload.\r\n  The deserializers validate the request payload and support type mapping between\r\n  OData EDM types and JavaScript Types\r\n* Automatic OData Reponse generation based on provided data\r\n* ServiceFactory to create the OData service along with the CRUD handler registration\r\n* Conditional request handling for optimistic concurrency control via ETags\r\n* Batch handling - Batch request parsing, dispatching to single batch requests,\r\n  Content-ID referencing and batch response generation\r\n* Flexible API to support all backends - The service developer has the free\r\n  choice of his backend system (e.g., databases, frameworks, calling additional\r\n  external OData services).\r\n\r\n## Installation\r\n\r\n```sh\r\nnpm install @sap/odata-server\r\n```\r\n\r\n## Usage\r\n\r\nLoad the library:\r\n\r\n```javascript\r\nconst odata = require('@sap/odata-server');\r\n```\r\n\r\nLoad your EDM model:\r\n\r\n```javascript\r\nconst edmModel = require('./<your_edm_model>.json');\r\n```\r\n\r\nCreate the service, set the base path, and register request handlers for\r\nCRUD operations:\r\n\r\n```javascript\r\nconst service = odata.ServiceFactory.createService(edmModel)\r\n    .setBasePath('/serviceroot.svc/')\r\n    .on('create', function create(request, response, next) {...})\r\n    .on('update', function update(request, response, next) {...})\r\n    .on('delete', function delete(request, response, next) {...})\r\n    .on('read', function read(request, response, next) {...});\r\n```\r\n\r\nYou can create an HTTP server locally to test your service:\r\n\r\n```javascript\r\nconst http = require('http');\r\nconst port = 9000;\r\nconst server = http.createServer((req, res) => service.process(req, res))\r\n    .listen(port,\r\n        () => console.log('Server listens on port ' + port + ' - '\r\n            + 'Service URL: http://localhost:' + port + '/serviceroot.svc/'));\r\n```\r\n\r\n## Supported Requests\r\n\r\n### Read Requests Using HTTP GET\r\n\r\n| Resource                      | Request                                                                      |\r\n|:------------------------------|:-----------------------------------------------------------------------------|\r\n| Service root                  | GET http&#58;//host/serviceRoot/                                             |\r\n| Metadata                      | GET http&#58;//host/serviceRoot/metadata                                     |\r\n| EntitySet                     | GET http&#58;//host/serviceRoot/EntitySet                                    |\r\n| EntitySet                     | GET http&#58;//host/serviceRoot/EntitySet/$count                             |\r\n| Entity                        | GET http&#58;//host/serviceRoot/EntitySet(Key)                               |\r\n| References                    | GET http&#58;//host/serviceRoot/EntitySet/$ref                               |\r\n| Reference                     | GET http&#58;//host/serviceRoot/EntitySet(Key)/$ref                          |\r\n| References (related)          | GET http&#58;//host/serviceRoot/EntitySet(Key)/NavigationPropertyToMany/$ref |\r\n| Reference (related)           | GET http&#58;//host/serviceRoot/EntitySet(Key)/NavigationPropertyToMany/$ref |\r\n| Related entity                | GET http&#58;//host/serviceRoot/EntitySet(Key)/NavigationPropertyToOne       |\r\n| Related entities              | GET http&#58;//host/serviceRoot/EntitySet(Key)/NavigationPropertyToMany      |\r\n| Complex property              | GET http&#58;//host/serviceRoot/EntitySet(Key)/ComplexProperty               |\r\n| Complex property collection   | GET http&#58;//host/serviceRoot/EntitySet(Key)/ComplexPropertyCollection     |\r\n| Primitive property            | GET http&#58;//host/serviceRoot/EntitySet(Key)/PrimitiveProperty             |\r\n| Primitive property value      | GET http&#58;//host/serviceRoot/EntitySet(Key)/PrimitiveProperty/$value      |\r\n| Primitive property collection | GET http&#58;//host/serviceRoot/EntitySet(Key)/PrimitivePropertyCollection   |\r\n\r\n### Create/Insert Requests Using HTTP POST\r\n\r\n| Resource                    | Request                                                                       |\r\n|:----------------------------|:------------------------------------------------------------------------------|\r\n| Entity                      | POST http&#58;//host/serviceRoot/EntitySet                                    |\r\n| Deep insert                 | POST http&#58;//host/serviceRoot/EntitySet                                    |\r\n| Entity with bind operations | POST http&#58;//host/serviceRoot/EntitySet                                    |\r\n| Reference                   | POST http&#58;//host/serviceRoot/EntitySet(Key)/NavigationPropertyToMany/$ref |\r\n\r\n### Update Requests Using HTTP PUT/PATCH\r\n\r\n| Resource                      | Request                                                                     |\r\n|:------------------------------|:----------------------------------------------------------------------------|\r\n| Entity                        | PUT/PATCH http&#58;//host/serviceRoot/EntitySet(Key)                        |\r\n| Deep update                   | PUT/PATCH http&#58;//host/serviceRoot/EntitySet(Key)                        |\r\n| Reference                     | PUT http&#58;//host/serviceRoot/EntitySet(Key)/NavigationPropertyToOne/$ref |\r\n| Complex property              | PUT/PATCH http&#58;//host/serviceRoot/EntitySet(Key)/ComplexProperty        |\r\n| Complex property collection   | PUT http&#58;//host/serviceRoot/EntitySet(Key)/ComplexPropertyCollection    |\r\n| Primitive property            | PUT http&#58;//host/serviceRoot/EntitySet(Key)/PrimitiveProperty            |\r\n| Primitive property value      | PUT http&#58;//host/serviceRoot/EntitySet(Key)/PrimitiveProperty/$value     |\r\n| Primitive property collection | PUT http&#58;//host/serviceRoot/EntitySet(Key)/PrimitivePropertyCollection  |\r\n\r\n### Delete Requests Using HTTP DELETE\r\n\r\n| Resource                      | Request                                                                              |\r\n|:------------------------------|:-------------------------------------------------------------------------------------|\r\n| Entity                        | DELETE http&#58;//host/serviceRoot/EntitySet(Key)                                    |\r\n| Reference                     | DELETE http&#58;//host/serviceRoot/EntitySet(Key)/NavigationPropertyToOne/$ref       |\r\n| Reference (to many)           | DELETE http&#58;//host/serviceRoot/EntitySet(Key)/NavigationPropertyToMany(Key)/$ref |\r\n| Complex property              | DELETE http&#58;//host/serviceRoot/EntitySet(Key)/ComplexProperty                    |\r\n| Complex property collection   | DELETE http&#58;//host/serviceRoot/EntitySet(Key)/ComplexPropertyCollection          |\r\n| Primitive property            | DELETE http&#58;//host/serviceRoot/EntitySet(Key)/PrimitiveProperty                  |\r\n| Primitive property value      | DELETE http&#58;//host/serviceRoot/EntitySet(Key)/PrimitiveProperty/$value           |\r\n| Primitive property collection | DELETE http&#58;//host/serviceRoot/EntitySet(Key)/PrimitivePropertyCollection        |\r\n\r\n### Functions Using HTTP GET\r\n\r\n| Resource        | Request                                                                                  |\r\n|:----------------|:-----------------------------------------------------------------------------------------|\r\n| Function import | GET http&#58;//host/serviceRoot/FunctionImport/[Navigation-or-Property-Path]             |\r\n| boundFunction   | GET http&#58;//host/serviceRoot/EntitySet/boundFunction                                  |\r\n| boundFunction   | GET http&#58;//host/serviceRoot/EntitySet(Key)/boundFunction                             |\r\n| boundFunction   | GET http&#58;//host/serviceRoot/EntitySet(Key)/ComplexProperty/boundFunction             |\r\n| boundFunction   | GET http&#58;//host/serviceRoot/EntitySet(Key)/ComplexPropertyCollection/boundFunction   |\r\n| boundFunction   | GET http&#58;//host/serviceRoot/EntitySet(Key)/PrimitiveProperty/boundFunction           |\r\n| boundFunction   | GET http&#58;//host/serviceRoot/EntitySet(Key)/PrimitivePropertyCollection/boundFunction |\r\n\r\n### Actions Using HTTP POST\r\n\r\n| Resource      | Request                                                                                 |\r\n|:--------------|:----------------------------------------------------------------------------------------|\r\n| Action import | POST http&#58;//host/serviceRoot/ActionImport                                           |\r\n| boundAction   | POST http&#58;//host/serviceRoot/EntitySet/boundAction                                  |\r\n| boundAction   | POST http&#58;//host/serviceRoot/EntitySet(Key)/boundAction                             |\r\n| boundAction   | POST http&#58;//host/serviceRoot/EntitySet(Key)/ComplexProperty/boundAction             |\r\n| boundAction   | POST http&#58;//host/serviceRoot/EntitySet(Key)/ComplexPropertyCollection/boundAction   |\r\n| boundAction   | POST http&#58;//host/serviceRoot/EntitySet(Key)/PrimitiveProperty/boundAction           |\r\n| boundAction   | POST http&#58;//host/serviceRoot/EntitySet(Key)/PrimitivePropertyCollection/boundAction |\r\n\r\n### Supported System Query Options\r\n\r\n| System Query Option| OASIS OData V4.0 Errata 3 - Query Option Description |\r\n|:-------------------|:-----------------------------------------------------|\r\n| `$filter`          | [Supported values see OASIS specification](http://docs.oasis-open.org/odata/odata/v4.0/errata03/os/complete/part2-url-conventions/odata-v4.0-errata03-os-part2-url-conventions-complete.html#_Toc453752358)|\r\n| `$expand`          | [Supported values see OASIS specification](http://docs.oasis-open.org/odata/odata/v4.0/errata03/os/complete/part2-url-conventions/odata-v4.0-errata03-os-part2-url-conventions-complete.html#_Toc453752359)|\r\n| `$select`          | [Supported values see OASIS specification](http://docs.oasis-open.org/odata/odata/v4.0/errata03/os/complete/part2-url-conventions/odata-v4.0-errata03-os-part2-url-conventions-complete.html#_Toc453752360)|\r\n| `$orderby`         | [Supported values see OASIS specification](http://docs.oasis-open.org/odata/odata/v4.0/errata03/os/complete/part2-url-conventions/odata-v4.0-errata03-os-part2-url-conventions-complete.html#_Toc453752361)|\r\n| `$top` and `$skip` | [Supported values see OASIS specification](http://docs.oasis-open.org/odata/odata/v4.0/errata03/os/complete/part2-url-conventions/odata-v4.0-errata03-os-part2-url-conventions-complete.html#_Toc453752362)|\r\n| `$count`           | [Supported values see OASIS specification](http://docs.oasis-open.org/odata/odata/v4.0/errata03/os/complete/part2-url-conventions/odata-v4.0-errata03-os-part2-url-conventions-complete.html#_Toc453752363)|\r\n| `$search`          | [Supported values see OASIS specification](http://docs.oasis-open.org/odata/odata/v4.0/errata03/os/complete/part2-url-conventions/odata-v4.0-errata03-os-part2-url-conventions-complete.html#_Toc453752364)|\r\n| `$format`          | [Supported values see OASIS specification](http://docs.oasis-open.org/odata/odata/v4.0/errata03/os/complete/part2-url-conventions/odata-v4.0-errata03-os-part2-url-conventions-complete.html#_Toc453752365)|\r\n\r\n### Analytical Queries\r\n\r\nAnalytical queries with `$apply` are described in the\r\n[specification](http://docs.oasis-open.org/odata/odata-data-aggregation-ext/v4.0/cs01/odata-data-aggregation-ext-v4.0-cs01.html)\r\nfor the OData data aggregration extension.\r\n\r\n| Transformation  | Sample                                                          | Limitations     |\r\n|:----------------|:----------------------------------------------------------------| :---------------|\r\n| `aggregate`     | GET ~/Sales?$apply=aggregate(Amount with sum as Total)          | Keyword 'from' is not supported |\r\n| `topcount`      | GET ~/Sales?$apply=topcount(2,Amount)                           |\r\n| `topsum`        | GET ~/Sales?$apply=topsum(15,Amount)                            |\r\n| `toppercent`    | GET ~/Sales?$apply=toppercent(50,Amount)                        |\r\n| `bottomcount`   | GET ~/Sales?$apply=bottomcount(2,Amount)                        |\r\n| `bottomsum`     | GET ~/Sales?$apply=bottomsum(7,Amount)                          |\r\n| `bottompercent` | GET ~/Sales?$apply=bottompercent(50,Amount)                     |\r\n| `identity`      | GET ~/Sales?$apply=identity                                     |\r\n| `concat`        | GET ~/Sales?$apply=concat(topcount(2,Amount),aggregate(Amount)) |\r\n| `groupby`       | GET ~/Sales?$apply=groupby((Customer/Country,Product/Name), aggregate(Amount with sum as Total)) | rollup and `$all` is not supported |\r\n| `compute`       | GET ~/Customers?$apply=compute(length(Country) as Length)       |\r\n| `filter`        | GET ~/Sales?$apply=filter(Amount gt 3)                          |\r\n| `orderby`       | GET ~/Sales?$apply=orderby(Customer/Name)                       |\r\n| `expand`        | Not supported                                                   |\r\n| `search`        | GET ~/Sales?$apply=search(coffee)                               |\r\n| `skip`          | GET ~/Sales?$apply=skip(5)                                      |\r\n| `top`           | GET ~/Sales?$apply=top(4)                                       |\r\n\r\n\r\n## Releases and Milestones\r\n\r\n[Changelog](./CHANGELOG.md)\r\n"}]