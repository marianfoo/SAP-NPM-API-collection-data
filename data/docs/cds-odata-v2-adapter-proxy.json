[{"name":"CHANGELOG.md","content":"# Changelog\r\n\r\nAll notable changes to this project will be documented in this file.\r\n\r\nThe format is based on [Keep a Changelog](http://keepachangelog.com/en/1.0.0/)\r\nand this project adheres to [Semantic Versioning](http://semver.org/spec/v2.0.0.html).\r\n\r\n<!-- New version information is automatically added after line 8 -->\r\n\r\n## Version 1.9.0 - 2022-07-04\r\n\r\n- CDS 6 compatible version\r\n- Enhance proxy option `target` with mode `auto` to handle dynamic target/port assignment (e.g. for unit-tests)\r\n- Represent time component of `cds.Date/Edm.DateTime` with second precision (i.e. `00:00:00`)\r\n\r\n## Version 1.8.21 - 2022-06-22\r\n\r\n### Fixed\r\n\r\n- Add `Type` suffix to fix `__metadata.type` for parameterized entities (datajs did skip date type conversion)\r\n- Fix parameterized entities navigation links\r\n- Enhance Fiori Elements example apps\r\n\r\n## Version 1.8.20 - 2022-06-13\r\n\r\n### Fixed\r\n\r\n- Change README on Approuter compression flag `compressResponseMixedTypeContent`\r\n- Fill and process surrogate key `ID__` correctly in case of analytical queries\r\n- Add an example Fiori Elements applications showcasing hierarchical `TreeTable` usage\r\n- Rework UI application examples (basic, draft and hierarchy apps)\r\n\r\n## Version 1.8.19 - 2022-05-18\r\n\r\n### Fixed\r\n\r\n- Don't propagate `host` header to forwarded calls.\r\n\r\n## Version 1.8.18 - 2022-05-13\r\n\r\n### Fixed\r\n\r\n- Propagate all headers to forwarded calls.\r\n\r\n## Version 1.8.17 - 2022-05-12\r\n\r\n### Fixed\r\n\r\n- Filter out annotation elements in response data starting with `odata.` or including `@odata.`.\r\n- Elements starting with `@` are excluded as before.\r\n- Propagate special headers to forwarded calls (i.e. starting with `dwc`).\r\n\r\n## Version 1.8.16 - 2022-04-28\r\n\r\n### Fixed\r\n\r\n- Fix if elements are annotated with `@cds.api.ignore`\r\n- Abort file upload when limit is reached\r\n\r\n## Version 1.8.15 - 2022-04-25\r\n\r\n### Fixed\r\n\r\n- Remove internal repository reference\r\n- Document that Singletons are not available in OData V2\r\n- Ignore omitted elements annotated with `@cds.api.ignore`\r\n- Support validated for absolute context urls via `cds.odata.contextAbsoluteUrl`.\r\n- Skip aggregation for measures with aggregation `#NONE` and `#NOP`\r\n- Support `$count` aggregations for measures with aggregation `#$COUNT`\r\n- Changed OData type mapping for `Edm.Byte` to `cds.Integer`\r\n\r\n## Version 1.8.14 - 2022-04-08\r\n\r\n### Fixed\r\n\r\n- Upgrade `@sap/logging` to fix vulnerability\r\n\r\n## Version 1.8.13 - 2022-04-07\r\n\r\n### Fixed\r\n\r\n- Remove peer dependency to prevent workspace failures\r\n\r\n## Version 1.8.12 - 2022-04-01\r\n\r\n### Fixed\r\n\r\n- Refactorings to support universal CSN\r\n- Refactorings to support metadata prototype layering\r\n- Include `search` in `$apply` aggregations\r\n\r\n## Version 1.8.11 - 2022-03-11\r\n\r\n### Fixed\r\n\r\n- Fix for `falsy` values during data type conversion for functions and actions\r\n- Add OData V2 links via link providers to HTML index page\r\n\r\n## Version 1.8.10 - 2022-03-01\r\n\r\n### Fixed\r\n\r\n- Refactor locale determination from CDS\r\n- Serialize body to string in case of type `object` before calculating content length\r\n- Support `AnalyticalContext` annotations in addition to deprecated `Analytics` annotations\r\n\r\n## Version 1.8.9 - 2022-02-09\r\n\r\n### Fixed\r\n\r\n- Stabilization fixes\r\n\r\n## Version 1.8.8 - 2022-02-08\r\n\r\n### Fixed\r\n\r\n- Proxy option `calcContentDisposition` to calculate `content-disposition` header even if already available\r\n\r\n## Version 1.8.7 - 2022-02-03\r\n\r\n### Fixed\r\n\r\n- Proxy option `fixDraftRequests` to convert unsupported draft request to a working version (default: false)\r\n\r\n## Version 1.8.6 - 2022-02-01\r\n\r\n### Fixed\r\n\r\n- Fix README for combined custom backend bootstrap\r\n- Allow annotation `@odata.type` in lower case format\r\n- Allow type prefix `datetime` in addition to `datetimeoffset`\r\n- Add peer dependency @types/express\r\n\r\n## Version 1.8.5 - 2022-01-17\r\n\r\n### Fixed\r\n\r\n- Prevent additional call to fill `content-disposition`, in case header is already provided with stream\r\n- Support OData V2 `binary` media upload via POST for entities with element of type `Binary` and without `@Core.MediaType` annotations\r\n- Return server error as response, if OData V4 server does not support media upload without `@Core.MediaType` annotation\r\n  - e.g. `No payload deserializer available for resource kind 'PRIMITIVE' and mime type 'image/png'`\r\n\r\n## Version 1.8.4 - 2021-12-06\r\n\r\n### Fixed\r\n\r\n- Unquote action/function parameter of types `cds.UUID`, `cds.Binary`, `cds.LargeBinary`, `cds.Date`, `cds.Time`, `cds.DateTime`, `cds.Timestamp`\r\n\r\n## Version 1.8.3 - 2021-12-06\r\n\r\n### Fixed\r\n\r\n- Prevent parsing body for HEAD requests against $batch\r\n- Fix single quotes of URL parameters for request body conversion respecting line breaks\r\n- Introduce proxy option `quoteSearch` to control search expression quoting. Default is `true`\r\n- Fix bound action call to entity key having association type\r\n- Fix action/function parameter of types date, time, datetime\r\n\r\n## Version 1.8.2 - 2021-12-01\r\n\r\n### Fixed\r\n\r\n- Catch and handle unexpected errors during proxy request processing\r\n- Validate request body and content-type in request\r\n- Switch of internal NPM repository (Nexus -> Artifactory)\r\n\r\n## Version 1.8.1 - 2021-11-19\r\n\r\n### Fixed\r\n\r\n- Change action/function return type value representation for primitive types to include nesting to conform to OData standard\r\n- Introduce proxy options `returnPrimitiveNested: false` to keep previous action/function return value representation for primitive types\r\n- Introduce proxy option `returnCollectionNested` to control collection of entity type nesting into a `results` section. Default is `true`\r\n- Fill standardized `x-correlation-id` request header in addition to `x-correlationid` for proxy requests\r\n\r\n## Version 1.8.0 - 2021-11-17\r\n\r\n### Fixed\r\n\r\n- Add README documentation for annotation `@Core.ContentDisposition.Type`\r\n- Change `content-disposition` header default from `inline` to `attachment`\r\n- Proxy option `contentDisposition` to specify default content disposition for media streams (inline, attachment)\r\n- Unescape single quotes of action URL parameters for request body conversion\r\n- Fix action/function return type representation for `cds.LargeString`\r\n- Improve formatting of README and CHANGELOG\r\n- Adjust repository url\r\n\r\n## Version 1.7.16 - 2021-11-10\r\n\r\n### Fixed\r\n\r\n- `Content-Disposition` header filename is now url encoded\r\n- Annotation `@Core.ContentDisposition.Type` to specify content disposition type (e.g. inline, attachment (default), etc.)\r\n\r\n## Version 1.7.15 - 2021-11-08\r\n\r\n### Fixed\r\n\r\n- Quote key parts of type `cds.LargeString` for uri generation\r\n\r\n## Version 1.7.14 - 2021-11-03\r\n\r\n### Fixed\r\n\r\n- Decode url key values before conversion\r\n\r\n## Version 1.7.13 - 2021-10-18\r\n\r\n### Fixed\r\n\r\n- Escape quotes in search string before quoting\r\n\r\n## Version 1.7.12 - 2021-10-07\r\n\r\n### Fixed\r\n\r\n- Proxy option `propagateMessageToDetails` to always propagate root error or message to details section\r\n- Support for fetching Edmx metadata locally via `cds.mtx.getEdmx`\r\n- Support for fetching Edmx metadata remotely via MTX service url\r\n\r\n## Version 1.7.11 - 2021-09-09\r\n\r\n### Fixed\r\n\r\n- Convert ContentID for warning messages and error body and propagate to details\r\n- Fix batch boundary parsing from content type with charset definition\r\n- Functions `startswith` and `endswith` respect proxy option `caseInsensitive`\r\n\r\n## Version 1.7.10 - 2021-08-31\r\n\r\n### Fixed\r\n\r\n- Fix query options not part of action parameters\r\n- Proxy option `caseInsensitive` to transform search function e.g. `substringof` to case-insensitive variant\r\n\r\n## Version 1.7.9 - 2021-08-06\r\n\r\n### Fixed\r\n\r\n- Add metadata type of inline return type for actions and functions\r\n- Proxy option `messageTargetDefault` to specify default message target, if undefined\r\n- Empty proxy option `messageTargetDefault` leaves message target untouched\r\n\r\n## Version 1.7.8 - 2021-07-28\r\n\r\n### Fixed\r\n\r\n- Support for verb tunneling, i.e., `POST` with `X-HTTP-Method` header\r\n\r\n## Version 1.7.7 - 2021-07-27\r\n\r\n### Fixed\r\n\r\n- Support inline return type for actions and functions\r\n- Default undefined message target to `/#TRANSIENT#`\r\n- Return 404 for unknown service name during model compilation\r\n- Enhance logging to contain service name for service lookup from request\r\n\r\n## Version 1.7.6 - 2021-07-01\r\n\r\n### Fixed\r\n\r\n- Prevent exception on handling entities without keys\r\n\r\n## Version 1.7.5 - 2021-06-21\r\n\r\n### Fixed\r\n\r\n- Prevent unnecessary expensive `isExtended` call per request using metadata cache\r\n\r\n## Version 1.7.4 - 2021-06-18\r\n\r\n### Fixed\r\n\r\n- Support annotation `@odata.Type` for non-UUID CDS types\r\n- Set header `x-cds-odata-version: v2` to indicate target OData version to CDS runtime\r\n- Explain usage of response compression in README\r\n\r\n## Version 1.7.3 - 2021-06-11\r\n\r\n### Fixed\r\n\r\n- Change OData V4 `continue-on-error` default to `false`\r\n- Proxy option `continueOnError: true` available to activate `continue-on-error`\r\n\r\n## Version 1.7.2 - 2021-06-10\r\n\r\n### Fixed\r\n\r\n- Fix content type normalization to preserve charset\r\n\r\n## Version 1.7.1 - 2021-05-28\r\n\r\n### Fixed\r\n\r\n- Fix return type determination for external services definitions\r\n\r\n## Version 1.7.0 - 2021-05-27\r\n\r\n### Fixed\r\n\r\n- Change action/function return type value representation for complex and primitive types\r\n- Introduce proxy options `returnComplexNested` and `returnPrimitivePlain` to keep previous action/function return value representation\r\n\r\n## Version 1.6.3 - 2021-05-26\r\n\r\n### Fixed\r\n\r\n- Convert additional targets of response messages\r\n- Transform leading part of locale to lower-case\r\n- Fix local entity name determination for scoped entities, e.g. `.texts`\r\n\r\n## Version 1.6.2 - 2021-04-29\r\n\r\n### Fixed\r\n\r\n- Merge headers and body of POST and PUT media entity upload calls\r\n- Handle error case in PUT media entity upload call\r\n\r\n## Version 1.6.1 - 2021-04-12\r\n\r\n### Fixed\r\n\r\n- Handle authorization header correctly in media upload\r\n\r\n## Version 1.6.0 - 2021-04-06\r\n\r\n### Fixed\r\n\r\n- Final CDS 5 compatibility version\r\n\r\n## Version 1.5.11 - 2021-03-26\r\n\r\n### Fixed\r\n\r\n- CDS 5 compatibility (>= 1.6.0 needed for CDS 5)\r\n- Support `content-disposition` header in media entity upload\r\n- Introduction of element annotation `@cov2ap.headerDecode` to decode header values\r\n\r\n## Version 1.5.10 - 2021-03-18\r\n\r\n### Fixed\r\n\r\n- Fix crash for bound action without return type\r\n- Consider bound action binding parameter for messages targets\r\n\r\n## Version 1.5.9 - 2021-03-02\r\n\r\n### Fixed\r\n\r\n- Improve TypeScript typings\r\n\r\n## Version 1.5.8 - 2021-02-25\r\n\r\n### Fixed\r\n\r\n- Update `@sap/logging` dependency\r\n\r\n## Version 1.5.7 - 2021-02-19\r\n\r\n### Fixed\r\n\r\n- Restore backwards compatibility with CDS 3\r\n\r\n## Version 1.5.6 - 2021-02-12\r\n\r\n### Fixed\r\n\r\n- Convert response message targets\r\n\r\n## Version 1.5.5 - 2021-01-27\r\n\r\n### Fixed\r\n\r\n- Align determination of locale including sub tags (e.g. `zh-TW`)\r\n\r\n## Version 1.5.4 - 2021-01-26\r\n\r\n### Fixed\r\n\r\n- Support action/function array parameter types\r\n- Introduce proxy option `bodyParserLimit` for body parser size limit\r\n\r\n## Version 1.5.3 - 2021-01-12\r\n\r\n### Fixed\r\n\r\n- Improve TypeScript typings\r\n\r\n## Version 1.5.2 - 2021-01-11\r\n\r\n### Fixed\r\n\r\n- Add TypeScript typings for proxy constructor\r\n\r\n## Version 1.5.1 - 2020-12-21\r\n\r\n### Fixed\r\n\r\n- Normalize service root path in service root xml to include trailing slash\r\n\r\n## Version 1.5.0 - 2020-12-16\r\n\r\n### Fixed\r\n\r\n- Update minor version\r\n\r\n## Version 1.4.63 - 2020-12-15\r\n\r\n### Fixed\r\n\r\n- Fix that file upload error message does not return with `500` status code\r\n\r\n## Version 1.4.61 - 2020-12-11\r\n\r\n### Fixed\r\n\r\n- Fix accept header for binary data retrieval to include `application/json`\r\n\r\n## Version 1.4.60 - 2020-12-07\r\n\r\n### Fixed\r\n\r\n- Respect offset for `Edm.DateTimeOffset`, and default to UTC offset (+0000)\r\n- Fix ticks and offset calculation for type `DateTimeOffset` to handle offset as minutes\r\n- Update README for custom bootstrap to give `proxy()` priority over `cds.serve` (as with `cds run`)\r\n- Make authorization header parsing more robust\r\n- Provide `__metadata` type information for function/action result\r\n- Data format of type `cds.Time (Edm.Time)` is switchable to ISO 8601 with proxy option `isoTime` or entity annotation `@cov2ap.isoTime`\r\n- Data format of type `cds.Date (Edm.DateTime)` is switchable to ISO 8601 with proxy option `isoDate` or entity annotation `@cov2ap.isoDate`\r\n- Data format of type `cds.DateTime / Edm.DateTimeOffset` is switchable to ISO 8601 with proxy option `isoDateTime` or entity annotation `@cov2ap.isoDateTime`\r\n- Data format of type `cds.Timestamp / Edm.DateTimeOffset` is switchable to ISO 8601 with proxy option `isoTimestamp` or entity annotation `@cov2ap.isoTimestamp`\r\n- Process DateTimeOffset always as UTC information (with `Z`)\r\n\r\n## Version 1.4.59 - 2020-12-02\r\n\r\n### Fixed\r\n\r\n- Change accept header to `application/json`, if accept `xml` is requested\r\n- Fix single service support bound to root url\r\n- Data format of type `Edm.DateTimeOffset` (`cds.DateTime`, `cds.Timestamp`) is switchable to ISO 8601 with proxy option `isoDateTimeOffset` or entity annotation `@cov2ap.isoDateTimeOffset`\r\n\r\n## Version 1.4.58 - 2020-11-26\r\n\r\n### Fixed\r\n\r\n- Support boolean header value in media entity\r\n- Prevent escaping of quotes in url for batch requests\r\n- Add `media_src` and `content-type` in `__metadata` for media entities\r\n\r\n## Version 1.4.57 - 2020-11-24\r\n\r\n### Fixed\r\n\r\n- Match headers case-insensitive for custom body in media entity\r\n- Parse header string values for non-string types in media entity\r\n\r\n## Version 1.4.56 - 2020-11-12\r\n\r\n### Fixed\r\n\r\n- Enable OData V4 `continue-on-error` per default\r\n- Add proxy option to deactivate `continue-on-error`\r\n\r\n## Version 1.4.55 - 2020-11-10\r\n\r\n### Fixed\r\n\r\n- Fix host port in response links\r\n- Handle duplication of link tokens\r\n\r\n## Version 1.4.54 - 2020-11-05\r\n\r\n### Fixed\r\n\r\n- Support mapping of `__next` annotation\r\n- Forward file upload headers to media entity POST call\r\n- Explain annotation `@Core.ContentDisposition.Filename` in README\r\n- Update README on OData API flavors\r\n- Fix links for navigation collections and query options\r\n\r\n## Version 1.4.53 - 2020-10-30\r\n\r\n### Fixed\r\n\r\n- Support custom body for binary media upload via POST\r\n- Set `Accept` header for `$batch` proxy request to `multipart/mixed`\r\n- Set missing response header `Content-Transfer-Encoding: binary`\r\n\r\n## Version 1.4.52 - 2020-10-27\r\n\r\n### Fixed\r\n\r\n- Log warning for change set order violation, instead returning an error response\r\n\r\n## Version 1.4.51 - 2020-10-27\r\n\r\n### Fixed\r\n\r\n- Support OData V2 `binary` media upload via POST\r\n- Support OData V2 `multipart/form-data media` upload via POST\r\n- Update README on logging layers\r\n\r\n## Version 1.4.50 - 2020-10-22\r\n\r\n### Fixed\r\n\r\n- Rewrite batch success status code from `200` to `202`\r\n- Remove OData V4 header `odata-entityid`\r\n- Propagate `Content-ID` in response to HTTP request headers\r\n- Remove artificially added `Content-ID` header from batch response\r\n- Fix `Content-ID` order check for deviations between request and response\r\n\r\n## Version 1.4.49 - 2020-10-19\r\n\r\n### Fixed\r\n\r\n- Fix entity uris with `x-forwarded-path` headers for OData batch calls\r\n- Support of `odata-entityid` header rewrite\r\n\r\n## Version 1.4.48 - 2020-10-16\r\n\r\n### Fixed\r\n\r\n- Fix entity uris with `x-forwarded-path` headers\r\n- Forward `x-request-id`, `x-correlationid` for metadata request\r\n\r\n## Version 1.4.47 - 2020-10-08\r\n\r\n### Fixed\r\n\r\n- Respect `Content-ID` in HTTP request headers\r\n- Update on peer dependencies\r\n- Update README on OData V2 Adapter for CAP Java\r\n- Update README on mission statement\r\n\r\n## Version 1.4.46 - 2020-09-29\r\n\r\n### Fixed\r\n\r\n- Update README on option `cds.env.odata.v2proxy.urlpath`\r\n- Delta response annotation `@cov2ap.deltaResponse: 'timestamp'`\r\n\r\n## Version 1.4.45 - 2020-09-17\r\n\r\n### Fixed\r\n\r\n- Prepare `Delta Responses` support in proxy (not yet supported by CDS)\r\n- Remove metadata information in request payload deeply\r\n- Update README on CDS modelling restrictions\r\n\r\n## Version 1.4.44 - 2020-09-03\r\n\r\n### Fixed\r\n\r\n- Rename proxy option `standalone` to `mtxRemote`\r\n- Allow proxy option `mtxEndpoint` to be absolute http url\r\n- Support for `cds.env` for proxy options under section `cds.cov2ap`\r\n- Update README and JSDoc documentation\r\n\r\n## Version 1.4.43 - 2020-09-01\r\n\r\n### Fixed\r\n\r\n- Fix `$filter` function conversion\r\n- Fix remote CSN fetch for standalone proxy\r\n- Fix `@sap.aggregation.role` annotation detection\r\n- Annotation `@cov2ap.analytics: false` to suppress analytical conversion\r\n- Update README documentation\r\n\r\n## Version 1.4.42 - 2020-08-05\r\n\r\n### Fixed\r\n\r\n- Add missing `Content-ID` header for batch changeset\r\n\r\n## Version 1.4.41 - 2020-08-03\r\n\r\n### Fixed\r\n\r\n- CDS 4 compatibility\r\n- Improve logging layers\r\n- Update README documentation\r\n- Improve JWT tenant processing\r\n\r\n## Version 1.4.40 - 2020-07-20\r\n\r\n### Fixed\r\n\r\n- Fix aggregation grouping on filtered elements\r\n- Support `sap:` analytical annotations\r\n\r\n## Version 1.4.39 - 2020-07-10\r\n\r\n### Fixed\r\n\r\n- Move annotation `ContentDisposition.Filename` to data element\r\n- Improve stability of content disposition\r\n\r\n## Version 1.4.38 - 2020-07-06\r\n\r\n### Fixed\r\n\r\n- Fix `base` proxy option (follow-up)\r\n\r\n## Version 1.4.37 - 2020-06-26\r\n\r\n### Fixed\r\n\r\n- Replace `pathRewrite` option by `targetPath` option\r\n- Fix `base` proxy option\r\n- Respect OData annotation `@odata.Type`\r\n- Alternative annotation `@Common.ContentDisposition.Filename`\r\n\r\n## Version 1.4.36 - 2020-06-24\r\n\r\n### Fixed\r\n\r\n- Fix escaping of quote for function parameters\r\n- SAP Fiori Elements v2 sample app\r\n\r\n## Version 1.4.35 - 2020-06-23\r\n\r\n### Fixed\r\n\r\n- Fix reserved uri characters (follow-up)\r\n\r\n## Version 1.4.34 - 2020-06-17\r\n\r\n### Fixed\r\n\r\n- Fix entity key with (encoded) reserved uri characters\r\n\r\n## Version 1.4.33 - 2020-05-29\r\n\r\n### Fixed\r\n\r\n- Service Document in XML format (default)\r\n- Update dependencies\r\n- Disable network log per default\r\n\r\n## Version 1.4.32 - 2020-05-27\r\n\r\n### Fixed\r\n\r\n- Update dependencies\r\n- Update README on localization\r\n- Toggle switch for network logging\r\n- Allow HANA `SYSUUID` as UUID\r\n\r\n## Version 1.4.31 - 2020-05-25\r\n\r\n### Fixed\r\n\r\n- Align model resolving\r\n- Fix data types conversion for numbers\r\n- Fix data types recognition in functions\r\n- Support response compression\r\n- Prevent unnecessary data serialization for tracing\r\n- Performance optimization for entity key/uri calculation\r\n- General performance optimizations\r\n- Update dependencies\r\n\r\n## Version 1.4.30 - 2020-05-01\r\n\r\n### Fixed\r\n\r\n- Make function call with request body more robust\r\n- Fallback severity for detail messages to error\r\n- Keep request body for action call\r\n- Update README on CF deployment\r\n\r\n## Version 1.4.29 - 2020-04-28\r\n\r\n### Fixed\r\n\r\n- Fix analytics default value for all OData types\r\n- Fix long running data type conversion for filter elements\r\n\r\n## Version 1.4.28 - 2020-04-27\r\n\r\n### Fixed\r\n\r\n- Fix `$filter` in analytics query\r\n- Fix count for empty analytics result\r\n- Fix result projection for analytics query\r\n- Fix analytics `null` result values\r\n- Only add root error, if no details messages\r\n\r\n## Version 1.4.27 - 2020-04-21\r\n\r\n### Fixed\r\n\r\n- Add root error as first detail message\r\n- Error code including `transition` marks transition message\r\n\r\n## Version 1.4.26 - 2020-04-20\r\n\r\n### Fixed\r\n\r\n- Fix `$filter` for navigation elements\r\n- Fix OData annotations conversion for Java backends\r\n- Add request authorization parsing for logging\r\n\r\n## Version 1.4.25 - 2020-04-08\r\n\r\n### Fixed\r\n\r\n- Add additional messages as details\r\n\r\n## Version 1.4.24 - 2020-04-07\r\n\r\n### Fixed\r\n\r\n- Fix for metadata transfer-encoding chunked\r\n- Filter `@` attributes\r\n\r\n## Version 1.4.23 - 2020-04-01\r\n\r\n### Fixed\r\n\r\n- Fix type conversion for `le` operator\r\n\r\n## Version 1.4.22 - 2020-03-27\r\n\r\n### Fixed\r\n\r\n- Fix entity uri path behind app router\r\n- Update dependencies\r\n\r\n## Version 1.4.21 - 2020-03-02\r\n\r\n### Fixed\r\n\r\n- Improve `$metadata` logging\r\n- Fix `$metadata` call headers\r\n\r\n## Version 1.4.20 - 2020-02-27\r\n\r\n### Fixed\r\n\r\n- Fix CDS backwards compatibility\r\n\r\n## Version 1.4.19 - 2020-02-25\r\n\r\n### Fixed\r\n\r\n- Fix ETag Support (Concurrency Control)\r\n- Support streaming from URL media\r\n- Adding custom path rewrite\r\n- Custom `server.js` support\r\n- Fix for rendering aggregation of integers\r\n- Fix time duration parsing\r\n- Misc fixes and improvements\r\n- General housekeeping\r\n- Moving from `axios` to `node-fetch`\r\n\r\n## Version 1.4.18 - 2020-02-03\r\n\r\n### Fixed\r\n\r\n- Improve `$value` handling for streaming\r\n- Fix stream filename retrieval\r\n- Optimize edmx localization\r\n- Improve logging and tracing handling\r\n- Fix for external services (e.g. Java backend) support\r\n- Re-add `services` configuration for external service mapping\r\n- Fix for search phrase\r\n\r\n## Version 1.4.17 - 2020-01-20\r\n\r\n### Fixed\r\n\r\n- Support for virtual hosts (e.g. Cloud Connector)\r\n- Fix decode URI for path name\r\n- Fix IEEE754 compatibility for single requests\r\n- Add IEEE754 compatibility option switch\r\n\r\n## Version 1.4.16 - 2020-01-14\r\n\r\n### Fixed\r\n\r\n- Enforce IEEE754 compatibility\r\n- Pin `axios` library\r\n\r\n## Version 1.4.15 - 2019-12-20\r\n\r\n### Fixed\r\n\r\n- Fix authentication prompt for `$metadata`\r\n- Improve trace handling\r\n\r\n## Version 1.4.14 - 2019-12-19\r\n\r\n### Fixed\r\n\r\n- Protect `$metadata` call\r\n- Fix `$filter` parentheses nesting\r\n- Fix `all` model loading from app, srv\r\n- Improve `$filter` handling, incl. data type and negative tests\r\n\r\n## Version 1.4.13 - 2019-12-12\r\n\r\n### Fixed\r\n\r\n- Remove `services` configuration, as it is obsolete\r\n- Fix nested functions in `$filter`\r\n\r\n## Version 1.4.12 - 2019-12-06\r\n\r\n### Fixed\r\n\r\n- Fix service and CSN model detection\r\n\r\n## Version 1.4.9 - 2019-12-05\r\n\r\n### Fixed\r\n\r\n- Allow CSN JSON object as model option\r\n- Raise error, if service not found based on path\r\n- Fix service paths with hyphen\r\n- Fix `cds.Date`, `cds.Time` data type mappings\r\n\r\n## Version 1.4.8 - 2019-11-14\r\n\r\n### Fixed\r\n\r\n- Increased body size limit\r\n- Fix engine config, to allow Node >= 8\r\n- Map `cds.DateTime` and `cds.Timestamp` to `Edm.DateTimeOffset`\r\n\r\n## Version 1.4.6 - 2019-11-07\r\n\r\n### Fixed\r\n\r\n- Update on README documentation\r\n- Minor fixes\r\n\r\n## Version 1.4.5 - 2019-10-25\r\n\r\n### Fixed\r\n\r\n- `__count` is now of type String\r\n- Aggregation values are converted according to dynamic type\r\n- Search support\r\n- Fix for converting warning messages\r\n\r\n## Version 1.4.4 - 2019-10-07\r\n\r\n### Fixed\r\n\r\n- Filter data type conversions\r\n\r\n## Version 1.4.3 - 2019-10-01\r\n\r\n### Fixed\r\n\r\n- Check CDS multitenancy/extensibility (mtx)\r\n- Allow options that are falsy for Javascript\r\n\r\n## Version 1.4.2 - 2019-09-24\r\n\r\n### Fixed\r\n\r\n- Looser declaration or peer dependency to be compatible with snapshots\r\n\r\n## Version 1.4.1 - 2019-09-11\r\n\r\n### Fixed\r\n\r\n- Fixed compatibility to CDS 3.17.0\r\n- Propagate `x-request-id`, `x-correlationid`\r\n\r\n## Version 1.4.0 - 2019-09-09\r\n\r\n### Fixed\r\n\r\n- Raise error message for not supported aggregation function (e.g. `#FORMULA`)\r\n- Fixed entity key calculation for key associations\r\n- Fixed DateTime representation in entity key structure\r\n\r\n## Version 1.3.0 - 2019-08-30\r\n\r\n### Fixed\r\n\r\n- Passing through responses in XML (just for errors)\r\n- Data-type mapping on aggregation values works for non-strings\r\n\r\n## Version 1.2.0 - 2019-08-08\r\n\r\n### Added\r\n\r\n- External Release\r\n\r\n## Version 1.0.0 - 2019-05-21\r\n\r\n### Added\r\n\r\n- Internal Release\r\n"},{"name":"lib","nodes":[]},{"name":"README.md","content":"# @sap/cds-odata-v2-adapter-proxy (cov2ap)\r\n\r\n[CDS OData V2 Adapter Proxy](https://www.npmjs.com/package/@sap/cds-odata-v2-adapter-proxy) for [CDS OData V4 Services](https://cap.cloud.sap/docs/).\r\n\r\nExposes a full-fledged OData V2 service, converting OData V2 requests to CDS OData V4 service calls and responses back to OData V2.\r\n\r\nRuns in context of the [SAP Cloud Application Programming Model (CAP)](https://cap.cloud.sap/docs/)\r\nusing CDS Node.js module [@sap/cds](https://www.npmjs.com/package/@sap/cds) or CDS Java modules\r\n[com.sap.cds](https://mvnrepository.com/artifact/com.sap.cds).\r\n\r\n## Getting Started\r\n\r\n- Clone repository\r\n- Unit Tests: `npm test`\r\n- Test Server: `npm start`\r\n  - Service: `http://localhost:4004/v2/main`\r\n  - Metadata: `http://localhost:4004/v2/main/$metadata`\r\n  - Data: `http://localhost:4004/v2/main/Header?$expand=Items`\r\n\r\n> Code repository is only available SAP internal.\r\n\r\n## Usage\r\n\r\n### CDS Combined Backend (CAP Node.js) - Integrated (preferred)\r\n\r\nIn your existing `@sap/cds` project:\r\n\r\n- Run `npm install @sap/cds-odata-v2-adapter-proxy -s`\r\n- Create new file `server.js` in the service folder `srv` of your project: `./srv/server.js`\r\n\r\n```\r\nconst cds = require(\"@sap/cds\");\r\nconst proxy = require(\"@sap/cds-odata-v2-adapter-proxy\");\r\ncds.on(\"bootstrap\", app => app.use(proxy()));\r\nmodule.exports = cds.server;\r\n```\r\n\r\n- Run `cds run` from the project root to start the server:\r\n  - OData V2 service will be available at http://localhost:4004/v2/<service-path>\r\n  - OData V4 service will be available at http://localhost:4004/<service-path>\r\n\r\nNote that `@sap/cds` is a peer dependency and needs to be available as module as well.\r\n\r\n### CDS Combined Backend (CAP Node.js) - Custom\r\n\r\nIn your existing `@sap/cds` project:\r\n\r\n- Run `npm install @sap/cds-odata-v2-adapter-proxy -s`\r\n- Create new file `index.js` in the service folder `srv` of your project: `./srv/index.js`\r\n\r\n```\r\nconst express = require(\"express\");\r\nconst cds = require(\"@sap/cds\");\r\nconst proxy = require(\"@sap/cds-odata-v2-adapter-proxy\");\r\n\r\nconst host = \"0.0.0.0\";\r\nconst port = process.env.PORT || 4004;\r\n\r\n(async () => {\r\n  const app = express();\r\n\r\n  // OData V2\r\n  app.use(proxy());\r\n\r\n  // OData V4\r\n  await cds.connect.to(\"db\");\r\n  await cds.serve(\"all\").in(app);\r\n\r\n  const server = app.listen(port, host, () => console.info(`app is listing at ${host}:${port}`));\r\n  server.on(\"error\", error => console.error(error.stack));\r\n})();\r\n```\r\n\r\n- Run `node srv/index` from the project root to start the server:\r\n  - OData V2 service will be available at http://localhost:4004/v2/<service-path>\r\n  - OData V4 service will be available at http://localhost:4004/<service-path>\r\n\r\nNote that `@sap/cds` is a peer dependency and needs to be available as module as well.\r\n\r\n### CDS Standalone Backend (CAP Node.js or CAP Java)\r\n\r\n> For CAP Java projects prefer the Native OData V2 Adapter ([com.sap.cds/cds-adapter-odata-v2](https://mvnrepository.com/artifact/com.sap.cds/cds-adapter-odata-v2)).\r\n\r\nIn a new Node.js express project:\r\n\r\n- Run `npm install @sap/cds -s`\r\n- Run `npm install @sap/cds-odata-v2-adapter-proxy -s`\r\n- Place CDS models in `db` and `srv` model folders or provide a generated CSN\r\n- Create a new file `index.js` in the service folder `srv` of the project: `./srv/index.js`\r\n\r\n```\r\nconst express = require(\"express\");\r\nconst proxy = require(\"@sap/cds-odata-v2-adapter-proxy\");\r\n\r\nconst host = \"0.0.0.0\";\r\nconst port = process.env.PORT || 4004;\r\n\r\n(async () => {\r\n  const app = express();\r\n\r\n  // OData V2\r\n  app.use(proxy({\r\n    target: \"<odata-v4-backend-url>\", // locally e.g. http://localhost:8080\r\n    services: {\r\n      \"<odata-v4-service-path>\": \"<qualified.ServiceName>\"\r\n    }\r\n  }));\r\n\r\n  const server = app.listen(port, host, () => console.info(`app is listing at ${host}:${port}`));\r\n  server.on(\"error\", error => console.error(error.stack));\r\n})();\r\n```\r\n\r\n- A deployed version of CDS OData V2 Adapter Proxy shall have option `target` set to the deployed OData V4 backend URL.\r\n  This can be retrieved from the Cloud Foundry environment using `process.env`, for example,\r\n  from the `destinations` environment variable. Locally e.g. http://localhost:8080 can be used.\r\n- In proxy option `services`, every OData V4 service URL path needs to mapped to\r\n  the corresponding fully qualified CDS service name, e.g. `\"/odata/v4/MainService/\": \"test.MainService\"`,\r\n  to establish the back-link connection between OData URL and its CDS service.\r\n- Make sure, that your CDS models are also available in the project.\r\n  Those reside either in `db` and `srv` folders, or a compiled (untransformed) `srv.json` is provided.\r\n  This can be generated by using the following command:\r\n\r\n  ```\r\n  cds srv -s all -o .\r\n  ```\r\n\r\n- Alternatively, a `cds build` can be triggered as described in section \"Cloud Foundry Deployment\".\r\n- If not detected automatically, the model path can be set with option `model` (especially if `csn.json`/`srv.json` option is used).\r\n- Make sure, that all i18n property files reside next to the `csn.json` in a `i18n` or `_i18n` folder, to be detected by localization.\r\n- In a multitenant scenario in combination with a standalone proxy, the CDS model can be retrieved remotely via MTX endpoint (`mtxEndpoint`) by setting proxy option `mtxRemote: true`.\r\n- Proxy option `mtxEndpoint` can be specified as absolute url (starting with `http://` or `https://`), to be able to address MTX Sidecar\r\n  possibly available under a target different from OData v4 backend URL. If not specified absolutely, proxy `target` is prepended to `mtxEndpoint`.\r\n\r\n- Run `node srv/index` from the project root to start the server:\r\n  - OData V2 service will be available at http://localhost:4004/v2/<odata-v4-service-path>\r\n  - OData V4 service shall be available at http://localhost:8080/<odata-v4-service-path>\r\n\r\nNote that `@sap/cds` is a peer dependency and needs to be available as module as well.\r\n\r\n## Cloud Foundry Deployment\r\n\r\nWhen deploying the CDS OData V2 Adapter Proxy to Cloud Foundry, make sure that it has access to the whole CDS model.\r\nEspecially, it’s the case, that normally the Node.js server is only based on folder `srv` and folder `db` is then missing on Cloud Foundry.\r\n\r\nTo come around this situation, trigger a `cds build` during development time, that generates a `csn.json` at location `gen/srv/srv/csn.json`.\r\nPoint your Cloud Foundry deployment of the CDS OData V2 Adapter Proxy to the folder `gen/srv` (using manifest.json or MTA), so that\r\nthe CDS models can be found via file `srv/csn.json`, during runtime execution on Cloud Foundry.\r\n\r\nMake sure, that all i18n property files reside next to the `csn.json` in a `i18n` or `_i18n` folder, to be detected by localization.\r\n\r\n## SAP Fiori Elements V2\r\n\r\nThe OData V2 service provided by the CDS OData V2 Adapter Proxy can be used to serve an SAP Fiori Elements V2 UI.\r\n\r\nFiori Elements examples:\r\n\r\n- **Basic Edit**: Basic editing app\r\n- **Draft Edit**: Draft supported editing app\r\n- **Hierarchy**: Hierarchical display of data in tree table\r\n\r\nRunning examples can be tested as follows:\r\n\r\n- Clone repository\r\n- Start server: `npm start`\r\n- Open Fiori Launchpad: http://localhost:4004/fiori.html\r\n\r\n> Code repository is only available SAP internal.\r\n\r\n## Compression\r\n\r\nResponse compressions can be enabled, by registering the `compression` Node.js\r\nmodule in Express app at bootstrap time, e.g. in `srv/server.js`:\r\n\r\n```\r\nconst cds = require(\"@sap/cds\");\r\nconst proxy = require(\"@sap/cds-odata-v2-adapter-proxy\");\r\nconst compression = require(\"compression\");\r\n\r\ncds.on(\"bootstrap\", (app) => {\r\n  app.use(compression({ filter: shouldCompress }));\r\n  app.use(proxy());\r\n});\r\n\r\nfunction shouldCompress(req, res) {\r\n  const type = res.getHeader(\"Content-Type\");\r\n  if (type && typeof type === \"string\" && type.startsWith(\"multipart/mixed\")) {\r\n    return true;\r\n  }\r\n  // fallback to standard filter function\r\n  return compression.filter(req, res);\r\n}\r\n```\r\n\r\nThe shown compression filter function enables compression including\r\nOData Batch (`$batch`) calls with content type `multipart/mixed`.\r\n\r\n### Approuter Compression\r\n\r\n`@sap/approuter` now support out-of-the-box compression for OData $batch calls with `multipart/mixed`.\r\nIt's disabled by default, but can be enabled using option [compressResponseMixedTypeContent](https://www.npmjs.com/package/@sap/approuter#compression-property).\r\n\r\n## Documentation\r\n\r\nInstantiates a CDS OData V2 Adapter Proxy Express Router for a CDS-based OData V4 Server:\r\n\r\n- **options:** CDS OData V2 Adapter Proxy options object.\r\n  - **base:** Base path under which the service is reachable. Default is `''`.\r\n  - **path:** Path under which the proxy is reachable. Default is `'v2'`.\r\n  - **model:** CDS service model (path(s) or CSN). Default is `'all'`.\r\n  - **port:** Target port which points to OData V4 backend port. Default is process.env.PORT or `4004`.\r\n  - **target:** Target which points to OData V4 backend host:port. Use `'auto'` to infer the target from server url after listening. Default is e.g. `'http://localhost:4004'`.\r\n  - **targetPath:** Target path to which is redirected. Default is `''`.\r\n  - **services:** Service mapping object from url path name to service name. Default is `{}`.\r\n  - **mtxRemote:** CDS model is retrieved remotely via MTX endpoint for multitenant scenario. Default is `false`.\r\n  - **mtxEndpoint:** Endpoint to retrieve MTX metadata when option 'mtxRemote' is active. Default is `'/mtx/v1'`.\r\n  - **ieee754Compatible:** Edm.Decimal and Edm.Int64 are serialized IEEE754 compatible. Default is `true`.\r\n  - **disableNetworkLog:** Disable networking logging. Default is `true`.\r\n  - **fileUploadSizeLimit:** File upload file size limit (in bytes). Default is `10485760` (10 MB).\r\n  - **continueOnError:** Indicates to OData V4 backend to continue on error. Default is `false`.\r\n  - **isoTime:** Use ISO 8601 format for type cds.Time (Edm.Time). Default is `false`.\r\n  - **isoDate:** Use ISO 8601 format for type cds.Date (Edm.DateTime). Default is `false`.\r\n  - **isoDateTime:** Use ISO 8601 format for type cds.DateTime (Edm.DateTimeOffset). Default is `false`.\r\n  - **isoTimestamp:** Use ISO 8601 format for type cds.Timestamp (Edm.DateTimeOffset). Default is `false`.\r\n  - **isoDateTimeOffset:** Use ISO 8601 format for type Edm.DateTimeOffset (cds.DateTime, cds.Timestamp). Default is `false`.\r\n  - **bodyParserLimit:** Request and response body parser size limit. Default is `'100mb'`.\r\n  - **returnCollectionNested**: Collection of entity type is returned nested into a results section. Default is `true`.\r\n  - **returnComplexNested**: Function import return structure of complex type (non collection) is nested using function import name. Default is `true`.\r\n  - **returnPrimitiveNested**: Function import return structure of primitive type (non collection) is nested using function import name. Default is `true`.\r\n  - **returnPrimitivePlain**: Function import return value of primitive type is rendered as plain JSON value. Default is `true`.\r\n  - **messageTargetDefault**: Specifies the message target default, if target is undefined. Default is `'/#TRANSIENT#'`.\r\n  - **caseInsensitive**: Transforms search functions i.e. substringof, startswith, endswith to case-insensitive variant. Default is `false`.\r\n  - **propagateMessageToDetails**: Propagates root error or message always to details section. Default is `false`.\r\n  - **contentDisposition**: Default content disposition for media streams (inline, attachment), if not available or calculated. Default is `'attachment'`.\r\n  - **calcContentDisposition**: Calculate content disposition for media streams even if already available. Default is `false`.\r\n  - **quoteSearch**: Specifies if search expression is quoted automatically. Default is `true`.\r\n  - **fixDraftRequests**: Specifies if unsupported draft requests are converted to a working version. Default is `false`.\r\n\r\nAll CDS OData V2 Adapter Proxy options can also be specified as part of CDS project-specific configuration\r\nunder section `cds.cov2ap` and accessed via `cds.env.cov2ap`.\r\n\r\nOption `cds.env.odata.v2proxy.urlpath` is available to specify an OData V2 proxy url path\r\ndifferent from default `/v2` for CDS core.\r\n\r\n### CDS Annotations\r\n\r\nThe following CDS OData V2 Adapter Proxy specific annotations are supported:\r\n\r\n**Entity Level**:\r\n\r\n- `@cov2ap.analytics: false`: Suppress analytics conversion for the annotated entity, if set to `false`.\r\n- `@cov2ap.deltaResponse: 'timestamp'`: Delta response '\\_\\_delta' is added to response data of annotated entity with current timestamp information.\r\n- `@cov2ap.isoTime`: Values of type cds.Time (Edm.Time) are represented in ISO 8601 format for annotated entity.\r\n- `@cov2ap.isoDate`: Values of type cds.Date (Edm.DateTime) are represented in ISO 8601 format for annotated entity.\r\n- `@cov2ap.isoDateTime`: Values of type cds.DateTime (Edm.DateTimeOffset) are represented in ISO 8601 format for annotated entity.\r\n- `@cov2ap.isoTimestamp`: Values of type cds.Timestamp (Edm.DateTimeOffset) are represented in ISO 8601 format for annotated entity.\r\n- `@cov2ap.isoDateTimeOffset`: Values of type Edm.DateTimeOffset (cds.DateTime, cds.Timestamp) are represented in ISO 8601 format for annotated entity.\r\n\r\n**Entity Element Level**:\r\n\r\n- `@Core.ContentDisposition.Filename: <element>`: Specifies entity element, representing the filename during file upload/download.\r\n- `@Core.ContentDisposition.Type: <value>`: Controls the content disposition behavior in client/browser (`inline` or `attachment`).\r\n- `@cov2ap.headerDecode`: Array of sequential decoding procedures ('uri', 'uriComponent', 'base64') used for media entity upload header.\r\n\r\n### CDS Modelling\r\n\r\nCDS project configuration `cds.odata.version` shall be set to `v4`, as OData proxy maps to OData V4.\r\nCDS supports modelling features that are not compatible with OData V2 standard:\r\n\r\n- **Singletons:** Usage of annotation `@odata.singleton` is not supported in combination with OData V2\r\n- **Structured Types:** Usage of `cds.odata.format: 'structured'` is not supported in combination with OData V2\r\n- **Arrayed Types:** Usages of `array of` or `many` in entity element definitions lead to CDS compilation error: `Element must not be an \"array of\" for OData V2`\r\n\r\nTo provide an OData V2 service based on the CDS OData V2 Adapter Proxy, those CDS modelling features must not be used.\r\nIn general any CDS OData API flavor must not be used in combination with CDS OData V2 Adapter Proxy.\r\n\r\n## Logging\r\n\r\nLogging is controlled with environment variable `XS_APP_LOG_LEVEL`. Especially, proxy requests and proxy responses\r\nincluding url and body adaptations can be traced using `XS_APP_LOG_LEVEL=debug`.\r\nDetails can be found at [@sap/logging](https://www.npmjs.com/package/@sap/logging).\r\n\r\n### Logging Layers\r\n\r\nLogging layers of CDS OData V2 Adapter Proxy start with `cov2ap`.\r\n\r\n#### XS_APP_LOG_LEVEL = error\r\n\r\n- `cov2ap/Authorization` : Error during authorization header parsing\r\n- `cov2ap/MetadataRequest` : Error during metadata request processing\r\n- `cov2ap/Request` : Error during request processing\r\n- `cov2ap/Response` : Error during response processing\r\n- `cov2ap/Batch` : Error during batch processing\r\n- `cov2ap/AggregationKey` : Error during aggregation key determination\r\n- `cov2ap/MediaStream` : Error during media stream processing\r\n- `cov2ap/ContentDisposition` : Error during content disposition determination\r\n- `cov2ap/FileUpload` : Error during file upload processing\r\n\r\n#### XS_APP_LOG_LEVEL = warning\r\n\r\n- `cov2ap/Service` : Service definition not found for request path\r\n- `cov2ap/Context` : Definition not found in CDS meta model\r\n- `cov2ap/Batch` : Response changeset order does not match request changeset order\r\n\r\n#### XS_APP_LOG_LEVEL = debug\r\n\r\n- `cov2ap/Request`: Log of OData V2 client request (url, body, headers)\r\n- `cov2ap/ProxyRequest`: Log of OData V4 proxy request (url, body, headers)\r\n- `cov2ap/ProxyResponse`: Log of OData V4 proxy response (status code/message, body, headers)\r\n- `cov2ap/Response`: Log of OData V2 client response (status code/message, body, headers)\r\n\r\n## Features\r\n\r\n- GET, POST, PUT / MERGE / PATCH, DELETE\r\n- Batch support\r\n- Actions, Functions\r\n- Analytical Annotations\r\n- Deep Expands/Selects\r\n- JSON format\r\n- Deep Structures\r\n- Data Type Mapping\r\n- IEEE754Compatible\r\n- Messages / Error Handling\r\n- Location Header\r\n- $inlinecount / $count / \\$value\r\n- Entity with Parameters\r\n- File Upload (binary, multipart/form-data)\r\n- Stream Support (Octet and Url)\r\n- Content Disposition\r\n- Content-ID\r\n- Multi-Tenancy\r\n- Extensibility\r\n- Draft Support\r\n- Search Support\r\n- Localization\r\n- Temporal Data\r\n- Tracing Support\r\n- Logging Correlation\r\n- ETag Support (Concurrency Control)\r\n- Next Links (skiptoken)\r\n- Delta Responses (deltatoken)\r\n- Continue-On-Error\r\n- X-HTTP-Method\r\n\r\n## OData V2/V4 Delta\r\n\r\n[What’s New in OData Version 4.0](http://docs.oasis-open.org/odata/new-in-odata/v4.0/cn01/new-in-odata-v4.0-cn01.html)\r\n\r\n## License\r\n\r\nThis package is provided under the terms of the [SAP Developer License Agreement](https://tools.hana.ondemand.com/developer-license-3.1.txt).\r\n"}]